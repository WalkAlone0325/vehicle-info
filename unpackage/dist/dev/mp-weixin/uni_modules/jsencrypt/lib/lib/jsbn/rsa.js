"use strict";const p=require("../../../../../common/vendor.js"),n=require("./jsbn.js"),f=require("./rng.js");function y(a,e){if(e<a.length+22)return p.index.__f__("error","at uni_modules/jsencrypt/lib/lib/jsbn/rsa.js:23","Message too long for RSA"),null;for(var t=e-a.length-6,r="",s=0;s<t;s+=2)r+="ff";var o="0001"+r+"00"+a;return n.parseBigInt(o,16)}function _(a,e){if(e<a.length+11)return p.index.__f__("error","at uni_modules/jsencrypt/lib/lib/jsbn/rsa.js:37","Message too long for RSA"),null;for(var t=[],r=a.length-1;r>=0&&e>0;){var s=a.charCodeAt(r--);s<128?t[--e]=s:s>127&&s<2048?(t[--e]=s&63|128,t[--e]=s>>6|192):(t[--e]=s&63|128,t[--e]=s>>6&63|128,t[--e]=s>>12|224)}t[--e]=0;for(var o=new f.SecureRandom,l=[];e>2;){for(l[0]=0;l[0]==0;)o.nextBytes(l);t[--e]=l[0]}return t[--e]=2,t[--e]=0,new n.BigInteger(t)}var q=function(){function a(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return a.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},a.prototype.doPrivate=function(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),r=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(r)<0;)t=t.add(this.p);return t.subtract(r).multiply(this.coeff).mod(this.p).multiply(this.q).add(r)},a.prototype.setPublic=function(e,t){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=n.parseBigInt(e,16),this.e=parseInt(t,16)):p.index.__f__("error","at uni_modules/jsencrypt/lib/lib/jsbn/rsa.js:114","Invalid RSA public key")},a.prototype.encrypt=function(e){var t=this.n.bitLength()+7>>3,r=_(e,t);if(r==null)return null;var s=this.doPublic(r);if(s==null)return null;for(var o=s.toString(16),l=o.length,i=0;i<t*2-l;i++)o="0"+o;return o},a.prototype.setPrivate=function(e,t,r){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=n.parseBigInt(e,16),this.e=parseInt(t,16),this.d=n.parseBigInt(r,16)):p.index.__f__("error","at uni_modules/jsencrypt/lib/lib/jsbn/rsa.js:146","Invalid RSA private key")},a.prototype.setPrivateEx=function(e,t,r,s,o,l,i,u){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=n.parseBigInt(e,16),this.e=parseInt(t,16),this.d=n.parseBigInt(r,16),this.p=n.parseBigInt(s,16),this.q=n.parseBigInt(o,16),this.dmp1=n.parseBigInt(l,16),this.dmq1=n.parseBigInt(i,16),this.coeff=n.parseBigInt(u,16)):p.index.__f__("error","at uni_modules/jsencrypt/lib/lib/jsbn/rsa.js:163","Invalid RSA private key")},a.prototype.generate=function(e,t){var r=new f.SecureRandom,s=e>>1;this.e=parseInt(t,16);for(var o=new n.BigInteger(t,16);;){for(;this.p=new n.BigInteger(e-s,1,r),!(this.p.subtract(n.BigInteger.ONE).gcd(o).compareTo(n.BigInteger.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new n.BigInteger(s,1,r),!(this.q.subtract(n.BigInteger.ONE).gcd(o).compareTo(n.BigInteger.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var l=this.p;this.p=this.q,this.q=l}var i=this.p.subtract(n.BigInteger.ONE),u=this.q.subtract(n.BigInteger.ONE),g=i.multiply(u);if(g.gcd(o).compareTo(n.BigInteger.ONE)==0){this.n=this.p.multiply(this.q),this.d=o.modInverse(g),this.dmp1=this.d.mod(i),this.dmq1=this.d.mod(u),this.coeff=this.q.modInverse(this.p);break}}},a.prototype.decrypt=function(e){var t=n.parseBigInt(e,16),r=this.doPrivate(t);return r==null?null:B(r,this.n.bitLength()+7>>3)},a.prototype.generateAsync=function(e,t,r){var s=new f.SecureRandom,o=e>>1;this.e=parseInt(t,16);var l=new n.BigInteger(t,16),i=this,u=function(){var g=function(){if(i.p.compareTo(i.q)<=0){var h=i.p;i.p=i.q,i.q=h}var v=i.p.subtract(n.BigInteger.ONE),b=i.q.subtract(n.BigInteger.ONE),I=v.multiply(b);I.gcd(l).compareTo(n.BigInteger.ONE)==0?(i.n=i.p.multiply(i.q),i.d=l.modInverse(I),i.dmp1=i.d.mod(v),i.dmq1=i.d.mod(b),i.coeff=i.q.modInverse(i.p),setTimeout(function(){r()},0)):setTimeout(u,0)},c=function(){i.q=n.nbi(),i.q.fromNumberAsync(o,1,s,function(){i.q.subtract(n.BigInteger.ONE).gcda(l,function(h){h.compareTo(n.BigInteger.ONE)==0&&i.q.isProbablePrime(10)?setTimeout(g,0):setTimeout(c,0)})})},m=function(){i.p=n.nbi(),i.p.fromNumberAsync(e-o,1,s,function(){i.p.subtract(n.BigInteger.ONE).gcda(l,function(h){h.compareTo(n.BigInteger.ONE)==0&&i.p.isProbablePrime(10)?setTimeout(c,0):setTimeout(m,0)})})};setTimeout(m,0)};setTimeout(u,0)},a.prototype.sign=function(e,t,r){var s=P(r),o=s+t(e).toString(),l=y(o,this.n.bitLength()/4);if(l==null)return null;var i=this.doPrivate(l);if(i==null)return null;var u=i.toString(16);return u.length&1?"0"+u:u},a.prototype.verify=function(e,t,r){var s=n.parseBigInt(t,16),o=this.doPublic(s);if(o==null)return null;var l=o.toString(16).replace(/^1f+00/,""),i=S(l);return i==r(e).toString()},a}();function B(a,e){for(var t=a.toByteArray(),r=0;r<t.length&&t[r]==0;)++r;if(t.length-r!=e-1||t[r]!=2)return null;for(++r;t[r]!=0;)if(++r>=t.length)return null;for(var s="";++r<t.length;){var o=t[r]&255;o<128?s+=String.fromCharCode(o):o>191&&o<224?(s+=String.fromCharCode((o&31)<<6|t[r+1]&63),++r):(s+=String.fromCharCode((o&15)<<12|(t[r+1]&63)<<6|t[r+2]&63),r+=2)}return s}var d={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"};function P(a){return d[a]||""}function S(a){for(var e in d)if(d.hasOwnProperty(e)){var t=d[e],r=t.length;if(a.substr(0,r)==t)return a.substr(r)}return a}exports.RSAKey=q;
//# sourceMappingURL=../../../../../../.sourcemap/mp-weixin/uni_modules/jsencrypt/lib/lib/jsbn/rsa.js.map
