"use strict";const l=require("../../../../common/vendor.js"),W=require("../composables/useCell.js"),n=require("../common/util.js"),H=require("../composables/useParent.js"),J=require("../wd-form/types.js"),N=require("../composables/useTranslate.js"),Q=require("./types.js");if(!Array){const k=l.resolveComponent("wd-icon"),C=l.resolveComponent("wd-search");(k+C)()}const X=()=>"../wd-icon/wd-icon.js",Y=()=>"../wd-search/wd-search.js";Math||(X+Y+x+ee+le+oe+ae+re+Z)();const Z=()=>"../wd-action-sheet/wd-action-sheet.js",x=()=>"../wd-checkbox/wd-checkbox.js",ee=()=>"../wd-checkbox-group/wd-checkbox-group.js",le=()=>"../wd-radio/wd-radio.js",oe=()=>"../wd-radio-group/wd-radio-group.js",re=()=>"../wd-button/wd-button.js",ae=()=>"../wd-loading/wd-loading.js",se={name:"wd-select-picker",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}},ne=l.defineComponent({...se,props:Q.selectPickerProps,emits:["change","cancel","confirm","clear","update:modelValue","open","close"],setup(k,{expose:C,emit:z}){const{translate:w}=N.useTranslate("select-picker"),o=k,c=z,b=l.ref(!1),s=l.ref([]),_=l.ref(!1),p=l.ref([]),d=l.ref(""),f=l.ref([]),$=l.ref(0),M=W.useCell(),A=l.computed(()=>{const e=v(o.modelValue);let a="";if(o.displayFormat)a=o.displayFormat(e,o.columns);else{const{type:r,labelKey:t}=o;r==="checkbox"?a=(n.isArray(e)?e:[]).map(i=>y(i)).map(i=>i[t]).join(", "):r==="radio"?a=y(e)[t]:a=e}return a});l.watch(()=>o.modelValue,e=>{e!==s.value&&(s.value=v(e),p.value=v(e))},{deep:!0,immediate:!0}),l.watch(()=>o.columns,e=>{o.filterable&&d.value?D(e,d.value):f.value=e},{deep:!0,immediate:!0}),l.watch(()=>o.displayFormat,e=>{e&&!n.isFunction(e)&&l.index.__f__("error","at uni_modules/wot-design-uni/components/wd-select-picker/wd-select-picker.vue:210","The type of displayFormat must be Function")},{deep:!0,immediate:!0}),l.watch(()=>o.beforeConfirm,e=>{e&&!n.isFunction(e)&&l.index.__f__("error","at uni_modules/wot-design-uni/components/wd-select-picker/wd-select-picker.vue:223","The type of beforeConfirm must be Function")},{deep:!0,immediate:!0});const{parent:m}=H.useParent(J.FORM_KEY),K=l.computed(()=>m&&o.prop&&m.errorMessages&&m.errorMessages[o.prop]?m.errorMessages[o.prop]:""),L=l.computed(()=>{let e=!1;if(m&&m.props.rules){const a=m.props.rules;for(const r in a)Object.prototype.hasOwnProperty.call(a,r)&&r===o.prop&&Array.isArray(a[r])&&(e=a[r].some(t=>t.required))}return o.required||o.rules.some(a=>a.required)||e});l.onBeforeMount(()=>{s.value=v(o.modelValue),f.value=o.columns});const{proxy:h}=l.getCurrentInstance();async function U(){let e="",a=[];n.isDef(s.value)&&s.value!==""&&!n.isArray(s.value)?(e="#wd-radio-group",a=[n.getRect(`#radio${s.value}`,!1,h)]):n.isArray(s.value)&&s.value.length>0&&(s.value.forEach(r=>{a.push(n.getRect(`#check${r}`,!1,h))}),e="#wd-checkbox-group"),e&&(await n.pause(2e3/30),Promise.all([n.getRect(".wd-select-picker__wrapper",!1,h),n.getRect(e,!1,h),...a]).then(r=>{if(n.isDef(r)&&n.isArray(r)){const t=r[0],u=r[1],i=r.slice(2)||[];n.isDef(u)&&n.isDef(t)&&i.findIndex(g=>g.bottom>t.top&&g.top<t.bottom)<0&&($.value=-1,l.nextTick$1(()=>{$.value=Math.max(0,i[0].top-u.top-t.height/2)}))}}))}function O(){}function y(e){const{valueKey:a,labelKey:r,columns:t}=o,u=t.filter(i=>i[a]===e);return u.length>0?u[0]:{[a]:e,[r]:""}}function v(e){return o.type==="checkbox"?n.isArray(e)?e:[]:e}function I({value:e}){s.value=e,c("change",{value:e}),o.type==="radio"&&!o.showConfirm&&q()}function S(){b.value=!1,_.value||(s.value=v(p.value)),c("cancel"),c("close")}function V(){o.disabled||o.readonly||(s.value=v(o.modelValue),b.value=!0,_.value=!1,c("open"))}function q(){if(o.loading){b.value=!1,c("confirm"),c("close");return}o.beforeConfirm?o.beforeConfirm(s.value,e=>{e&&T()}):T()}function T(){_.value=!0,b.value=!1,p.value=v(s.value);let e={};o.type==="checkbox"?e=(n.isArray(p.value)?p.value:[]).map(a=>y(a)):e=y(p.value),c("update:modelValue",p.value),c("confirm",{value:p.value,selectedItems:e}),c("close")}function B(e,a){const r=new RegExp(`(${a})`,"g");return e.split(r).map(t=>({type:t===a?"active":"normal",label:t}))}function E({value:e}){e===""?(f.value=[],d.value=e,l.nextTick$1(()=>{f.value=o.columns})):(d.value=e,D(o.columns,e))}function D(e,a){const t=e.filter(u=>u[o.labelKey].indexOf(a)>-1).map(u=>({...u,[o.labelKey]:B(u[o.labelKey],a)}));f.value=[],l.nextTick$1(()=>{f.value=t})}const j=l.computed(()=>o.type==="radio"&&o.showConfirm||o.type==="checkbox"),F=l.computed(()=>o.clearable&&!o.disabled&&!o.readonly&&A.value.length);function G(){c("update:modelValue",o.type==="checkbox"?[]:""),c("clear")}const R=l.computed(()=>!o.disabled&&!o.readonly&&!F.value);return C({close:S,open:V}),(e,a)=>l.e({a:e.useDefaultSlot},e.useDefaultSlot?{}:l.e({b:e.label||e.useLabelSlot},e.label||e.useLabelSlot?l.e({c:e.label},e.label?{d:l.t(e.label)}:{},{e:l.n(`wd-select-picker__label ${L.value&&"is-required"} ${e.customLabelClass}`),f:l.s(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")}):{},{g:l.t(A.value||e.placeholder||l.unref(w)("placeholder")),h:l.n(`wd-select-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${A.value?"":"wd-select-picker__value--placeholder"}`),i:R.value},R.value?{j:l.p({"custom-class":"wd-select-picker__arrow",name:"arrow-right"})}:F.value?{l:l.p({"custom-class":"wd-select-picker__clear",name:"error-fill"}),m:l.o(G)}:{},{k:F.value,n:K.value},K.value?{o:l.t(K.value)}:{},{p:l.n(`wd-select-picker__cell ${e.disabled&&"is-disabled"} ${o.readonly&&"is-readonly"} ${e.alignRight&&"is-align-right"} ${e.error&&"is-error"} ${e.size&&"is-"+e.size}`)}),{q:l.o(V),r:e.filterable},e.filterable?{s:l.o(E),t:l.o(r=>d.value=r),v:l.p({placeholder:e.filterPlaceholder||l.unref(w)("filterPlaceholder"),"hide-cancel":!0,"placeholder-left":!0,modelValue:d.value})}:{},{w:e.type==="checkbox"&&l.unref(n.isArray)(s.value)},e.type==="checkbox"&&l.unref(n.isArray)(s.value)?{x:l.f(f.value,(r,t,u)=>l.e(e.filterable&&d.value?{a:l.f(r[e.labelKey],(i,P,g)=>l.e({a:i.type==="active"},i.type==="active"?{b:l.t(i.label)}:{c:l.t(i.label)},{d:i.label}))}:{b:l.t(r[e.labelKey])},{c:"b8ce50f5-5-"+u+",b8ce50f5-4",d:l.p({modelValue:r[e.valueKey],disabled:r.disabled}),e:r[e.valueKey],f:"check"+r[e.valueKey]})),y:e.filterable&&d.value,z:l.o(I),A:l.o(r=>s.value=r),B:l.p({cell:!0,size:e.selectSize,"checked-color":e.checkedColor,min:e.min,max:e.max,modelValue:s.value})}:{},{C:e.type==="radio"&&!l.unref(n.isArray)(s.value)},e.type==="radio"&&!l.unref(n.isArray)(s.value)?{D:l.f(f.value,(r,t,u)=>l.e(e.filterable&&d.value?{a:l.f(r[e.labelKey],(i,P,g)=>({a:l.t(i.label),b:l.n(`${i.type==="active"?"wd-select-picker__text-active":""}`),c:i.label}))}:{b:l.t(r[e.labelKey])},{c:"b8ce50f5-7-"+u+",b8ce50f5-6",d:l.p({value:r[e.valueKey],disabled:r.disabled}),e:t,f:"radio"+r[e.valueKey]})),E:e.filterable&&d.value,F:l.o(I),G:l.o(r=>s.value=r),H:l.p({cell:!0,size:e.selectSize,"checked-color":e.checkedColor,modelValue:s.value})}:{},{I:e.loading},e.loading?{J:l.p({color:e.loadingColor}),K:l.o(O)}:{},{L:l.n(`wd-select-picker__wrapper ${e.filterable?"is-filterable":""} ${e.loading?"is-loading":""} ${e.customContentClass}`),M:!e.loading,N:$.value,O:j.value},j.value?{P:l.t(e.confirmButtonText||l.unref(w)("confirm")),Q:l.o(q),R:l.p({block:!0,size:"large",disabled:e.loading})}:{},{S:l.o(S),T:l.o(r=>e.scrollIntoView?U():""),U:l.o(r=>b.value=r),V:l.p({duration:250,title:e.title||l.unref(w)("title"),"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,"custom-header-class":"wd-select-picker__header",modelValue:b.value}),W:l.n(`wd-select-picker ${l.unref(M).border.value?"is-border":""} ${e.customClass}`),X:l.s(e.customStyle)})}}),te=l._export_sfc(ne,[["__scopeId","data-v-b8ce50f5"]]);wx.createComponent(te);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-select-picker/wd-select-picker.js.map
