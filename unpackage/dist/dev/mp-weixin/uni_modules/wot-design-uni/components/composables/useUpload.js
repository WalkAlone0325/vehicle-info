"use strict";const d=require("../../../../common/vendor.js"),S=require("../common/util.js"),P={PENDING:"pending",LOADING:"loading",SUCCESS:"success",FAIL:"fail"};function E(){let h=null;const p=e=>{e?e.abort():h&&(h.abort(),h=null)},U=(e,a,s)=>{s.abortPrevious&&p();const u=d.index.uploadFile({url:s.action,header:s.header,name:s.name,fileName:s.name,fileType:s.fileType,formData:a,filePath:e.url,success(n){n.statusCode===s.statusCode?s.onSuccess(n,e,a):s.onError({...n,errMsg:n.errMsg||""},e,a)},fail(n){s.onError(n,e,a)}});return h=u,u.onProgressUpdate(n=>{s.onProgress(n,e)}),u},y=(e,a)=>{const{uploadMethod:s,formData:u={},action:n,name:f="file",header:F={},fileType:g="image",statusCode:b=200,statusKey:r="status",abortPrevious:c=!1}=a;e[r]=P.LOADING;const t={action:n,header:F,name:f,fileName:f,fileType:g,statusCode:b,abortPrevious:c,onSuccess:(l,i,m)=>{var o;i[r]=P.SUCCESS,h=null,(o=a.onSuccess)==null||o.call(a,l,i,m)},onError:(l,i,m)=>{var o;i[r]=P.FAIL,i.error=l.errMsg,h=null,(o=a.onError)==null||o.call(a,l,i,m)},onProgress:(l,i)=>{var m;i.percent=l.progress,(m=a.onProgress)==null||m.call(a,l,i)}};return S.isFunction(s)?s(e,u,t):U(e,u,t)};function M(e){return S.isArray(e.tempFiles)?e.tempFiles.map(a=>({path:a.path||"",name:a.name||"",size:a.size,type:"image",thumb:a.path||""})):[{path:e.tempFiles.path||"",name:e.tempFiles.name||"",size:e.tempFiles.size,type:"image",thumb:e.tempFiles.path||""}]}function I(e){return[{path:e.tempFilePath||e.filePath||"",name:e.name||"",size:e.size,type:"video",thumb:e.thumbTempFilePath||"",duration:e.duration}]}function k(e){return e.tempFiles.map(a=>({type:a.fileType,path:a.tempFilePath,thumb:a.fileType==="video"?a.thumbTempFilePath:a.tempFilePath,size:a.size,duration:a.duration}))}function A({multiple:e,sizeType:a,sourceType:s,maxCount:u,accept:n,compressed:f,maxDuration:F,camera:g,extension:b}){return new Promise((r,c)=>{switch(n){case"image":d.index.chooseImage({count:e?Math.min(u||9,9):1,sizeType:a,sourceType:s,success:t=>r(M(t)),fail:c});break;case"video":d.index.chooseVideo({sourceType:s,compressed:f,maxDuration:F,camera:g,success:t=>r(I(t)),fail:c});break;case"media":d.index.chooseMedia({count:e?Math.min(u||9,9):1,sourceType:s,sizeType:a,camera:g,maxDuration:F,success:t=>r(k(t)),fail:c});break;case"file":d.index.chooseMessageFile({count:e?Math.min(u||100,100):1,type:n,extension:b,success:t=>r(t.tempFiles),fail:c});break;case"all":d.index.chooseMessageFile({count:e?Math.min(u||100,100):1,type:n,extension:b,success:t=>r(t.tempFiles),fail:c});break;default:d.index.chooseImage({count:e?Math.min(u||9,9):1,sizeType:a,sourceType:s,success:t=>r(M(t)),fail:c});break}})}return{startUpload:y,abort:p,UPLOAD_STATUS:P,chooseFile:A}}exports.useUpload=E;
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/composables/useUpload.js.map
