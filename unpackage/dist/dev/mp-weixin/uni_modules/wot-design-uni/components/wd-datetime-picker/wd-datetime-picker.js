"use strict";const a=require("../../../../common/vendor.js"),n=require("../common/util.js"),ne=require("../composables/useCell.js"),ue=require("../wd-datetime-picker-view/types.js"),re=require("../wd-form/types.js"),ie=require("../composables/useParent.js"),se=require("../composables/useTranslate.js"),de=require("./types.js"),Z=require("../common/dayjs.js");Array||a.resolveComponent("wd-icon")();const me=()=>"../wd-icon/wd-icon.js";Math||(me+fe+ce)();const ce=()=>"../wd-popup/wd-popup.js",fe=()=>"../wd-datetime-picker-view/wd-datetime-picker-view.js",pe={name:"wd-datetime-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}},ve=a.defineComponent({...pe,props:de.datetimePickerProps,emits:["change","open","toggle","cancel","confirm","update:modelValue"],setup(K,{expose:G,emit:Y}){const o=K,k=Y,{translate:b}=se.useTranslate("datetime-picker"),d=a.ref(),f=a.ref(),h=a.ref(""),V=a.ref(!1),y=a.ref(!0),p=a.ref(!1),_=a.ref([]),i=a.ref(""),c=a.ref(""),j=a.ref(!1),L=a.ref(!1),P=a.ref(!1),{proxy:J}=a.getCurrentInstance(),N=ne.useCell();a.watch(()=>o.modelValue,(e,l)=>{n.isEqual(e,l)||(n.isArray(e)?(p.value=!0,i.value=n.deepClone(v(!0)),c.value=n.deepClone(v(!0,!0))):i.value=n.deepClone(v()),a.nextTick$1(()=>{H(!1,!1,!0)}))},{deep:!0,immediate:!0}),a.watch(()=>o.displayFormat,e=>{e&&!n.isFunction(e)&&a.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.vue:223","The type of displayFormat must be Function")},{deep:!0,immediate:!0}),a.watch(()=>o.filter,e=>{e&&!n.isFunction(e)&&a.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.vue:235","The type of filter must be Function")},{deep:!0,immediate:!0}),a.watch(()=>o.formatter,e=>{e&&!n.isFunction(e)&&a.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.vue:247","The type of formatter must be Function")},{deep:!0,immediate:!0}),a.watch(()=>o.beforeConfirm,e=>{e&&!n.isFunction(e)&&a.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.vue:259","The type of beforeConfirm must be Function")},{deep:!0,immediate:!0}),a.watch(()=>o.displayFormatTabLabel,e=>{e&&!n.isFunction(e)&&a.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.vue:271","The type of displayFormatTabLabel must be Function")},{deep:!0,immediate:!0}),a.watch(()=>o.defaultValue,e=>{n.isArray(e)||p.value?(i.value=n.deepClone(v(!0)),c.value=n.deepClone(v(!0,!0))):i.value=n.deepClone(v())},{deep:!0,immediate:!0});const{parent:$}=ie.useParent(re.FORM_KEY),I=a.computed(()=>$&&o.prop&&$.errorMessages&&$.errorMessages[o.prop]?$.errorMessages[o.prop]:""),Q=a.computed(()=>{let e=!1;if($&&$.props.rules){const l=$.props.rules;for(const t in l)Object.prototype.hasOwnProperty.call(l,t)&&t===o.prop&&Array.isArray(l[t])&&(e=l[t].some(u=>u.required))}return o.required||o.rules.some(l=>l.required)||e});function T(e,l,t,u,s){const{type:g}=o;switch(g){case"datetime":{const[r,m,w,C,M]=s;if(l==="year")return e?t>r:t<r;if(l==="month"&&u[0]===r)return e?t>m:t<m;if(l==="date"&&u[0]===r&&u[1]===m)return e?t>w:t<w;if(l==="hour"&&u[0]===r&&u[1]===m&&u[2]===w)return e?t>C:t<C;if(l==="minute"&&u[0]===r&&u[1]===m&&u[2]===w&&u[3]===C)return e?t>M:t<M;break}case"year-month":{const[r,m]=s;if(l==="year")return e?t>r:t<r;if(l==="month"&&u[0]===r)return e?t>m:t<m;break}case"year":{const[r]=s;if(l==="year")return e?t>r:t<r;break}case"date":{const[r,m,w]=s;if(l==="year")return e?t>r:t<r;if(l==="month"&&u[0]===r)return e?t>m:t<m;if(l==="date"&&u[0]===r&&u[1]===m)return e?t>w:t<w;break}case"time":{const[r,m]=s;if(l==="hour")return e?t>r:t<r;if(l==="minute"&&u[0]===r)return e?t>m:t<m;break}}return!1}const O=e=>{if(!e)return[];const{type:l}=o,{startSymbol:t,formatter:u}=e,s=e.correctValue(i.value),g=e.correctValue(c.value),r=t?e.getPickerValue(s,l):e.getPickerValue(g,l),m=t?e.getPickerValue(g,l):e.getPickerValue(s,l);return e.getOriginColumns().map((C,M)=>C.values.map(D=>{const oe=T(t,C.type,D,r,m);return{label:u?u(C.type,n.padZero(D)):n.padZero(D),value:D,disabled:oe}}))};a.onBeforeMount(()=>{const{modelValue:e}=o;n.isArray(e)?(p.value=!0,i.value=n.deepClone(v(!0)),c.value=n.deepClone(v(!0,!0))):i.value=n.deepClone(v())}),a.onMounted(()=>{H(!1,!1,!0)});function q(e){let l=e==="before"?i.value:c.value,t=[];return l&&(t=ue.getPickerValue(l,o.type)),t.map(s=>({[o.labelKey]:n.padZero(s),[o.valueKey]:s}))}function X(){}function v(e,l){const{modelValue:t,defaultValue:u,maxDate:s,minDate:g,type:r}=o;if(e){const m=l?1:0,w=n.isArray(t)?t[m]:"",C=n.isArray(u)?u[m]:"",M=r==="time"?Z.dayjs(s).format("HH:mm"):s,D=r==="time"?Z.dayjs(g).format("HH:mm"):g;return w||C||(l?M:D)}else return n.isDef(t||u)?t||u:""}function x(){A()}function ee(){U()}function A(){o.disabled||o.readonly||(k("open"),p.value?(V.value=!0,y.value=!0,i.value=n.deepClone(v(!0,!1)),c.value=n.deepClone(v(!0,!0))):(V.value=!0,i.value=n.deepClone(v())),H(!0,!1,!0))}function B(){y.value=!y.value;const e=y.value?d.value:f.value;e.setColumns(e.updateColumns()),k("toggle",y.value?i.value:c.value)}function ae({value:e}){if(d.value&&!(p.value&&!f.value))if(p.value){const l=d.value.getPickerValue(e,o.type),t=d.value.getPickerValue(c.value,o.type),s=d.value.getOriginColumns().some((g,r)=>T(!0,g.type,l[r],l,t));i.value=n.deepClone(s?c.value:e),a.nextTick$1(()=>{_.value=[W(),n.deepClone(_.value[1])],k("change",{value:[i.value,c.value]}),d.value&&d.value.setColumns(d.value.updateColumns()),f.value&&f.value.setColumns(f.value.updateColumns())})}else i.value=n.deepClone(e),k("change",{value:i.value})}function te({value:e}){if(!d.value||!f.value)return;const l=f.value.getPickerValue(e,o.type),t=f.value.getPickerValue(i.value,o.type),s=f.value.getOriginColumns().some((g,r)=>T(!1,g.type,l[r],l,t));c.value=n.deepClone(s?i.value:e),a.nextTick$1(()=>{_.value=[n.deepClone(_.value[0]),W(1)],k("change",{value:[i.value,c.value]}),d.value&&d.value.setColumns(d.value.updateColumns()),f.value&&f.value.setColumns(f.value.updateColumns())})}function U(){V.value=!1,setTimeout(()=>{p.value?(i.value=n.deepClone(v(!0)),c.value=n.deepClone(v(!0,!0))):i.value=n.deepClone(v())},200),k("cancel")}function z(){if(o.loading||P.value)return;if(j.value){L.value=!0;return}const{beforeConfirm:e}=o;e?e(p.value?[i.value,c.value]:i.value,l=>{l&&E()},J.$.exposed):E()}function R(){j.value=!0}function S(){j.value=!1,setTimeout(()=>{L.value&&(L.value=!1,z())},50)}function E(){if(o.loading||P.value||o.disabled){V.value=!1;return}const e=p.value?[i.value,c.value]:i.value;V.value=!1,k("update:modelValue",e),k("confirm",{value:e}),H(!1,!0)}function W(e=0){if(p.value){let l=[];return e===0?l=(d.value?d.value.getSelects():void 0)||i.value&&q("before"):l=(f.value?f.value.getSelects():void 0)||c.value&&q("after"),F(l,!0)}else return""}function H(e=!1,l=!1,t=!1){if(p.value){const u=t?i.value&&q("before")||[]:d.value&&d.value.getSelects&&d.value.getSelects()||[],s=t?c.value&&q("after")||[]:f.value&&f.value.getSelects&&f.value.getSelects()||[];h.value=e?h.value:[o.modelValue[0]||l?F(u):"",o.modelValue[1]||l?F(s):""],_.value=[F(u,!0),F(s,!0)]}else{const u=t?i.value&&q("before")||[]:d.value&&d.value.getSelects&&d.value.getSelects()||[];h.value=n.deepClone(o.modelValue||l?F(u):"")}}function F(e,l=!1){if(e.length===0)return"";if(l&&o.displayFormatTabLabel)return o.displayFormatTabLabel(e);if(o.displayFormat)return o.displayFormat(e);if(o.formatter){const t={year:["year"],datetime:["year","month","date","hour","minute"],date:["year","month","date"],time:["hour","minute"],"year-month":["year","month"]};return e.map((u,s)=>o.formatter(t[o.type][s],u.value)).join("")}switch(o.type){case"year":return e[0].label;case"date":return`${e[0].label}-${e[1].label}-${e[2].label}`;case"year-month":return`${e[0].label}-${e[1].label}`;case"time":return`${e[0].label}:${e[1].label}`;case"datetime":return`${e[0].label}-${e[1].label}-${e[2].label} ${e[3].label}:${e[4].label}`}}function le(e){P.value=e}return G({open:x,close:ee,setLoading:le}),(e,l)=>a.e({a:e.$slots.default},e.$slots.default?{}:a.e({b:e.label||e.$slots.label},e.label||e.$slots.label?a.e({c:e.$slots.label},e.$slots.label?{}:{d:a.t(e.label)},{e:a.n(`wd-picker__label ${e.customLabelClass} ${Q.value?"is-required":""}`),f:a.s(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")}):{},{g:p.value},p.value?a.e({h:a.unref(n.isArray)(h.value)},a.unref(n.isArray)(h.value)?{i:a.t(h.value[0]?h.value[0]:e.placeholder||a.unref(b)("placeholder")),j:a.n(h.value[0]?"":"wd-picker__placeholder"),k:a.t(a.unref(b)("to")),l:a.t(h.value[1]?h.value[1]:e.placeholder||a.unref(b)("placeholder")),m:a.n(h.value[1]?"":"wd-picker__placeholder")}:{n:a.t(e.placeholder||a.unref(b)("placeholder"))}):{o:a.t(h.value?h.value:e.placeholder||a.unref(b)("placeholder")),p:a.n(h.value?"":"wd-picker__placeholder")},{q:a.n(`wd-picker__value ${e.customValueClass}`),r:!e.disabled&&!e.readonly},!e.disabled&&!e.readonly?{s:a.p({"custom-class":"wd-picker__arrow",name:"arrow-right"})}:{},{t:I.value},I.value?{v:a.t(I.value)}:{},{w:a.n(e.customCellClass)}),{x:a.o(A),y:a.t(e.cancelButtonText||a.unref(b)("cancel")),z:a.o(U),A:e.title},e.title?{B:a.t(e.title)}:{},{C:a.t(e.confirmButtonText||a.unref(b)("confirm")),D:a.n(`wd-picker__action ${e.loading||P.value?"is-loading":""}`),E:a.o(z),F:a.o(X),G:p.value},p.value?{H:a.t(a.unref(b)("start")),I:a.t(_.value[0]),J:a.n(`wd-picker__region ${y.value?"is-active":""} `),K:a.o(B),L:a.t(a.unref(b)("end")),M:a.t(_.value[1]),N:a.n(`wd-picker__region ${y.value?"":"is-active"}`),O:a.o(B)}:{},{P:a.sr(d,"2a8ca3bd-2,2a8ca3bd-1",{k:"datetimePickerView"}),Q:a.o(ae),R:a.o(R),S:a.o(S),T:a.o(t=>i.value=t),U:a.p({"custom-class":e.customViewClass,type:e.type,loading:e.loading||P.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":a.unref(n.isArray)(e.modelValue)?O:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!0,"immediate-change":e.immediateChange,modelValue:i.value}),V:a.n(y.value?"wd-picker__show":"wd-picker__hidden"),W:a.sr(f,"2a8ca3bd-3,2a8ca3bd-1",{k:"datetimePickerView1"}),X:a.o(te),Y:a.o(R),Z:a.o(S),aa:a.o(t=>c.value=t),ab:a.p({"custom-class":e.customViewClass,type:e.type,loading:e.loading||P.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":a.unref(n.isArray)(e.modelValue)?O:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!1,"immediate-change":e.immediateChange,modelValue:c.value}),ac:a.n(y.value?"wd-picker__hidden":"wd-picker__show"),ad:a.o(U),ae:a.o(t=>V.value=t),af:a.p({position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"safe-area-inset-bottom":e.safeAreaInsetBottom,"z-index":e.zIndex,"custom-class":"wd-picker__popup",modelValue:V.value}),ag:a.n(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${a.unref(N).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),ah:a.s(e.customStyle)})}}),he=a._export_sfc(ve,[["__scopeId","data-v-2a8ca3bd"]]);wx.createComponent(he);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.js.map
