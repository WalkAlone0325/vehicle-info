"use strict";const p=require("../../../../common/vendor.js"),a=require("../common/util.js"),R=require("../composables/useChildren.js"),U=require("../wd-toast/index.js"),C=require("./types.js");Math||j();const j=()=>"../wd-toast/wd-toast.js",V={name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}},k=p.defineComponent({...V,props:C.formProps,setup(T,{expose:D}){const{show:b}=U.useToast("wd-form-toast"),i=T,{children:h,linkChildren:v}=R.useChildren(C.FORM_KEY);let u=p.reactive({});v({props:i,errorMessages:u}),p.watch(()=>i.model,()=>{i.resetOnChange&&d()},{immediate:!0,deep:!0});async function P(s){const o=[];let e=!0;const t=[],f=q(),m=a.isArray(s)?s:a.isDef(s)?[s]:[],w=m.length>0?m.reduce((r,c)=>(f[c]&&(r[c]=f[c]),r),{}):f;for(const r in w){const c=w[r],g=a.getPropByPath(i.model,r);if(c&&c.length>0)for(const n of c){if(n.required&&(!a.isDef(g)||g==="")){o.push({prop:r,message:n.message}),e=!1;break}if(n.pattern&&!n.pattern.test(g)){o.push({prop:r,message:n.message}),e=!1;break}const{validator:y,...O}=n;if(y){const _=y(g,O);a.isPromise(_)?t.push(_.then(l=>{typeof l=="string"?(o.push({prop:r,message:l}),e=!1):typeof l=="boolean"&&!l&&(o.push({prop:r,message:n.message}),e=!1)}).catch(l=>{const x=a.isDef(l)?a.isString(l)?l:l.message||n.message:n.message;o.push({prop:r,message:x}),e=!1})):_||(o.push({prop:r,message:n.message}),e=!1)}}}return await Promise.all(t),E(o),e&&(m.length?m.forEach(d):d()),{valid:e,errors:o}}function q(){const s=a.deepClone(i.rules),o=h.map(e=>e.prop);return Object.keys(s).forEach(e=>{o.includes(e)||delete s[e]}),h.forEach(e=>{a.isDef(e.prop)&&a.isDef(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)}),s}function E(s){const o=h.map(t=>t.prop).filter(Boolean),e=s.filter(t=>t.message&&o.includes(t.prop));e.length&&(e.sort((t,f)=>o.indexOf(t.prop)-o.indexOf(f.prop)),i.errorType==="toast"?b(e[0].message):i.errorType==="message"&&e.forEach(t=>{u[t.prop]=t.message}))}function d(s){s?u[s]="":Object.keys(u).forEach(o=>{u[o]=""})}function M(){d()}return D({validate:P,reset:M}),(s,o)=>p.e({a:i.errorType==="toast"},i.errorType==="toast"?{b:p.p({selector:"wd-form-toast"})}:{},{c:p.n(`wd-form ${s.customClass}`),d:p.s(s.customStyle)})}}),B=p._export_sfc(k,[["__scopeId","data-v-6504e7d0"]]);wx.createComponent(B);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-form/wd-form.js.map
