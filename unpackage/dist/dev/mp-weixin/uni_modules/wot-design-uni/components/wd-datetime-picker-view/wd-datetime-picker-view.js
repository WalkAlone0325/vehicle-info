"use strict";const o=require("../../../../common/vendor.js"),a=require("../common/util.js"),N=require("./types.js");Math||R();const R=()=>"../wd-picker-view/wd-picker-view.js",z={name:"wd-datetime-picker-view",virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},J=o.defineComponent({...z,props:N.datetimePickerViewProps,emits:["change","pickstart","pickend","update:modelValue"],setup(F,{expose:P,emit:S}){const Z=e=>a.isDef(e)&&!Number.isNaN(e),T=(e,t)=>{let i=-1;const r=e<0?0:e,u=Array(r);for(;++i<e;)u[i]=t(i);return u},k=(e,t)=>32-new Date(e,t-1,32).getDate(),n=F,f=S,b=o.ref(),h=o.ref(null),_=o.ref([]),v=o.ref([]),C=o.ref(!1),{proxy:D}=o.getCurrentInstance();P({updateColumns:x,setColumns:q,getSelects:j,correctValue:g,getPickerValue:N.getPickerValue,getOriginColumns:$,...n});const w=a.debounce(()=>{if(!C.value)return;const e=g(n.modelValue);e===h.value?_.value=x():V(e)},50);o.watch(()=>n.modelValue,(e,t)=>{if(e===t)return;const i=g(e);V(i)},{deep:!0,immediate:!0}),o.watch(()=>n.type,e=>{const t=["date","year-month","time","datetime","year"];t.indexOf(e)===-1&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker-view/wd-datetime-picker-view.vue:126",`type must be one of ${t}`),w()},{deep:!0,immediate:!0}),o.watch(()=>n.filter,e=>{e&&!a.isFunction(e)&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker-view/wd-datetime-picker-view.vue:138","The type of filter must be Function"),w()},{deep:!0,immediate:!0}),o.watch(()=>n.formatter,e=>{e&&!a.isFunction(e)&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker-view/wd-datetime-picker-view.vue:149","The type of formatter must be Function"),w()},{deep:!0,immediate:!0}),o.watch(()=>n.columnFormatter,e=>{e&&!a.isFunction(e)&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-datetime-picker-view/wd-datetime-picker-view.vue:160","The type of columnFormatter must be Function"),w()},{deep:!0,immediate:!0}),o.watch([()=>n.minDate,()=>n.maxDate,()=>n.minHour,()=>n.maxHour,()=>n.minMinute,()=>n.minMinute,()=>n.maxMinute],()=>{w()},{deep:!0,immediate:!0}),o.onBeforeMount(()=>{C.value=!0;const e=g(n.modelValue);V(e)});function Y({value:e}){v.value=e;const t=A();f("update:modelValue",t),f("change",{value:t,picker:D.$.exposed})}function x(){const{formatter:e,columnFormatter:t}=n;return t?t(D.$.exposed):$().map(i=>i.values.map(r=>({label:e?e(i.type,a.padZero(r)):a.padZero(r),value:r})))}function q(e){_.value=e}function $(){const{filter:e}=n;return E().map(({type:t,range:i})=>{let r=T(i[1]-i[0]+1,u=>i[0]+u);return e&&(r=e(t,r)),{type:t,values:r}})}function E(){if(n.type==="time")return[{type:"hour",range:[n.minHour,n.maxHour]},{type:"minute",range:[n.minMinute,n.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:i,maxHour:r,maxMinute:u}=H("max",h.value),{minYear:m,minDate:s,minMonth:c,minHour:l,minMinute:p}=H("min",h.value),d=[{type:"year",range:[m,e]},{type:"month",range:[c,i]},{type:"date",range:[s,t]},{type:"hour",range:[l,r]},{type:"minute",range:[p,u]}];return n.type==="date"&&d.splice(3,2),n.type==="year-month"&&d.splice(2,3),n.type==="year"&&d.splice(1,4),d}function g(e){const t=n.type!=="time";if(t&&!Z(e)?e=n.minDate:!t&&!e&&(e=`${a.padZero(n.minHour)}:00`),!t){let[i,r]=(a.isString(e)?e:e.toString()).split(":");return i=a.padZero(a.range(Number(i),n.minHour,n.maxHour)),r=a.padZero(a.range(Number(r),n.minMinute,n.maxMinute)),`${i}:${r}`}return e=Math.min(Math.max(Number(e),n.minDate),n.maxDate),e}function H(e,t){const i=new Date(t),r=new Date(n[`${e}Date`]),u=r.getFullYear();let m=1,s=1,c=0,l=0;return e==="max"&&(m=12,s=k(i.getFullYear(),i.getMonth()+1),c=23,l=59),i.getFullYear()===u&&(m=r.getMonth()+1,i.getMonth()+1===m&&(s=r.getDate(),i.getDate()===s&&(c=r.getHours(),i.getHours()===c&&(l=r.getMinutes())))),{[`${e}Year`]:u,[`${e}Month`]:m,[`${e}Date`]:s,[`${e}Hour`]:c,[`${e}Minute`]:l}}function V(e){if(!e)return;const t=N.getPickerValue(e,n.type);n.modelValue!==e&&(f("update:modelValue",e),f("change",{value:e,picker:D.$.exposed})),h.value=e,_.value=x(),v.value=t}function A(){var M;const{type:e}=n;let t="";const i=((M=b.value)==null?void 0:M.getValues())||[],r=a.isArray(i)?i:[i];if(e==="time")return t=`${a.padZero(r[0])}:${a.padZero(r[1])}`,t;const u=r[0]&&parseInt(r[0]),m=e==="year"?1:r[1]&&parseInt(r[1]),s=k(Number(u),Number(m));let c=1;e!=="year-month"&&e!=="year"&&(c=(Number(r[2])&&parseInt(String(r[2])))>s?s:r[2]&&parseInt(String(r[2])));let l=0,p=0;e==="datetime"&&(l=Number(r[3])&&parseInt(r[3]),p=Number(r[4])&&parseInt(r[4]));const d=new Date(Number(u),Number(m)-1,Number(c),l,p).getTime();return t=g(d),t}function B(e){if(n.type==="time"||n.type==="year-month"||n.type==="year")return;const t=e.getValues(),i=Number(t[0]),r=Number(t[1]),u=k(i,r);let m=Number(t[2]);m=m>u?u:m;let s=0,c=0;n.type==="datetime"&&(s=Number(t[3]),c=Number(t[4]));const l=new Date(i,r-1,m,s,c).getTime();h.value=g(l);const p=x(),d=e.getSelectedIndex().slice(0);p.forEach((M,G)=>{const y=G+1,I=p[y];y>p.length-1||e.setColumnData(y,I,d[y]<=I.length-1?d[y]:0)})}function O(){f("pickstart")}function U(){f("pickend")}function j(){var t;const e=(t=b.value)==null?void 0:t.getSelects();if(e!=null)return a.isArray(e)?e:[e]}return(e,t)=>({a:o.sr(b,"db34fecd-0",{k:"datePickerview"}),b:o.o(Y),c:o.o(O),d:o.o(U),e:o.o(i=>v.value=i),f:o.p({"custom-class":e.customClass,"custom-style":e.customStyle,"immediate-change":e.immediateChange,columns:_.value,"columns-height":e.columnsHeight,columnChange:B,loading:e.loading,"loading-color":e.loadingColor,modelValue:v.value})})}}),K=o._export_sfc(J,[["__scopeId","data-v-db34fecd"]]);wx.createComponent(K);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-datetime-picker-view/wd-datetime-picker-view.js.map
