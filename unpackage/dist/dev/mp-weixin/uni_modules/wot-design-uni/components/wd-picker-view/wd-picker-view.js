"use strict";const o=require("../../../../common/vendor.js"),r=require("../common/util.js"),m=require("./types.js");Math||R();const R=()=>"../wd-loading/wd-loading.js",U={name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}},G=o.defineComponent({...U,props:m.pickerViewProps,emits:["change","pickstart","pickend","update:modelValue"],setup(b,{expose:k,emit:$}){const a=b,g=$,l=o.ref([]),y=o.ref(35),s=o.ref([]);o.watch([()=>a.modelValue,()=>a.columns],(e,t)=>{r.isEqual(t[1],e[1])||(r.isArray(e[1])&&e[1].length>0?l.value=m.formatArray(e[1],a.valueKey,a.labelKey):(l.value=[],s.value=[])),r.isDef(e[0])&&K(e[0])},{deep:!0,immediate:!0});const{proxy:h}=o.getCurrentInstance();function K(e){if(l.value.length===0){s.value=[];return}(e===""||!r.isDef(e)||r.isArray(e)&&e.length===0)&&(e=l.value.map(u=>u[0][a.valueKey]));const t=r.getType(e),n=["string","number","boolean","array"];n.indexOf(t)===-1&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-picker-view/wd-picker-view.vue:100",`value must be one of ${n.toString()}`),e=r.isArray(e)?e:[e],e=e.slice(0,l.value.length);let i=r.deepClone(s.value);e.forEach((u,d)=>{let c=l.value[d].findIndex(f=>f[a.valueKey].toString()===u.toString());c=c===-1?0:c,i=p(d,c,i)}),s.value=i.slice(0,e.length)}function w(e){let t=r.deepClone(e);return e.forEach((n,i)=>{n=r.range(n,0,l.value[i].length-1),t=p(i,n,t)}),t}function p(e,t,n){const i=l.value[e];if(!i||!i[t])throw Error(`The value to select with Col:${e} Row:${t} is incorrect`);const u=r.deepClone(n);if(u[e]=t,i[t].disabled){const d=i.slice(0,t).reverse().findIndex(f=>!f.disabled),c=i.slice(t+1).findIndex(f=>!f.disabled);d!==-1?u[e]=t-1-d:c!==-1?u[e]=t+1+c:u[e]===void 0&&(u[e]=0)}return u}function S({detail:{value:e}}){e=e.map(n=>Number(n||0));const t=A(e);s.value=r.deepClone(e),o.nextTick$1(()=>{s.value=w(e),a.columnChange?a.columnChange.length<4?(a.columnChange(h.$.exposed,C(),t||0,()=>{}),v(t||0)):a.columnChange(h.$.exposed,C(),t||0,()=>{v(t||0)}):v(t||0)})}function D(e,t){return!e||!t?-1:e.findIndex((i,u)=>i!==t[u])}function A(e){e=e.slice(0,l.value.length);const t=r.deepClone(s.value);let n=r.deepClone(s.value);e.forEach((d,c)=>{d=r.range(d,0,l.value[c].length-1),d!==t[c]&&(n=p(c,d,n))});const i=D(n,t);if(i===-1)return;const u=n[i];return n.length===1?u:i}function v(e){const t=_();r.isEqual(t,a.modelValue)||(g("update:modelValue",t),setTimeout(()=>{g("change",{picker:h.$.exposed,value:t,index:e})},0))}function C(){const e=s.value.map((t,n)=>l.value[n][t]);return e.length===1?e[0]:e}function _(){const{valueKey:e}=a,t=s.value.map((n,i)=>l.value[i][n][e]);return t.length===1?t[0]:t}function E(){const{labelKey:e}=a;return s.value.map((t,n)=>l.value[n][t][e])}function q(e){return s.value[e]}function T(e){return l.value[e]}function H(e,t,n=0){l.value[e]=m.formatArray(t,a.valueKey,a.labelKey).reduce((i,u)=>i.concat(u),[]),s.value=p(e,n,s.value)}function P(){return r.deepClone(l.value)}function V(){return s.value}function j(e){r.isArray(e)&&e.length&&(l.value=m.formatArray(e,a.valueKey,a.labelKey))}function x(){g("pickstart")}function L(){g("pickend")}return k({getSelects:C,getValues:_,setColumnData:H,getColumnsData:P,getColumnData:T,getColumnIndex:q,getLabels:E,getSelectedIndex:V,resetColumns:j}),(e,t)=>o.e({a:e.loading},e.loading?{b:o.p({color:e.loadingColor})}:{},{c:o.f(l.value,(n,i,u)=>({a:o.f(n,(d,c,f)=>({a:o.t(d[e.labelKey]),b:c,c:o.n(`wd-picker-view-column__item ${d.disabled?"wd-picker-view-column__item--disabled":""}  ${s.value[i]==c?"wd-picker-view-column__item--active":""}`)})),b:i})),d:o.s(`line-height: ${y.value}px;`),e:`height: ${y.value}px;`,f:o.s(`height: ${e.columnsHeight-20}px;`),g:s.value,h:e.immediateChange,i:o.o(S),j:o.o(x),k:o.o(L),l:o.s(`height: ${e.columnsHeight-20}px;`),m:o.n(`wd-picker-view ${e.customClass}`),n:o.s(e.customStyle)})}}),M=o._export_sfc(G,[["__scopeId","data-v-c3bc94ff"]]);wx.createComponent(M);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-picker-view/wd-picker-view.js.map
