"use strict";const o=require("../../../../common/vendor.js"),l=require("../common/util.js"),Q=require("../composables/useCell.js"),X=require("../wd-picker-view/types.js"),Z=require("../wd-form/types.js"),x=require("../composables/useParent.js"),ee=require("../composables/useTranslate.js"),oe=require("./types.js");Math||(ne+se+le)();const ne=()=>"../wd-icon/wd-icon.js",le=()=>"../wd-popup/wd-popup.js",se=()=>"../wd-picker-view/wd-picker-view.js",re={name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}},te=o.defineComponent({...re,props:oe.pickerProps,emits:["confirm","open","cancel","clear","update:modelValue"],setup(M,{expose:K,emit:U}){const{translate:g}=ee.useTranslate("picker"),n=M,c=U,t=o.ref(null),L=Q.useCell(),S=o.ref(!1),d=o.ref(!1),i=o.ref(""),a=o.ref(""),m=o.ref([]),p=o.ref([]),h=o.ref(!1),y=o.ref(!1),f=o.computed(()=>n.loading||S.value);o.watch(()=>n.displayFormat,e=>{e&&!l.isFunction(e)&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-picker/wd-picker.vue:125","The type of displayFormat must be Function"),t.value&&t.value.getSelectedIndex().length!==0&&v(n.modelValue)},{immediate:!0,deep:!0}),o.watch(()=>n.modelValue,e=>{a.value=e,v(e)},{deep:!0,immediate:!0}),o.watch(()=>n.columns,e=>{m.value=l.deepClone(e),p.value=l.deepClone(e),e.length===0?(a.value=l.isArray(n.modelValue)?[]:"",i.value=""):v(n.modelValue)},{deep:!0,immediate:!0}),o.watch(()=>n.columnChange,e=>{e&&!l.isFunction(e)&&o.index.__f__("error","at uni_modules/wot-design-uni/components/wd-picker/wd-picker.vue:174","The type of columnChange must be Function")},{deep:!0,immediate:!0});const{parent:u}=x.useParent(Z.FORM_KEY),b=o.computed(()=>u&&n.prop&&u.errorMessages&&u.errorMessages[n.prop]?u.errorMessages[n.prop]:""),j=o.computed(()=>{let e=!1;if(u&&u.props.rules){const s=u.props.rules;for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&r===n.prop&&Array.isArray(s[r])&&(e=s[r].some(T=>T.required))}return n.required||n.rules.some(s=>s.required)||e}),{proxy:z}=o.getCurrentInstance();o.onMounted(()=>{v(n.modelValue)}),o.onBeforeMount(()=>{m.value=l.deepClone(n.columns),p.value=l.deepClone(n.columns)});function v(e){l.isArray(e)&&e.length>0||l.isDef(e)&&!l.isArray(e)&&e!==""?t.value?o.nextTick$1(()=>{k(t.value.getSelects())}):k(B(e)):i.value=""}function B(e){const s=X.formatArray(n.columns,n.valueKey,n.labelKey);if(n.columns.length===0||e===""||!l.isDef(e)||l.isArray(e)&&e.length===0)return;const r=l.getType(e);if(["string","number","boolean","array"].indexOf(r)===-1)return[];e=l.isArray(e)?e:[e],e=e.slice(0,s.length),e.length===0&&(e=s.map(()=>0));let I=[];e.forEach((q,D)=>{let w=s[D].findIndex(N=>N[n.valueKey].toString()===q.toString());w=w===-1?0:w,I.push(w)});const V=I.map((q,D)=>s[D][q]);return V.length===1?V[0]:V}function O(){$()}function W(){C()}function $(){n.disabled||n.readonly||(c("open"),d.value=!0,a.value=n.modelValue,m.value=p.value)}function C(){d.value=!1,c("cancel");let e=setTimeout(()=>{clearTimeout(e),l.isDef(t.value)&&t.value.resetColumns(p.value)},300)}function A(){if(f.value)return;if(h.value){y.value=!0;return}const{beforeConfirm:e}=n;e&&l.isFunction(e)?e(a.value,s=>{s&&F()},z.$.exposed):F()}function F(){if(f.value||n.disabled){d.value=!1;return}const e=t.value.getSelects(),s=t.value.getValues(),r=t.value.getColumnsData();d.value=!1,p.value=l.deepClone(r),c("update:modelValue",s),k(e),c("confirm",{value:s,selectedItems:e})}function E({value:e}){a.value=e}function k(e){if(l.isArray(e)&&!e.length||!e)return;const{valueKey:s,labelKey:r}=n;i.value=(n.displayFormat||l.defaultDisplayFormat)(e,{valueKey:s,labelKey:r})}function R(){}function H(){h.value=!0}function G(){h.value=!1,y.value&&(y.value=!1,A())}function J(e){S.value=e}const _=o.computed(()=>n.clearable&&!n.disabled&&!n.readonly&&i.value.length);function Y(){const e=l.isArray(a.value)?[]:"";c("update:modelValue",e),c("clear")}const P=o.computed(()=>!n.disabled&&!n.readonly&&!_.value);return K({close:W,open:O,setLoading:J}),(e,s)=>o.e({a:e.useDefaultSlot},e.useDefaultSlot?{}:o.e({b:e.label||e.useLabelSlot},e.label||e.useLabelSlot?o.e({c:e.label},e.label?{d:o.t(e.label)}:{},{e:o.n(`wd-picker__label ${e.customLabelClass}  ${j.value?"is-required":""}`),f:o.s(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")}):{},{g:o.t(i.value?i.value:e.placeholder||o.unref(g)("placeholder")),h:o.n(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${i.value?"":"wd-picker__placeholder"}`),i:P.value},P.value?{j:o.p({"custom-class":"wd-picker__arrow",name:"arrow-right"})}:_.value?{l:o.p({"custom-class":"wd-picker__clear",name:"error-fill"}),m:o.o(Y)}:{},{k:_.value,n:b.value},b.value?{o:o.t(b.value)}:{}),{p:o.o($),q:o.t(e.cancelButtonText||o.unref(g)("cancel")),r:o.o(C),s:e.title},e.title?{t:o.t(e.title)}:{},{v:o.t(e.confirmButtonText||o.unref(g)("done")),w:o.n(`wd-picker__action ${f.value?"is-loading":""}`),x:o.o(A),y:o.o(R),z:o.sr(t,"e228acd5-3,e228acd5-2",{k:"pickerViewWd"}),A:o.o(E),B:o.o(H),C:o.o(G),D:o.o(r=>a.value=r),E:o.p({"custom-class":e.customViewClass,columns:m.value,loading:f.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,"column-change":e.columnChange,modelValue:a.value}),F:o.o(C),G:o.o(r=>d.value=r),H:o.p({position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,"custom-class":"wd-picker__popup",modelValue:d.value}),I:o.n(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${o.unref(L).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),J:o.s(e.customStyle)})}}),ae=o._export_sfc(te,[["__scopeId","data-v-e228acd5"]]);wx.createComponent(ae);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/wot-design-uni/components/wd-picker/wd-picker.js.map
