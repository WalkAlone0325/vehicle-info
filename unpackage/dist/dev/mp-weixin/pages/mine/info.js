"use strict";const e=require("../../common/vendor.js"),i=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js");require("../../uni_modules/wot-design-uni/locale/index.js");const _=require("../../utils/index.js"),m=require("../../utils/request.js"),p=require("../../api/common.js");if(!Array){const l=e.resolveComponent("wd-message-box"),u=e.resolveComponent("wd-toast"),t=e.resolveComponent("wd-upload"),d=e.resolveComponent("wd-cell"),o=e.resolveComponent("wd-input"),n=e.resolveComponent("wd-cell-group"),s=e.resolveComponent("wd-form");(l+u+t+d+o+n+s)()}const w=()=>"../../uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.js",g=()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js",f=()=>"../../uni_modules/wot-design-uni/components/wd-upload/wd-upload.js",y=()=>"../../uni_modules/wot-design-uni/components/wd-cell/wd-cell.js",v=()=>"../../uni_modules/wot-design-uni/components/wd-input/wd-input.js",x=()=>"../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js",h=()=>"../../uni_modules/wot-design-uni/components/wd-form/wd-form.js";Math||(w+g+f+y+v+x+h)();const b={__name:"info",setup(l){const u=i.useToast(),t=e.ref({userName:"",avatar:"",fileList:[]});e.onLoad(()=>{const o=e.index.getStorageSync("user");t.value.userName=o.userName,t.value.fileList=[{url:o.avatar}]});const d=(o,n,s)=>{e.index.uploadFile({url:m.http.config.baseURL+"system/user/profile/avatar",header:{...s.header,Authorization:`Bearer ${_.getToken()}`,"Content-Type":"multipart/form-data"},name:"avatarfile",fileName:"avatarfile",fileType:"image",formData:n,filePath:o.url,success:async a=>{const r=JSON.parse(a.data);if(r.code==200){s.onSuccess(r,o,n),t.value.fileList=[{url:r.data.imgUrl}],u.show("上传成功");const c=await p.getInfoApi();e.index.setStorageSync("user",c.data.user)}else s.onError({...r,errMsg:r.errMsg||""},o,n),u.show("上传失败")},fail(a){s.onError(a,o,n)}}).onProgressUpdate(a=>{s.onProgress(a,o)})};return(o,n)=>({a:e.o(s=>t.value.fileList=s),b:e.p({limit:1,"upload-method":d,"file-list":t.value.fileList}),c:e.p({title:"头像","title-width":"100px",prop:"fileList",rules:[{required:!0,message:"请上传头像"}]}),d:e.o(s=>t.value.userName=s),e:e.p({label:"用户名","label-width":"100px",prop:"userName",readonly:!0,clearable:!0,placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}],modelValue:t.value.userName}),f:e.p({border:!0}),g:e.sr("form","d8e5dcab-2"),h:e.p({model:t.value,errorType:"toast"})})}},q=e._export_sfc(b,[["__scopeId","data-v-d8e5dcab"]]);wx.createPage(q);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/mine/info.js.map
