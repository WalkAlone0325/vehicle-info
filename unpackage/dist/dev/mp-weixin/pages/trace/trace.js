"use strict";const e=require("../../common/vendor.js");require("../../utils/request.js");const R=require("../../api/common.js"),M=require("../../uni_modules/wot-design-uni/components/composables/useQueue.js");require("../../uni_modules/wot-design-uni/locale/index.js");const w=require("../../utils/index.js");if(!Array){const T=e.resolveComponent("wd-search"),g=e.resolveComponent("wd-radio"),d=e.resolveComponent("wd-radio-group"),h=e.resolveComponent("wd-drop-menu-item"),b=e.resolveComponent("wd-input"),f=e.resolveComponent("wd-datetime-picker"),s=e.resolveComponent("wd-cell-group"),r=e.resolveComponent("wd-button"),m=e.resolveComponent("wd-form"),c=e.resolveComponent("wd-drop-menu");(T+g+d+h+b+f+s+r+m+c)()}const V=()=>"../../uni_modules/wot-design-uni/components/wd-search/wd-search.js",O=()=>"../../uni_modules/wot-design-uni/components/wd-radio/wd-radio.js",Q=()=>"../../uni_modules/wot-design-uni/components/wd-radio-group/wd-radio-group.js",W=()=>"../../uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.js",z=()=>"../../uni_modules/wot-design-uni/components/wd-input/wd-input.js",G=()=>"../../uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.js",J=()=>"../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js",U=()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js",H=()=>"../../uni_modules/wot-design-uni/components/wd-form/wd-form.js",K=()=>"../../uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.js";Math||(V+O+Q+W+z+G+J+U+H+K)();const X={__name:"trace",setup(T){const{closeOutside:g}=M.useQueue(),d=e.ref(0),h=e.ref(null),b=e.ref(null),f=e.ref(7),s=e.ref(),r=e.ref(),m=e.ref([]),c=e.ref({}),i=e.ref([]),j=async()=>{const a=await R.getLocationApi({deptId:r.value,plateNumber:s.value});r.value?f.value=8:f.value=7,c.value=a.data,m.value=a.data.carVehicleInfoList.map((t,o)=>({iconPath:"/static/location.png",latitude:t.latitude,longitude:t.longitude,id:o+1,width:20,height:20,label:{content:t.plateNumber,borderWidth:1,borderColor:"#999",bgColor:"#fff",borderRadius:2,padding:3}})),i.value=m.value},q=()=>{},u=e.ref({plateNumber:"",date:w.getTodayTimestampRange()}),k=e.ref({}),y=e.ref([]),B=async()=>{const a=await R.getTraceApi({plateNumber:u.value.plateNumber,startDate:w.formatDateTime(u.value.date[0]),endDate:w.formatDateTime(u.value.date[1])});a.code===200&&(k.value=a.data,y.value=a.data.queryRecordLocationListOutBeanList.map((t,o)=>({width:3,arrowLine:!0,color:w.randomRgbColor(),points:S(t)})),i.value=[],i.value=x.value.map((t,o)=>({iconPath:"/static/stop.png",latitude:t.latitude,longitude:t.longitude,id:o+1,width:20,height:20,label:{content:L(t.time),borderWidth:1,borderColor:"#999",bgColor:"#fff",borderRadius:2,padding:3}})))},L=a=>{const t=Math.floor(a/864e5),o=Math.floor(a/(3600*1e3)%24),p=Math.floor(a/(60*1e3)%60),v=Math.floor(a/1e3%60),N=t?`${t}天`:"",F=o?`${o}时`:"",C=p?`${p}分`:"",D=v?`${v}秒`:"";return`${N}${F}${C}${D}`},x=e.ref([]),S=(a,t)=>{const o=[];let p=[];const v=JSON.parse(a.locations).map(n=>{const l=w.wgs84togcj02(n[0],n[1]);return o.push({str:""+l[0]+l[1],date:n[4],latitude:l[1],longitude:l[0]}),{latitude:l[1],longitude:l[0],str:""+l[0]+l[1],date:n[4]}});p=[...new Set(o.map(n=>n.str))];const N=o.find(n=>n.str==p[0]),F=o.findLast(n=>n.str==p[0]);function C(n){return new Date(n.replace(" ","T")).getTime()}const D=C(F.date)-C(N.date);return D>=3e5&&x.value.push({...F,time:D}),v},$=()=>{u.value.date=w.getTodayTimestampRange(),u.value.plateNumber="",_()},_=()=>{d.value===0?(m.value=[],c.value={},i.value=[],j(),h.value.close()):d.value===1&&(i.value=[],k.value={},y.value=[],x.value=[],B(),b.value.close())},P=()=>{!r.value&&!s.value||(s.value=void 0,r.value=void 0,_())},E=e.ref([]),A=async()=>{const a=await R.getDeptApi();E.value=a.data.filter(t=>t.pId!="0").map(t=>({label:t.name,value:t.id}))},I=(a,t)=>{d.value!==t&&(d.value=t,s.value=void 0,r.value=void 0,m.value=[],c.value={},i.value=[],k.value={},y.value=[],d.value!==1&&_())};return e.onShow(()=>{j(),A()}),(a,t)=>({a:e.o(P),b:e.o(_),c:e.o(o=>s.value=o),d:e.p({"placeholder-left":!0,"cancel-txt":"重置",placeholder:"请输入车牌号进行搜索",modelValue:s.value}),e:e.f(E.value,(o,p,v)=>({a:e.t(o.label),b:"14c2661d-4-"+v+",14c2661d-3",c:e.p({value:o.value}),d:o.value})),f:e.o(_),g:e.o(o=>r.value=o),h:e.p({shape:"button",modelValue:r.value}),i:e.sr(h,"14c2661d-1,14c2661d-0",{k:"dropRef"}),j:e.p({title:"车辆位置"}),k:e.o(o=>u.value.plateNumber=o),l:e.p({label:"车牌号","label-width":"80px",prop:"plateNumber",clearable:!0,placeholder:"请输入车牌号进行查询",modelValue:u.value.plateNumber}),m:e.o(q),n:e.o(o=>u.value.date=o),o:e.p({prop:"date","label-width":"80px",label:"日期选择",placeholder:"请选择日期",modelValue:u.value.date}),p:e.p({border:!0}),q:e.o(_),r:e.p({type:"primary"}),s:e.o($),t:e.p({type:"warning"}),v:e.sr("form","14c2661d-6,14c2661d-5"),w:e.p({model:u.value}),x:e.sr(b,"14c2661d-5,14c2661d-0",{k:"dropRef2"}),y:e.p({title:"车辆轨迹"}),z:e.o(I),A:e.p({idx:d.value}),B:e.o((...o)=>e.unref(g)&&e.unref(g)(...o)),C:y.value,D:f.value,E:c.value.longitude,F:c.value.latitude,G:i.value})}},Y=e._export_sfc(X,[["__scopeId","data-v-14c2661d"]]);wx.createPage(Y);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/trace/trace.js.map
