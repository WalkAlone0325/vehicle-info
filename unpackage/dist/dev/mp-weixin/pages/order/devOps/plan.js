"use strict";const e=require("../../../common/vendor.js");require("../../../utils/request.js");const _=require("../../../api/order.js"),y=require("../../../uni_modules/wot-design-uni/components/wd-message-box/index.js");require("../../../uni_modules/wot-design-uni/locale/index.js");if(!Array){const m=e.resolveComponent("wd-message-box"),u=e.resolveComponent("BaseLoading"),l=e.resolveComponent("wd-search"),o=e.resolveComponent("wd-sticky"),c=e.resolveComponent("wd-button"),a=e.resolveComponent("wd-card"),t=e.resolveComponent("wd-loadmore");(m+u+l+o+c+a+t)()}const b=()=>"../../../uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.js",x=()=>"../../../components/BaseLoading.js",N=()=>"../../../uni_modules/wot-design-uni/components/wd-search/wd-search.js",I=()=>"../../../uni_modules/wot-design-uni/components/wd-sticky/wd-sticky.js",j=()=>"../../../uni_modules/wot-design-uni/components/wd-button/wd-button.js",k=()=>"../../../uni_modules/wot-design-uni/components/wd-card/wd-card.js",M=()=>"../../../uni_modules/wot-design-uni/components/wd-loadmore/wd-loadmore.js";Math||(b+x+N+I+j+k+M)();const P={__name:"plan",setup(m){const u=y.useMessage(),l=e.ref(!1),o=e.ref([]),c=e.ref(0),a=e.reactive({pageNum:1,pageSize:10,order:"asc",plateNumber:""}),t=e.ref("loading");e.onReachBottom(()=>{o.value.length?o.value.length<c.value?i():o.value.length===c.value&&(t.value="finished"):t.value="error"}),e.onShow(()=>{t.value="loading",a.plateNumber="",a.pageNum=1,a.order="asc",o.value=[],c.value=0,r()});function i(){a.pageNum++,r(),t.value="loading"}const r=async()=>{l.value=!0;const s=await _.getPlanList(a);o.value=[...o.value,...s.rows],c.value=s.total,l.value=!1,o.value.length?o.value.length===c.value&&(t.value="finished"):t.value="error"},p=s=>{e.index.navigateTo({url:`/pages/order/devOps/planForm${s?`?id=${s}`:""}`})},v=s=>{if(!(s.lastMaintenance||s.nextMaintenance||s.lastInspection||s.nextInspection||s.lastInsurance||s.nextInsurance)){e.index.showToast({title:"请先完善保养信息",icon:"none"});return}u.confirm({title:"提示信息",msg:"是否确认重置车辆保养信息？"}).then(async()=>{(await _.putPlan(s.maintenancePlanId)).code==200&&(a.pageNum=1,r(),e.index.showToast({title:"重置成功",icon:"success"}),t.value="loading",a.plateNumber="",a.pageNum=1,a.order="asc",o.value=[],c.value=0,r())}).catch(()=>{e.index.__f__("log","at pages/order/devOps/plan.vue:98","点击了取消按钮")})},g=()=>{a.plateNumber&&(t.value="loading",a.pageNum=1,a.order="asc",o.value=[],c.value=0,r())},w=()=>{a.plateNumber&&(t.value="loading",a.plateNumber="",a.pageNum=1,a.order="asc",o.value=[],c.value=0,r())};return(s,h)=>e.e({a:l.value&&!o.value.length},l.value&&!o.value.length?{b:e.p({loading:l.value})}:{c:e.o(g),d:e.o(w),e:e.o(e.m(n=>a.plateNumber=n,{trim:!0},!0)),f:e.p({modelValue:a.plateNumber}),g:e.f(o.value,(n,q,d)=>e.e({a:n.plateNumber},n.plateNumber?{b:e.t(n.plateNumber)}:{},{c:e.t(n.deptName),d:e.t(n.lastMaintenance),e:e.t(n.nextMaintenance),f:e.t(n.lastInspection),g:e.t(n.nextInspection),h:e.t(n.lastInsurance),i:e.t(n.nextInsurance),j:"27ed622e-5-"+d+","+("27ed622e-4-"+d),k:e.o(f=>v(n),n.vehicleId),l:"27ed622e-4-"+d,m:n.vehicleId,n:e.o(f=>p(n.vehicleId),n.vehicleId)})),h:e.p({size:"small",type:"warning"}),i:e.o(i),j:e.p({state:t.value})})}},C=e._export_sfc(P,[["__scopeId","data-v-27ed622e"]]);wx.createPage(C);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/order/devOps/plan.js.map
