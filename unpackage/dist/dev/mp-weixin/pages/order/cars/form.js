"use strict";const e=require("../../../common/vendor.js"),C=require("../../../api/home.js"),c=require("../../../api/order.js"),N=require("../../../api/common.js");require("../../../utils/request.js");if(!Array){const g=e.resolveComponent("wd-input"),d=e.resolveComponent("wd-select-picker"),i=e.resolveComponent("BaseUpload"),t=e.resolveComponent("wd-cell"),s=e.resolveComponent("wd-datetime-picker"),l=e.resolveComponent("wd-picker"),n=e.resolveComponent("wd-cell-group"),p=e.resolveComponent("wd-button"),o=e.resolveComponent("wd-form"),v=e.resolveComponent("BaseForm");(g+d+i+t+s+l+n+p+o+v)()}const O=()=>"../../../uni_modules/wot-design-uni/components/wd-input/wd-input.js",B=()=>"../../../uni_modules/wot-design-uni/components/wd-select-picker/wd-select-picker.js",x=()=>"../../../components/BaseUpload.js",M=()=>"../../../uni_modules/wot-design-uni/components/wd-cell/wd-cell.js",A=()=>"../../../uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.js",U=()=>"../../../uni_modules/wot-design-uni/components/wd-picker/wd-picker.js",V=()=>"../../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js",E=()=>"../../../uni_modules/wot-design-uni/components/wd-button/wd-button.js",S=()=>"../../../uni_modules/wot-design-uni/components/wd-form/wd-form.js",j=()=>"../../../components/BaseForm.js";Math||(O+B+x+M+A+U+V+E+S+j)();const L={__name:"form",setup(g){const d=e.index.getStorageSync("user"),i=e.ref([]),t=e.ref(!1),s=e.ref(null),l=e.ref({collectDriverId:"",collectDriverName:"",collectVehicleId:"",returnedDriverId:"",collectPlateNumber:"",returnedDriverName:"",workOrdeStatusCode:"waiting_collect",useCarApplicationOrderId:"",applicantUserId:d.userId,applicantUserName:d.userName,collectMileage:"",returnedMileage:"",returnedTime:"",collectMileagePictureId:"",collectPlateNumberPictureId:"",remark:"",files1:[],files2:[],files3:[]}),n=e.ref({collectVehicleId:[{required:!0,message:"è¯·é€‰æ‹©é¢†å–è½¦è¾†"}],collectDriverId:[{required:!0,message:"è¯·é€‰æ‹©é¢†è½¦å¸æœº"}]}),p=async u=>{const r=await c.getOrderDetail(u);l.value={...r.data,files1:r.data.collectPlateNumberPictureId?[{ossId:r.data.collectPlateNumberPictureId,url:r.data.collectPlateNumberPictureUrl}]:[],files2:r.data.collectMileagePictureId?[{ossId:r.data.collectMileagePictureId,url:r.data.collectMileagePictureUrl}]:[],files3:r.data.returnedMileagePictureId?[{ossId:r.data.returnedMileagePictureId,url:r.data.returnedMileagePictureUrl}]:[]},b({value:l.value.useCarApplicationOrderId})},o=e.ref([]),v=async()=>{const u=await c.getEndOrderList({pageNum:1,pageSize:9999,order:"asc"});o.value=u.rows.map(r=>({...r,str:`${r.expectedPlateNumber} ${r.expectedDriverName} / ${r.approvePlateNumber||""} ${r.approveDriverName||""}`}))},b=({value:u})=>{const r=o.value.find(a=>a.useCarApplicationOrderId==u);e.index.__f__("log","at pages/order/cars/form.vue:97","ðŸš€:>> ",o.value,r),l.value.collectDriverId=r.expectedDriverId,l.value.collectDriverName=r.expectedDriverName,l.value.collectVehicleId=r.expectedVehicleId,l.value.collectPlateNumber=r.expectedPlateNumber,l.value.returnedDriverId=r.approveDriverId,l.value.returnedDriverName=r.approveDriverName,l.value.applicantUserId=r.applicantUserId,l.value.applicantUserName=r.applicantUserName},F=e.ref([]),y=async()=>{const u=await C.getCarListApi({vehicleTypeCode:l.value.vehicleTypeCode});F.value=u.rows},m=e.ref([]),h=async()=>{const u=await C.getDriverListApi();m.value=u.rows},f=e.ref([]),k=async()=>{const u=await c.getUserListApi();f.value=u.rows},D=async u=>{const r=await N.getDictApi(u);i.value=r.data},P=u=>{s.value.validate().then(async({valid:r,errors:a})=>{if(r){t.value=!0;let I;l.value.useCarWorkOrderId?(u==="collect"?l.value.workOrdeStatusCode="collect":u==="returned"&&(l.value.workOrdeStatusCode="returned"),I=await c.putOrder({useCarWorkOrderId:l.value.useCarWorkOrderId,useCarApplicationOrderId:l.value.useCarApplicationOrderId,collectVehicleId:l.value.collectVehicleId,collectPlateNumber:l.value.collectPlateNumber,collectPlateNumberPictureId:l.value.collectPlateNumberPictureId,collectDriverId:l.value.collectDriverId,collectDriverName:l.value.collectDriverName,collectMileage:l.value.collectMileage,collectMileagePictureId:l.value.collectMileagePictureId,returnedDriverId:l.value.returnedDriverId,returnedDriverName:l.value.returnedDriverName,returnedMileage:l.value.returnedMileage,returnedMileagePictureId:l.value.returnedMileagePictureId,returnedTime:l.value.returnedTime,workOrdeStatusCode:l.value.workOrdeStatusCode,applicantUserId:l.value.applicantUserId,applicantUserName:l.value.applicantUserName})):I=await c.postOrder(l.value),I.code==200&&e.index.showToast({title:"æäº¤æˆåŠŸ",icon:"success",duration:1e3,success:()=>{setTimeout(()=>{t.value=!1,e.index.navigateBack({delta:1})},1e3)}}),t.value=!1}}).catch(r=>{e.index.__f__("log","at pages/order/cars/form.vue:195",r,"error")})},w=(u,r)=>{l.value[r]=u[0].ossId},_=e.ref("");return e.onLoad(async u=>{try{e.index.showLoading({title:"åŠ è½½ä¸­..."}),await v(),_.value=u.type,u.id&&p(u.id),await D("work_orde_status"),await y(),await h(),await k(),e.index.hideLoading()}catch{e.index.hideLoading()}}),(u,r)=>e.e({a:l.value.useCarWorkOrderId},l.value.useCarWorkOrderId?{b:e.o(a=>l.value.useCarWorkOrderId=a),c:e.p({label:"ç”¨è½¦å·¥å•ç¼–å·","label-width":"100px",readonly:!0,modelValue:l.value.useCarWorkOrderId})}:{},{d:l.value.useCarWorkOrderId},l.value.useCarWorkOrderId?{e:e.o(a=>l.value.useCarApplicationOrderId=a),f:e.p({label:"ç”³è¯·å·¥å•ç¼–å·","label-width":"100px",readonly:!0,modelValue:l.value.useCarApplicationOrderId})}:{},{g:!l.value.useCarWorkOrderId},l.value.useCarWorkOrderId?{}:{h:e.o(b),i:e.o(a=>l.value.useCarApplicationOrderId=a),j:e.p({clearable:!0,type:"radio","value-key":"useCarApplicationOrderId","label-key":"str","label-width":"100px",prop:"useCarApplicationOrderId",label:"ç”³è¯·å·¥å•ç¼–å·",placeholder:"è¯·é€‰æ‹©ç”¨è½¦ç”³è¯·å·¥å•ç¼–å·",columns:o.value,filterable:!0,"show-confirm":!1,modelValue:l.value.useCarApplicationOrderId})},{k:e.o(a=>l.value.collectVehicleId=a),l:e.p({clearable:!0,type:"radio","value-key":"vehicleId","label-key":"plateNumber","label-width":"100px",prop:"collectVehicleId",label:"é¢†å–è½¦è¾†",placeholder:"è¯·é€‰æ‹©é¢†å–è½¦è¾†",columns:F.value,filterable:!0,"show-confirm":!1,modelValue:l.value.collectVehicleId}),m:e.o((...a)=>w(...a,"collectPlateNumberPictureId")),n:e.p({"file-list":l.value.files1}),o:e.p({title:"é¢†å–è½¦è¾†ç…§ç‰‡","title-width":"100px",prop:"collectPlateNumberPictureId"}),p:e.o(a=>l.value.collectDriverId=a),q:e.p({clearable:!0,type:"radio","value-key":"driverId","label-key":"driverName","label-width":"100px",prop:"collectDriverId",label:"é¢†è½¦å¸æœº",placeholder:"è¯·é€‰æ‹©é¢†è½¦å¸æœº",columns:m.value,filterable:!0,"show-confirm":!1,modelValue:l.value.collectDriverId}),r:e.o(a=>l.value.collectMileage=a),s:e.p({clearable:!0,type:"digit",label:"é¢†è½¦é‡Œç¨‹","label-width":"100px",prop:"collectMileage",placeholder:"è¯·è¾“å…¥é¢†è½¦é‡Œç¨‹",modelValue:l.value.collectMileage}),t:e.o((...a)=>w(...a,"collectMileagePictureId")),v:e.p({"file-list":l.value.files2}),w:e.p({title:"é¢†è½¦é‡Œç¨‹ç…§ç‰‡","title-width":"100px",prop:"collectMileagePictureId"}),x:e.o(a=>l.value.returnedDriverId=a),y:e.p({clearable:!0,type:"radio","value-key":"driverId","label-key":"driverName","label-width":"100px",prop:"returnedDriverId",label:"è¿˜è½¦å¸æœº",placeholder:"è¯·é€‰æ‹©è¿˜è½¦å¸æœº",columns:m.value,filterable:!0,"show-confirm":!1,modelValue:l.value.returnedDriverId}),z:e.o(a=>l.value.returnedMileage=a),A:e.p({clearable:!0,type:"digit",label:"è¿˜è½¦é‡Œç¨‹","label-width":"100px",prop:"returnedMileage",placeholder:"è¯·è¾“å…¥è¿˜è½¦é‡Œç¨‹",modelValue:l.value.returnedMileage}),B:e.o(a=>l.value.returnedTime=a),C:e.p({clearable:!0,label:"è¿˜è½¦æ—¶é—´","label-width":"100px",placeholder:"è¯·é€‰æ‹©è¿˜è½¦æ—¶é—´",prop:"returnedTime",modelValue:l.value.returnedTime}),D:e.o((...a)=>w(...a,"returnedMileagePictureId")),E:e.p({"file-list":l.value.files3}),F:e.p({title:"è¿˜è½¦é‡Œç¨‹ç…§ç‰‡","title-width":"100px",prop:"returnedMileagePictureId"}),G:e.o(a=>l.value.workOrdeStatusCode=a),H:e.p({clearable:!0,label:"å·¥å•çŠ¶æ€",placeholder:"è¯·é€‰æ‹©å·¥å•çŠ¶æ€","value-key":"dictValue","label-key":"dictLabel","label-width":"100px",prop:"workOrdeStatusCode",columns:i.value,modelValue:l.value.workOrdeStatusCode}),I:e.o(a=>l.value.applicantUserId=a),J:e.p({clearable:!0,type:"radio","value-key":"userId","label-key":"userName","label-width":"100px",prop:"applicantUserId",label:"ç”³è¯·äºº",placeholder:"è¯·é€‰æ‹©ç”³è¯·äºº",columns:f.value,filterable:!0,"show-confirm":!1,modelValue:l.value.applicantUserId}),K:e.o(a=>l.value.remark=a),L:e.p({label:"å¤‡æ³¨","label-width":"100px",prop:"remark",clearable:!0,placeholder:"è¯·è¾“å…¥å¤‡æ³¨",modelValue:l.value.remark}),M:e.p({border:!0}),N:_.value!=="returned"},_.value!=="returned"?{O:e.o(P),P:e.p({type:"primary",loading:t.value})}:{},{Q:e.sr(s,"1260d45c-1,1260d45c-0",{k:"form"}),R:e.p({model:l.value,rules:n.value,errorType:"toast"})})}},T=e._export_sfc(L,[["__scopeId","data-v-1260d45c"]]);wx.createPage(T);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/order/cars/form.js.map
