"use strict";const e=require("../../common/vendor.js"),m=require("../../common/assets.js"),f=require("../../utils/jsencrypt.js");require("../../utils/request.js");const d=require("../../api/common.js");if(!Array){const l=e.resolveComponent("wd-navbar"),n=e.resolveComponent("wd-button"),u=e.resolveComponent("wd-input"),a=e.resolveComponent("wd-cell-group"),t=e.resolveComponent("wd-form");(l+n+u+a+t)()}const x=()=>"../../uni_modules/wot-design-uni/components/wd-navbar/wd-navbar.js",v=()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js",y=()=>"../../uni_modules/wot-design-uni/components/wd-input/wd-input.js",b=()=>"../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js",h=()=>"../../uni_modules/wot-design-uni/components/wd-form/wd-form.js";Math||(x+v+y+b+h)();const C={__name:"login",setup(l){const n=e.reactive({username:"",password:"",xcxCode:""}),u=e.ref(),a=e.ref(!1),t=e.ref(!1),i=e.ref(!0);function g(){u.value.validate().then(async({valid:s,errors:r})=>{if(s){a.value=!0,n.xcxCode=await c();const o={username:n.username,password:f.encrypt(n.password),xcxCode:n.xcxCode};e.index.__f__("log","at pages/login/login.vue:30","ğŸš€:>> data: ",o);const _=await d.loginApi(o);if(_.code===200){e.index.setStorageSync("token",_.data.token);const p=await d.getInfoApi();e.index.setStorageSync("user",p.data.user),e.index.setStorageSync("roles",p.data.permissions),e.index.switchTab({url:"/pages/index/index"})}a.value=!1}}).catch(s=>{e.index.__f__("log","at pages/login/login.vue:45",s,"error"),a.value=!1})}const c=()=>new Promise((s,r)=>{e.index.login({provider:"weixin",onlyAuthorize:!0,success:o=>{o.code?(e.index.__f__("log","at pages/login/login.vue:57","ğŸš€:>> code: ",o.code),s(o.code)):(e.index.__f__("log","at pages/login/login.vue:60","ç™»å½•å¤±è´¥ï¼"+o.errMsg),r(o.errMsg))},fail:o=>{e.index.__f__("log","at pages/login/login.vue:65",o),r(o)}})}),w=async()=>{t.value=!0,n.xcxCode=await c();const s=await d.oneLoginApi(n.xcxCode);if(s.code===200){e.index.setStorageSync("token",s.data.token);const r=await d.getInfoApi();e.index.setStorageSync("user",r.data.user),e.index.switchTab({url:"/pages/index/index"}),t.value=!1}else i.value=!1,e.index.showToast({title:"å¾®ä¿¡æˆæƒå¤±è´¥",icon:"none"}),t.value=!1};return(s,r)=>e.e({a:m._imports_0$2,b:e.p({bordered:!1,fixed:!0,placeholder:!0,safeAreaInsetTop:!0}),c:i.value},i.value?{d:e.o(w),e:e.p({loading:t.value,"custom-class":"one-login-btn"})}:{},{f:!i.value},i.value?{}:{g:m._imports_1$2,h:e.o(o=>n.username=o),i:e.p({label:"è´¦å·","label-width":"70px",prop:"username",clearable:!0,placeholder:"è¯·è¾“å…¥è´¦å·",rules:[{required:!0,message:"è¯·å¡«å†™è´¦å·"}],modelValue:n.username}),j:e.o(o=>n.password=o),k:e.p({label:"å¯†ç ","label-width":"70px",prop:"password","show-password":!0,placeholder:"è¯·è¾“å…¥å¯†ç ",rules:[{required:!0,message:"è¯·å¡«å†™å¯†ç "}],modelValue:n.password}),l:e.p({border:!0}),m:e.o(g),n:e.p({type:"primary",loading:a.value,block:!0}),o:e.sr(u,"e4e4508d-2",{k:"form"}),p:e.p({model:n,errorType:"toast"})})}},S=e._export_sfc(C,[["__scopeId","data-v-e4e4508d"]]);wx.createPage(S);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map
