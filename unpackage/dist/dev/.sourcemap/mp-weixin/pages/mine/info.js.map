{"version":3,"file":"info.js","sources":["pages/mine/info.vue","pages/mine/info.vue?type=page"],"sourcesContent":["<script setup>\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { useToast } from '@/uni_modules/wot-design-uni'\nimport { getToken } from '@/utils'\nimport { getInfoApi } from '@/api'\nimport http from '@/utils/request'\n\nconst toast = useToast()\n\nconst model = ref({\n  userName: '',\n  avatar: '',\n  fileList: []\n})\n\nconst handleSubmit = () => { }\n\nonLoad(() => {\n  const info = uni.getStorageSync('user')\n  model.value.userName = info.userName\n  model.value.fileList = [{ url: info.avatar }]\n})\n\nconst customUpload = (file, formData, options) => {\n  const uploadTask = uni.uploadFile({\n    url: http.config.baseURL + 'system/user/profile/avatar',\n    // url: 'https://sxnmggz.com:8448/prod-api/system/oss/upload',\n    header: {\n      ...options.header,\n      Authorization: `Bearer ${getToken()}`,\n      'Content-Type': 'multipart/form-data'\n    },\n    name: 'avatarfile',\n    fileName: 'avatarfile',\n    fileType: 'image',\n    formData,\n    filePath: file.url,\n    success: async (res) => {\n      const e = JSON.parse(res.data)\n      if (e.code == 200) {\n        // 设置上传成功\n        options.onSuccess(e, file, formData)\n        model.value.fileList = [{ url: e.data.imgUrl }]\n        toast.show('上传成功')\n        const info = await getInfoApi()\n        uni.setStorageSync('user', info.data.user)\n      } else {\n        // 设置上传失败\n        options.onError({ ...e, errMsg: e.errMsg || '' }, file, formData)\n        toast.show('上传失败')\n      }\n    },\n    fail(err) {\n      // 设置上传失败\n      options.onError(err, file, formData)\n    }\n  })\n  // 设置当前文件加载的百分比\n  uploadTask.onProgressUpdate((res) => {\n    options.onProgress(res, file)\n  })\n}\n\n</script>\n\n<template>\n  <view class=\"info-page\">\n    <view class=\"form-con\">\n      <wd-message-box />\n      <wd-toast />\n      <wd-form ref=\"form\" :model=\"model\" errorType=\"toast\">\n        <!-- <view style=\"margin-top: 30rpx;\"> -->\n        <wd-cell-group border>\n          <wd-cell title=\"头像\" title-width=\"100px\" prop=\"fileList\" :rules=\"[{ required: true, message: '请上传头像' }]\">\n            <view style=\"display: flex; flex-direction: column;\">\n              <wd-upload v-model:file-list=\"model.fileList\" :limit=\"1\" :upload-method=\"customUpload\"></wd-upload>\n              <!-- <wd-button style=\"margin-top: 20rpx; width: 50%;\" size=\"small\" @click=\"onUploadClick()\">开始上传</wd-button> -->\n            </view>\n          </wd-cell>\n          <wd-input label=\"用户名\" label-width=\"100px\" prop=\"userName\" readonly clearable v-model=\"model.userName\"\n            placeholder=\"请输入用户名\" :rules=\"[{ required: true, message: '请填写用户名' }]\" />\n        </wd-cell-group>\n        <view class=\"footer\">\n          <!-- <wd-button type=\"primary\" @click=\"handleSubmit\" block>提交</wd-button> -->\n        </view>\n        <!-- </view> -->\n      </wd-form>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n.info-page {\n  height: 100%;\n  background-color: #eee;\n\n  .form-con {\n\n    .footer {\n      padding: 0 30rpx;\n      margin-top: 50rpx;\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/mine/info.vue'\nwx.createPage(MiniProgramPage)"],"names":["useToast","ref","onLoad","uni","http","getToken","getInfoApi"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,UAAM,QAAQA,kDAAAA,SAAU;AAExB,UAAM,QAAQC,cAAAA,IAAI;AAAA,MAChB,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU,CAAE;AAAA,IACd,CAAC;AAIDC,kBAAAA,OAAO,MAAM;AACX,YAAM,OAAOC,cAAAA,MAAI,eAAe,MAAM;AACtC,YAAM,MAAM,WAAW,KAAK;AAC5B,YAAM,MAAM,WAAW,CAAC,EAAE,KAAK,KAAK,QAAQ;AAAA,IAC9C,CAAC;AAED,UAAM,eAAe,CAAC,MAAM,UAAU,YAAY;AAChD,YAAM,aAAaA,cAAG,MAAC,WAAW;AAAA,QAChC,KAAKC,cAAI,KAAC,OAAO,UAAU;AAAA;AAAA,QAE3B,QAAQ;AAAA,UACN,GAAG,QAAQ;AAAA,UACX,eAAe,UAAUC,YAAQ,SAAA,CAAE;AAAA,UACnC,gBAAgB;AAAA,QACjB;AAAA,QACD,MAAM;AAAA,QACN,UAAU;AAAA,QACV,UAAU;AAAA,QACV;AAAA,QACA,UAAU,KAAK;AAAA,QACf,SAAS,OAAO,QAAQ;AACtB,gBAAM,IAAI,KAAK,MAAM,IAAI,IAAI;AAC7B,cAAI,EAAE,QAAQ,KAAK;AAEjB,oBAAQ,UAAU,GAAG,MAAM,QAAQ;AACnC,kBAAM,MAAM,WAAW,CAAC,EAAE,KAAK,EAAE,KAAK,QAAQ;AAC9C,kBAAM,KAAK,MAAM;AACjB,kBAAM,OAAO,MAAMC,sBAAY;AAC/BH,0BAAAA,MAAI,eAAe,QAAQ,KAAK,KAAK,IAAI;AAAA,UACjD,OAAa;AAEL,oBAAQ,QAAQ,EAAE,GAAG,GAAG,QAAQ,EAAE,UAAU,GAAE,GAAI,MAAM,QAAQ;AAChE,kBAAM,KAAK,MAAM;AAAA,UAClB;AAAA,QACF;AAAA,QACD,KAAK,KAAK;AAER,kBAAQ,QAAQ,KAAK,MAAM,QAAQ;AAAA,QACpC;AAAA,MACL,CAAG;AAED,iBAAW,iBAAiB,CAAC,QAAQ;AACnC,gBAAQ,WAAW,KAAK,IAAI;AAAA,MAChC,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7DA,GAAG,WAAW,eAAe;"}