{"version":3,"file":"notice.js","sources":["pages/mine/notice.vue","pages/mine/notice.vue?type=page"],"sourcesContent":["<script setup>\nimport { ref, reactive } from 'vue'\nimport { getNoticeApi } from '@/api'\nimport { onShow, onReachBottom } from '@dcloudio/uni-app'\nimport { useMessage } from '@/uni_modules/wot-design-uni'\nimport { getDaysAgo } from '@/utils'\nconst message = useMessage()\n\nconst loading = ref(false)\nconst list = ref([])\nconst total = ref(0)\nconst queryParams = reactive({\n  pageNum: 1,\n  pageSize: 10,\n  order: 'asc',\n  plateNumber: ''\n})\n\nconst state = ref('loading')\n\nonReachBottom(() => {\n  if (!list.value.length) {\n    state.value = 'error'\n  } else if (list.value.length < total.value) {\n    loadmore()\n  } else if (list.value.length === total.value) {\n    state.value = 'finished'\n  }\n})\n\nonShow(() => {\n  state.value = 'loading'\n  queryParams.plateNumber = ''\n  queryParams.pageNum = 1\n  queryParams.order = 'asc'\n  list.value = []\n  total.value = 0\n  getData()\n})\n\nfunction loadmore() {\n  queryParams.pageNum++\n  getData()\n  state.value = 'loading'\n}\n\nconst getData = async () => {\n  loading.value = true\n  const res = await getNoticeApi(queryParams)\n  list.value = [...list.value, ...res.rows]\n  total.value = res.total\n  loading.value = false\n  if (!list.value.length) {\n    state.value = 'error'\n  } else if (list.value.length === total.value) {\n    state.value = 'finished'\n  }\n}\n\n// 详情\nconst clickToDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/order/devOps/planForm${id ? `?id=${id}` : ''}`\n  })\n}\n\n// 搜索\nconst search = () => {\n  if(queryParams.plateNumber) {\n    state.value = 'loading'\n    queryParams.pageNum = 1\n    queryParams.order = 'asc'\n    list.value = []\n    total.value = 0\n    getData()\n  }\n}\n// 取消搜索\nconst cancel = () => {\n  if(queryParams.plateNumber) {\n    state.value = 'loading'\n    queryParams.plateNumber = ''\n    queryParams.pageNum = 1\n    queryParams.order = 'asc'\n    list.value = []\n    total.value = 0\n    getData()\n  }\n}\n</script>\n\n\n<template>\n  <view class=\"warning-page\">\n    <wd-message-box />\n    <BaseLoading :loading=\"loading\" v-if=\"loading && !list.length\" />\n    <view class=\"list-con\" v-else>\n\n      <wd-sticky>\n        <view style=\"margin-bottom: 30rpx; width: 100vw;\">\n          <wd-search v-model.trim=\"queryParams.plateNumber\" placeholder=\"请输入车牌号\" @search=\"search\" @cancel=\"cancel\" />\n        </view>\n      </wd-sticky>\n\n      <view class=\"list-item\" v-for=\"i in list\" :key=\"i.maintenanceWarningId\">\n        <wd-card>\n          <template #title>\n            <view style=\"display: flex; justify-content: space-between; align-items: center\">\n              <view class=\"flex-col-c\">\n                <view class=\"plate-number\" v-if=\"i.maintenanceRecordTypeName\">{{ i.maintenanceRecordTypeName + '到期告警' }}</view>\n              </view>\n              <view class=\"right\">\n                <!-- <view class=\"label\">状态：</view> -->\n                <wd-tag custom-class=\"space\" :type=\"i.maintenanceStatusName === '正常' ? 'success' : 'danger'\">{{ i.maintenanceStatusName }}</wd-tag>\n                <!-- <view class=\"value\">{{ i.maintenanceStatusName }}</view> -->\n              </view>\n            </view>\n          </template>\n          <view class=\"main\">\n            <view class=\"content\">\n              <view class=\"content-item pd\">\n                <view class=\"label\">单位：</view>\n                <view class=\"value\">{{ i.deptName }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">车牌号码：</view>\n                <view class=\"value\">{{ i.plateNumber || '无' }}</view>\n              </view>\n              <view style=\"display: flex; justify-content: space-between;\">\n                <view class=\"content-item pd\">\n                  <view class=\"label\">到期时间：</view>\n                  <view class=\"value\">{{ i.maintenanceDate }}</view>\n                </view>\n                <view class=\"content-item pd\">\n                  <view class=\"value\">{{ getDaysAgo(i.maintenanceDate) }}</view>\n                </view>\n              </view>\n            </view>\n          </view>\n        </wd-card>\n      </view>\n      <wd-loadmore :state=\"state\" @reload=\"loadmore\" />\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n::v-deep(.wd-tag) {\n  font-size: 14px;\n}\n\n.warning-page {\n  ::v-deep .wd-card__title-content {\n    padding: 20rpx 0;\n  }\n\n  .list-con {\n    .plate-number {\n      padding: 10rpx 10rpx;\n      color: #fff;\n      background-color: #597fe8;\n      border-radius: 10rpx;\n      font-size: 26rpx;\n    }\n\n    .main {\n      display: flex;\n    }\n\n    .content {\n      flex: 1;\n      .content-item {\n        display: flex;\n        margin-bottom: 8rpx;\n\n        &:last-child {\n          padding-bottom: 12rpx;\n        }\n\n        .value {\n          color: #333;\n        }\n      }\n    }\n  }\n}\n\n\nimage {\n  display: block;\n  width: 120px;\n  height: 78px;\n  margin-right: 15px;\n}\n\n.right {\n  display: flex;\n}\n\n.space {\n  padding: 8rpx 8rpx;\n  font-size: 28rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/mine/notice.vue'\nwx.createPage(MiniProgramPage)"],"names":["useMessage","loading","ref","list","total","queryParams","reactive","state","onReachBottom","loadmore","onShow","getData","res","getNoticeApi","search","cancel","MiniProgramPage"],"mappings":"wnCAMgBA,EAAAA,WAAY,EAE5B,MAAMC,EAAUC,EAAG,IAAC,EAAK,EACnBC,EAAOD,EAAG,IAAC,EAAE,EACbE,EAAQF,EAAG,IAAC,CAAC,EACbG,EAAcC,EAAAA,SAAS,CAC3B,QAAS,EACT,SAAU,GACV,MAAO,MACP,YAAa,EACf,CAAC,EAEKC,EAAQL,EAAG,IAAC,SAAS,EAE3BM,EAAAA,cAAc,IAAM,CACbL,EAAK,MAAM,OAELA,EAAK,MAAM,OAASC,EAAM,MACnCK,EAAU,EACDN,EAAK,MAAM,SAAWC,EAAM,QACrCG,EAAM,MAAQ,YAJdA,EAAM,MAAQ,OAMlB,CAAC,EAEDG,EAAAA,OAAO,IAAM,CACXH,EAAM,MAAQ,UACdF,EAAY,YAAc,GAC1BA,EAAY,QAAU,EACtBA,EAAY,MAAQ,MACpBF,EAAK,MAAQ,CAAE,EACfC,EAAM,MAAQ,EACdO,EAAS,CACX,CAAC,EAED,SAASF,GAAW,CAClBJ,EAAY,UACZM,EAAS,EACTJ,EAAM,MAAQ,SAChB,CAEA,MAAMI,EAAU,SAAY,CAC1BV,EAAQ,MAAQ,GAChB,MAAMW,EAAM,MAAMC,EAAY,aAACR,CAAW,EAC1CF,EAAK,MAAQ,CAAC,GAAGA,EAAK,MAAO,GAAGS,EAAI,IAAI,EACxCR,EAAM,MAAQQ,EAAI,MAClBX,EAAQ,MAAQ,GACXE,EAAK,MAAM,OAELA,EAAK,MAAM,SAAWC,EAAM,QACrCG,EAAM,MAAQ,YAFdA,EAAM,MAAQ,OAIlB,EAUMO,EAAS,IAAM,CAChBT,EAAY,cACbE,EAAM,MAAQ,UACdF,EAAY,QAAU,EACtBA,EAAY,MAAQ,MACpBF,EAAK,MAAQ,CAAE,EACfC,EAAM,MAAQ,EACdO,EAAS,EAEb,EAEMI,EAAS,IAAM,CAChBV,EAAY,cACbE,EAAM,MAAQ,UACdF,EAAY,YAAc,GAC1BA,EAAY,QAAU,EACtBA,EAAY,MAAQ,MACpBF,EAAK,MAAQ,CAAE,EACfC,EAAM,MAAQ,EACdO,EAAS,EAEb,2vBCvFA,GAAG,WAAWK,CAAe"}