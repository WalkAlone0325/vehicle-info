{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<script setup>\r\nimport { reactive, ref } from 'vue'\r\nimport { encrypt } from '@/utils/jsencrypt'\r\nimport { loginApi, getInfoApi, oneLoginApi } from '@/api'\r\n\r\nconst model = reactive({\r\n  username: '',\r\n  password: '',\r\n  xcxCode: ''\r\n})\r\n\r\nconst form = ref()\r\nconst loading = ref(false)\r\nconst oneLoading = ref(false)\r\nconst oneLogin = ref(true)\r\n\r\nfunction handleSubmit() {\r\n  form.value.validate().then(async ({\r\n    valid,\r\n    errors\r\n  }) => {\r\n    if (valid) {\r\n      loading.value = true\r\n      model.xcxCode = await getWxCode()\r\n      const data = {\r\n        username: model.username,\r\n        password: encrypt(model.password),\r\n        xcxCode: model.xcxCode\r\n      }\r\n      console.log('üöÄ:>> data: ', data)\r\n      const res = await loginApi(data)\r\n      if (res.code === 200) {\r\n        uni.setStorageSync('token', res.data.token)\r\n        const info = await getInfoApi()\r\n        uni.setStorageSync('user', info.data.user)\r\n        uni.setStorageSync('roles', info.data.permissions)\r\n        uni.switchTab({\r\n          url: '/pages/index/index'\r\n        })\r\n      }\r\n      loading.value = false\r\n    }\r\n  })\r\n    .catch((error) => {\r\n      console.log(error, 'error')\r\n      loading.value = false\r\n    })\r\n}\r\n\r\nconst getWxCode = () => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.login({\r\n      provider: 'weixin',\r\n      onlyAuthorize: true,\r\n      success: (res) => {\r\n        if (res.code) {\r\n          console.log('üöÄ:>> code: ', res.code)\r\n          resolve(res.code)\r\n        } else {\r\n          console.log('ÁôªÂΩïÂ§±Ë¥•ÔºÅ' + res.errMsg)\r\n          reject(res.errMsg)\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        console.log(err)\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nconst handleOneLogin = async () => {\r\n  oneLoading.value = true\r\n  model.xcxCode = await getWxCode()\r\n  const resD = await oneLoginApi(model.xcxCode)\r\n  if (resD.code === 200) {\r\n    uni.setStorageSync('token', resD.data.token)\r\n    const info = await getInfoApi()\r\n    uni.setStorageSync('user', info.data.user)\r\n    uni.switchTab({\r\n      url: '/pages/index/index'\r\n    })\r\n    oneLoading.value = false\r\n  } else {\r\n    oneLogin.value = false\r\n    uni.showToast({\r\n      title: 'ÂæÆ‰ø°ÊéàÊùÉÂ§±Ë¥•',\r\n      icon: 'none'\r\n    })\r\n    oneLoading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <view class=\"login-page\">\r\n    <image class=\"login-bg\" src=\"/static/login.jpg\" />\r\n    <!-- <image class=\"login-bg-header\" src=\"/static/lgheader.jpg\" /> -->\r\n\r\n    <wd-navbar :bordered=\"false\" fixed placeholder safeAreaInsetTop>\r\n      <template #left>\r\n        <!-- <view class=\"\" @click=\"clickToHome\">\r\n          <wd-icon custom-class=\"icon-con\" name=\"home\" color=\"#000\" size=\"22px\" />\r\n        </view> -->\r\n      </template>\r\n      <template #title>\r\n        <view class=\"lg-title\">ÁôªÂΩï</view>\r\n      </template>\r\n    </wd-navbar>\r\n\r\n    <view class=\"one-login\" v-if=\"oneLogin\">\r\n      <!-- <view class=\"title-con\">Êô∫ËÉΩÊ≤πÊú∫ËøêÁª¥Âπ≥Âè∞</view> -->\r\n      <wd-button :loading=\"oneLoading\" custom-class=\"one-login-btn\" @click=\"handleOneLogin\">ÂæÆ‰ø°ÊéàÊùÉ‰∏ÄÈîÆÁôªÂΩï</wd-button>\r\n      <!-- <view class=\"one-login-btn\" @click=\"handleOneLogin\">ÂæÆ‰ø°ÊéàÊùÉ‰∏ÄÈîÆÁôªÂΩï</view> -->\r\n    </view>\r\n\r\n    <view class=\"login-con\" v-if=\"!oneLogin\">\r\n      <image class=\"log-header-img\" src=\"/static/log-header.jpg\" />\r\n      <view class=\"login-form\">\r\n        <wd-form ref=\"form\" :model=\"model\" errorType=\"toast\">\r\n          <view class=\"title\">Ëá™Âä®ÁªòÂõæÊï∞ÊçÆÈááÈõÜ‰∏äÊä•Á≥ªÁªü</view>\r\n          <wd-cell-group border>\r\n            <wd-input label=\"Ë¥¶Âè∑\" label-width=\"70px\" prop=\"username\" clearable v-model=\"model.username\" placeholder=\"ËØ∑ËæìÂÖ•Ë¥¶Âè∑\"\r\n              :rules=\"[{ required: true, message: 'ËØ∑Â°´ÂÜôË¥¶Âè∑' }]\" />\r\n            <wd-input label=\"ÂØÜÁ†Å\" label-width=\"70px\" prop=\"password\" show-password v-model=\"model.password\"\r\n              placeholder=\"ËØ∑ËæìÂÖ•ÂØÜÁ†Å\" :rules=\"[{ required: true, message: 'ËØ∑Â°´ÂÜôÂØÜÁ†Å' }]\" />\r\n          </wd-cell-group>\r\n          <view class=\"footer\">\r\n            <wd-button type=\"primary\" :loading=\"loading\" @click=\"handleSubmit\" block>ÁôªÂΩï</wd-button>\r\n          </view>\r\n        </wd-form>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-page {\r\n  width: 100%;\r\n  height: 100vh;\r\n  max-height: 100vh;\r\n  overflow-y: hidden;\r\n  // background: linear-gradient(135deg, #3498db, #2c3e50);\r\n\r\n  .login-bg {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 120%;\r\n    height: 100%;\r\n    margin-left: -5%;\r\n    z-index: 2;\r\n    opacity: 0.8;\r\n    overflow-x: hidden;\r\n  }\r\n\r\n  .login-bg-header {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100vw;\r\n    z-index: 3;\r\n    opacity: 1;\r\n  }\r\n\r\n  .one-login {\r\n    position: absolute;\r\n    width: 100%;\r\n    left: 15%;\r\n    right: 15%;\r\n    top: 40%;\r\n    opacity: 1;\r\n    z-index: 999;\r\n\r\n    :deep() {\r\n      .one-login-btn {\r\n        width: 540rpx;\r\n        line-height: 80rpx;\r\n        height: 80rpx;\r\n        color: #fff;\r\n        font-size: 30rpx;\r\n        background-color: #3c689e;\r\n        text-align: center;\r\n        border-radius: 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  .login-con {\r\n    opacity: 1;\r\n    z-index: 999;\r\n    position: absolute;\r\n    left: 6%;\r\n    right: 6%;\r\n    top: 25%;\r\n    background-color: #fff;\r\n    border-radius: 20rpx;\r\n\r\n    .log-header-img {\r\n      border-radius: 20rpx 20rpx 0 0 ;\r\n      width: 100%;\r\n      height: 300rpx;\r\n      margin: 0 auto;\r\n    }\r\n\r\n    .login-form {\r\n      padding: 10rpx 20rpx;\r\n      padding-top: 40rpx;\r\n    }\r\n\r\n    .title {\r\n      padding-bottom: 40rpx;\r\n      text-align: center;\r\n      font-size: 34rpx;\r\n      font-weight: 500;\r\n      color: #333;\r\n    }\r\n  }\r\n\r\n  .footer {\r\n    padding: 24rpx;\r\n    padding-bottom: 40rpx;\r\n  }\r\n\r\n  :deep() {\r\n    .wd-navbar {\r\n      background: transparent;\r\n    }\r\n  }\r\n\r\n  .icon-con {\r\n     padding: 12rpx;\r\n     background-color: #b6b6b6;\r\n     border-radius: 50%;\r\n  }\r\n\r\n  .lg-title {\r\n    font-size: 32rpx;\r\n    font-weight: 400;\r\n    color: #333;\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n\r\n</style>\r\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","encrypt","uni","loginApi","getInfoApi","oneLoginApi"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAKA,UAAM,QAAQA,cAAAA,SAAS;AAAA,MACrB,UAAU;AAAA,MACV,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAC;AAED,UAAM,OAAOC,cAAAA,IAAK;AAClB,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,aAAaA,cAAG,IAAC,KAAK;AAC5B,UAAM,WAAWA,cAAG,IAAC,IAAI;AAEzB,aAAS,eAAe;AACtB,WAAK,MAAM,SAAU,EAAC,KAAK,OAAO;AAAA,QAChC;AAAA,QACA;AAAA,MACJ,MAAQ;AACJ,YAAI,OAAO;AACT,kBAAQ,QAAQ;AAChB,gBAAM,UAAU,MAAM,UAAW;AACjC,gBAAM,OAAO;AAAA,YACX,UAAU,MAAM;AAAA,YAChB,UAAUC,gBAAAA,QAAQ,MAAM,QAAQ;AAAA,YAChC,SAAS,MAAM;AAAA,UAChB;AACDC,wBAAAA,MAAY,MAAA,OAAA,+BAAA,gBAAgB,IAAI;AAChC,gBAAM,MAAM,MAAMC,WAAQ,SAAC,IAAI;AAC/B,cAAI,IAAI,SAAS,KAAK;AACpBD,0BAAAA,MAAI,eAAe,SAAS,IAAI,KAAK,KAAK;AAC1C,kBAAM,OAAO,MAAME,sBAAY;AAC/BF,0BAAAA,MAAI,eAAe,QAAQ,KAAK,KAAK,IAAI;AACzCA,0BAAAA,MAAI,eAAe,SAAS,KAAK,KAAK,WAAW;AACjDA,0BAAAA,MAAI,UAAU;AAAA,cACZ,KAAK;AAAA,YACf,CAAS;AAAA,UACF;AACD,kBAAQ,QAAQ;AAAA,QACjB;AAAA,MACL,CAAG,EACE,MAAM,CAAC,UAAU;AAChBA,sBAAAA,MAAY,MAAA,OAAA,+BAAA,OAAO,OAAO;AAC1B,gBAAQ,QAAQ;AAAA,MACtB,CAAK;AAAA,IACL;AAEA,UAAM,YAAY,MAAM;AACtB,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,sBAAAA,MAAI,MAAM;AAAA,UACR,UAAU;AAAA,UACV,eAAe;AAAA,UACf,SAAS,CAAC,QAAQ;AAChB,gBAAI,IAAI,MAAM;AACZA,8EAAY,gBAAgB,IAAI,IAAI;AACpC,sBAAQ,IAAI,IAAI;AAAA,YAC1B,OAAe;AACLA,4BAAA,MAAA,MAAA,OAAA,+BAAY,UAAU,IAAI,MAAM;AAChC,qBAAO,IAAI,MAAM;AAAA,YAClB;AAAA,UACF;AAAA,UACD,MAAM,CAAC,QAAQ;AACbA,0BAAAA,MAAA,MAAA,OAAA,+BAAY,GAAG;AACf,mBAAO,GAAG;AAAA,UACX;AAAA,QACP,CAAK;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,iBAAiB,YAAY;AACjC,iBAAW,QAAQ;AACnB,YAAM,UAAU,MAAM,UAAW;AACjC,YAAM,OAAO,MAAMG,uBAAY,MAAM,OAAO;AAC5C,UAAI,KAAK,SAAS,KAAK;AACrBH,sBAAAA,MAAI,eAAe,SAAS,KAAK,KAAK,KAAK;AAC3C,cAAM,OAAO,MAAME,sBAAY;AAC/BF,sBAAAA,MAAI,eAAe,QAAQ,KAAK,KAAK,IAAI;AACzCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,KAAK;AAAA,QACX,CAAK;AACD,mBAAW,QAAQ;AAAA,MACvB,OAAS;AACL,iBAAS,QAAQ;AACjBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD,mBAAW,QAAQ;AAAA,MACpB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1FA,GAAG,WAAW,eAAe;"}