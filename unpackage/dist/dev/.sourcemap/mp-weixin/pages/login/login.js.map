{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<script setup>\nimport { reactive, ref } from 'vue'\nimport { encrypt } from '@/utils/jsencrypt'\nimport { loginApi, getInfoApi, oneLoginApi } from '@/api'\n\nconst model = reactive({\n  username: '',\n  password: '',\n  xcxCode: ''\n})\n\nconst form = ref()\nconst loading = ref(false)\nconst oneLoading = ref(false)\nconst oneLogin = ref(true)\n\nfunction handleSubmit() {\n  form.value.validate().then(async ({\n    valid,\n    errors\n  }) => {\n    if (valid) {\n      loading.value = true\n      model.xcxCode = await getWxCode()\n      const data = {\n        username: model.username,\n        password: encrypt(model.password),\n        xcxCode: model.xcxCode\n      }\n      console.log('üöÄ:>> data: ', data)\n      const res = await loginApi(data)\n      if (res.code === 200) {\n        uni.setStorageSync('token', res.data.token)\n        const info = await getInfoApi()\n        uni.setStorageSync('user', info.data.user)\n        uni.setStorageSync('roles', info.data.permissions)\n        uni.switchTab({\n          url: '/pages/index/index'\n        })\n      }\n      loading.value = false\n    }\n  })\n    .catch((error) => {\n      console.log(error, 'error')\n      loading.value = false\n    })\n}\n\nconst getWxCode = () => {\n  return new Promise((resolve, reject) => {\n    uni.login({\n      provider: 'weixin',\n      onlyAuthorize: true,\n      success: (res) => {\n        if (res.code) {\n          console.log('üöÄ:>> code: ', res.code)\n          resolve(res.code)\n        } else {\n          console.log('ÁôªÂΩïÂ§±Ë¥•ÔºÅ' + res.errMsg)\n          reject(res.errMsg)\n        }\n      },\n      fail: (err) => {\n        console.log(err)\n        reject(err)\n      }\n    })\n  })\n}\n\nconst handleOneLogin = async () => {\n  oneLoading.value = true\n  model.xcxCode = await getWxCode()\n  const resD = await oneLoginApi(model.xcxCode)\n  if (resD.code === 200) {\n    uni.setStorageSync('token', resD.data.token)\n    const info = await getInfoApi()\n    uni.setStorageSync('user', info.data.user)\n    uni.switchTab({\n      url: '/pages/index/index'\n    })\n    oneLoading.value = false\n  } else {\n    oneLogin.value = false\n    uni.showToast({\n      title: 'ÂæÆ‰ø°ÊéàÊùÉÂ§±Ë¥•',\n      icon: 'none'\n    })\n    oneLoading.value = false\n  }\n}\n</script>\n\n<template>\n  <view class=\"login-page\">\n    <image class=\"login-bg\" src=\"/static/login.jpg\" />\n    <!-- <image class=\"login-bg-header\" src=\"/static/lgheader.jpg\" /> -->\n\n    <wd-navbar :bordered=\"false\" fixed placeholder safeAreaInsetTop>\n      <template #left>\n        <!-- <view class=\"\" @click=\"clickToHome\">\n          <wd-icon custom-class=\"icon-con\" name=\"home\" color=\"#000\" size=\"22px\" />\n        </view> -->\n      </template>\n      <template #title>\n        <view class=\"lg-title\">ÁôªÂΩï</view>\n      </template>\n    </wd-navbar>\n\n    <view class=\"one-login\" v-if=\"oneLogin\">\n      <!-- <view class=\"title-con\">Êô∫ËÉΩÊ≤πÊú∫ËøêÁª¥Âπ≥Âè∞</view> -->\n      <wd-button :loading=\"oneLoading\" custom-class=\"one-login-btn\" @click=\"handleOneLogin\">ÂæÆ‰ø°ÊéàÊùÉ‰∏ÄÈîÆÁôªÂΩï</wd-button>\n      <!-- <view class=\"one-login-btn\" @click=\"handleOneLogin\">ÂæÆ‰ø°ÊéàÊùÉ‰∏ÄÈîÆÁôªÂΩï</view> -->\n    </view>\n\n    <view class=\"login-con\" v-if=\"!oneLogin\">\n      <image class=\"log-header-img\" src=\"/static/log-header.jpg\" />\n      <view class=\"login-form\">\n        <wd-form ref=\"form\" :model=\"model\" errorType=\"toast\">\n          <view class=\"title\">Ëá™Âä®ÁªòÂõæÊï∞ÊçÆÈááÈõÜ‰∏äÊä•Á≥ªÁªü</view>\n          <wd-cell-group border>\n            <wd-input label=\"Ë¥¶Âè∑\" label-width=\"70px\" prop=\"username\" clearable v-model=\"model.username\" placeholder=\"ËØ∑ËæìÂÖ•Ë¥¶Âè∑\"\n              :rules=\"[{ required: true, message: 'ËØ∑Â°´ÂÜôË¥¶Âè∑' }]\" />\n            <wd-input label=\"ÂØÜÁ†Å\" label-width=\"70px\" prop=\"password\" show-password v-model=\"model.password\"\n              placeholder=\"ËØ∑ËæìÂÖ•ÂØÜÁ†Å\" :rules=\"[{ required: true, message: 'ËØ∑Â°´ÂÜôÂØÜÁ†Å' }]\" />\n          </wd-cell-group>\n          <view class=\"footer\">\n            <wd-button type=\"primary\" :loading=\"loading\" @click=\"handleSubmit\" block>ÁôªÂΩï</wd-button>\n          </view>\n        </wd-form>\n      </view>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n.login-page {\n  width: 100%;\n  height: 100vh;\n  max-height: 100vh;\n  overflow-y: hidden;\n  // background: linear-gradient(135deg, #3498db, #2c3e50);\n\n  .login-bg {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 120%;\n    height: 100%;\n    margin-left: -5%;\n    z-index: 2;\n    opacity: 0.8;\n    overflow-x: hidden;\n  }\n\n  .login-bg-header {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100vw;\n    z-index: 3;\n    opacity: 1;\n  }\n\n  .one-login {\n    position: absolute;\n    width: 100%;\n    left: 15%;\n    right: 15%;\n    top: 40%;\n    opacity: 1;\n    z-index: 999;\n\n    :deep() {\n      .one-login-btn {\n        width: 540rpx;\n        line-height: 80rpx;\n        height: 80rpx;\n        color: #fff;\n        font-size: 30rpx;\n        background-color: #3c689e;\n        text-align: center;\n        border-radius: 0;\n      }\n    }\n  }\n\n  .login-con {\n    opacity: 1;\n    z-index: 999;\n    position: absolute;\n    left: 6%;\n    right: 6%;\n    top: 25%;\n    background-color: #fff;\n    border-radius: 20rpx;\n\n    .log-header-img {\n      border-radius: 20rpx 20rpx 0 0 ;\n      width: 100%;\n      height: 300rpx;\n      margin: 0 auto;\n    }\n\n    .login-form {\n      padding: 10rpx 20rpx;\n      padding-top: 40rpx;\n    }\n\n    .title {\n      padding-bottom: 40rpx;\n      text-align: center;\n      font-size: 34rpx;\n      font-weight: 500;\n      color: #333;\n    }\n  }\n\n  .footer {\n    padding: 24rpx;\n    padding-bottom: 40rpx;\n  }\n\n  :deep() {\n    .wd-navbar {\n      background: transparent;\n    }\n  }\n\n  .icon-con {\n     padding: 12rpx;\n     background-color: #b6b6b6;\n     border-radius: 50%;\n  }\n\n  .lg-title {\n    font-size: 32rpx;\n    font-weight: 400;\n    color: #333;\n    opacity: 1;\n  }\n}\n\n\n</style>\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["model","reactive","form","ref","loading","oneLoading","oneLogin","handleSubmit","valid","errors","getWxCode","data","encrypt","uni","res","loginApi","info","getInfoApi","error","resolve","reject","err","handleOneLogin","resD","oneLoginApi","MiniProgramPage"],"mappings":"w0BAKA,MAAMA,EAAQC,EAAAA,SAAS,CACrB,SAAU,GACV,SAAU,GACV,QAAS,EACX,CAAC,EAEKC,EAAOC,EAAAA,IAAK,EACZC,EAAUD,EAAG,IAAC,EAAK,EACnBE,EAAaF,EAAG,IAAC,EAAK,EACtBG,EAAWH,EAAG,IAAC,EAAI,EAEzB,SAASI,GAAe,CACtBL,EAAK,MAAM,SAAU,EAAC,KAAK,MAAO,CAChC,MAAAM,EACA,OAAAC,CACJ,IAAQ,CACJ,GAAID,EAAO,CACTJ,EAAQ,MAAQ,GAChBJ,EAAM,QAAU,MAAMU,EAAW,EACjC,MAAMC,EAAO,CACX,SAAUX,EAAM,SAChB,SAAUY,EAAAA,QAAQZ,EAAM,QAAQ,EAChC,QAASA,EAAM,OAChB,EACDa,EAAAA,MAAY,MAAA,MAAA,8BAAA,eAAgBF,CAAI,EAChC,MAAMG,EAAM,MAAMC,EAAQ,SAACJ,CAAI,EAC/B,GAAIG,EAAI,OAAS,IAAK,CACpBD,EAAAA,MAAI,eAAe,QAASC,EAAI,KAAK,KAAK,EAC1C,MAAME,EAAO,MAAMC,aAAY,EAC/BJ,EAAAA,MAAI,eAAe,OAAQG,EAAK,KAAK,IAAI,EACzCH,EAAAA,MAAI,eAAe,QAASG,EAAK,KAAK,WAAW,EACjDH,EAAAA,MAAI,UAAU,CACZ,IAAK,oBACf,CAAS,CACF,CACDT,EAAQ,MAAQ,EACjB,CACL,CAAG,EACE,MAAOc,GAAU,CAChBL,EAAAA,MAAY,MAAA,MAAA,8BAAAK,EAAO,OAAO,EAC1Bd,EAAQ,MAAQ,EACtB,CAAK,CACL,CAEA,MAAMM,EAAY,IACT,IAAI,QAAQ,CAACS,EAASC,IAAW,CACtCP,EAAAA,MAAI,MAAM,CACR,SAAU,SACV,cAAe,GACf,QAAUC,GAAQ,CACZA,EAAI,MACND,kDAAY,eAAgBC,EAAI,IAAI,EACpCK,EAAQL,EAAI,IAAI,IAEhBD,EAAA,MAAA,MAAA,MAAA,8BAAY,QAAUC,EAAI,MAAM,EAChCM,EAAON,EAAI,MAAM,EAEpB,EACD,KAAOO,GAAQ,CACbR,EAAAA,MAAY,MAAA,MAAA,8BAAAQ,CAAG,EACfD,EAAOC,CAAG,CACX,CACP,CAAK,CACL,CAAG,EAGGC,EAAiB,SAAY,CACjCjB,EAAW,MAAQ,GACnBL,EAAM,QAAU,MAAMU,EAAW,EACjC,MAAMa,EAAO,MAAMC,cAAYxB,EAAM,OAAO,EAC5C,GAAIuB,EAAK,OAAS,IAAK,CACrBV,EAAAA,MAAI,eAAe,QAASU,EAAK,KAAK,KAAK,EAC3C,MAAMP,EAAO,MAAMC,aAAY,EAC/BJ,EAAAA,MAAI,eAAe,OAAQG,EAAK,KAAK,IAAI,EACzCH,EAAAA,MAAI,UAAU,CACZ,IAAK,oBACX,CAAK,EACDR,EAAW,MAAQ,EACvB,MACIC,EAAS,MAAQ,GACjBO,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,MACZ,CAAK,EACDR,EAAW,MAAQ,EAEvB,oxBC1FA,GAAG,WAAWoB,CAAe"}