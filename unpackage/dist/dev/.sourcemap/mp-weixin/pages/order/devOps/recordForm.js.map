{"version":3,"file":"recordForm.js","sources":["pages/order/devOps/recordForm.vue","pages/order/devOps/recordForm.vue?type=page"],"sourcesContent":["<script setup>\nimport { ref } from 'vue'\nimport { getCarListApi, getRecordDetail, putRecord, postRecord, getDictApi } from '@/api'\nimport { onLoad } from '@dcloudio/uni-app'\n\nconst carOptions = ref([])\nconst dict = ref({})\nconst loading = ref(false)\nconst form = ref(null)\nconst model = ref({\n  vehicleId: '',\n  plateNumber: '', // 车拍\n  maintenanceRecordTypeCode: '', // 保养类型\n  maintenanceDate: '', // 保养日期\n  maintenanceValidDate: '', // 有效日期（月）\n  maintenanceContent: '', // 保养内容\n  remark: '',\n})\nconst rules = ref({\n  vehicleId: [\n    { required: true, message: '请选择车辆车牌' }\n  ],\n  maintenanceRecordTypeCode: [\n    { required: true, message: '请选择保养类型' }\n  ],\n  maintenanceDate: [\n    { required: true, message: '请选择保养日期' }\n  ],\n  maintenanceValidDate: [\n    { required: true, message: '请输入有效日期（月）' }\n  ],\n  maintenanceContent: [\n    { required: true, message: '请输入保养内容' }\n  ]\n})\n\nconst getCar = async () => {\n  const res = await getCarListApi({ order: 'asc' })\n  carOptions.value = res.rows\n}\nconst handleCarChange = ({ value }) => {\n  const car = carOptions.value.find(item => item.vehicleId === value)\n  model.value.plateNumber = car.plateNumber\n}\n\nconst getDetail = async (id) => {\n  const res = await getRecordDetail(id)\n  model.value = res.data\n}\n\nconst getDict = async (code) => {\n  const res = await getDictApi(code)\n  dict.value[code] = res.data\n}\n\nconst handleSubmit = () => {\n  form.value\n    .validate()\n    .then(async ({ valid, errors }) => {\n      if (valid) {\n        loading.value = true\n        // 提交表单数据\n        let res\n        if (model.value.maintenanceRecordId) {\n          res = await putRecord(model.value)\n        } else {\n          res = await postRecord(model.value)\n        }\n        if (res.code == 200) {\n          uni.showToast({\n            title: '提交成功',\n            icon: 'success',\n            duration: 1000,\n            success: () => {\n              setTimeout(() => {\n                loading.value = false\n                uni.navigateBack({\n                  delta: 1\n                })\n              }, 1000)\n            }\n          })\n        }\n        loading.value = false\n      }\n    })\n    .catch((error) => {\n      console.log(error, 'error')\n    })\n}\n\nonLoad((param) => {\n  if (param.id) {\n    getDetail(param.id)\n  }\n  getCar()\n  getDict('vehicle_maintenance_record_type')\n})\n</script>\n\n<template>\n  <view class=\"info-page\">\n    <BaseForm>\n      <wd-form ref=\"form\" :model=\"model\" :rules=\"rules\" errorType=\"toast\">\n        <wd-cell-group border>\n          <wd-select-picker clearable type=\"radio\" value-key=\"vehicleId\" label-key=\"plateNumber\"\n            label-width=\"100px\" prop=\"vehicleId\" label=\"车辆车牌\" placeholder=\"请选择车辆车牌\"\n            v-model=\"model.vehicleId\" :columns=\"carOptions\" @change=\"handleCarChange\" filterable\n            :show-confirm=\"false\" />\n          <wd-picker clearable label=\"保养类型\" placeholder=\"请选择保养类型\" value-key=\"dictValue\" label-key=\"dictLabel\" label-width=\"100px\"\n            prop=\"maintenanceRecordTypeCode\" v-model=\"model.maintenanceRecordTypeCode\" :columns=\"dict.vehicle_maintenance_record_type\" />\n          <wd-datetime-picker clearable label=\"保养日期\" type=\"date\" label-width=\"100px\" placeholder=\"请选择日期\" prop=\"maintenanceDate\" v-model=\"model.maintenanceDate\" />\n          <wd-input clearable type=\"number\" label-width=\"120px\" label=\"有效日期（月）\" v-model=\"model.maintenanceValidDate\" placeholder=\"请输入有效日期（月）\" prop=\"maintenanceValidDate\" />\n          <wd-textarea label=\"保养内容\" label-width=\"100px\" type=\"textarea\" v-model=\"model.maintenanceContent\" :maxlength=\"300\" show-word-limit placeholder=\"请输入保养内容\" clearable prop=\"maintenanceContent\" />\n          <wd-input label=\"备注\" label-width=\"100px\" prop=\"remark\" clearable v-model=\"model.remark\" placeholder=\"请输入备注\" />\n\n        </wd-cell-group>\n        <view class=\"footer\">\n          <wd-button type=\"primary\" :loading=\"loading\" block @click=\"handleSubmit\">保存</wd-button>\n        </view>\n      </wd-form>\n    </BaseForm>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n.info-page {\n  .footer {\n    padding: 30rpx;\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/order/devOps/recordForm.vue'\nwx.createPage(MiniProgramPage)"],"names":["carOptions","ref","dict","loading","form","model","rules","getCar","res","getCarListApi","handleCarChange","value","car","item","getDetail","id","getRecordDetail","getDict","code","getDictApi","handleSubmit","valid","errors","putRecord","postRecord","uni","error","onLoad","param","MiniProgramPage"],"mappings":"oxCAKA,MAAMA,EAAaC,EAAG,IAAC,EAAE,EACnBC,EAAOD,EAAG,IAAC,EAAE,EACbE,EAAUF,EAAG,IAAC,EAAK,EACnBG,EAAOH,EAAG,IAAC,IAAI,EACfI,EAAQJ,EAAAA,IAAI,CAChB,UAAW,GACX,YAAa,GACb,0BAA2B,GAC3B,gBAAiB,GACjB,qBAAsB,GACtB,mBAAoB,GACpB,OAAQ,EACV,CAAC,EACKK,EAAQL,EAAAA,IAAI,CAChB,UAAW,CACT,CAAE,SAAU,GAAM,QAAS,SAAW,CACvC,EACD,0BAA2B,CACzB,CAAE,SAAU,GAAM,QAAS,SAAW,CACvC,EACD,gBAAiB,CACf,CAAE,SAAU,GAAM,QAAS,SAAW,CACvC,EACD,qBAAsB,CACpB,CAAE,SAAU,GAAM,QAAS,YAAc,CAC1C,EACD,mBAAoB,CAClB,CAAE,SAAU,GAAM,QAAS,SAAW,CACvC,CACH,CAAC,EAEKM,EAAS,SAAY,CACzB,MAAMC,EAAM,MAAMC,EAAAA,cAAc,CAAE,MAAO,KAAK,CAAE,EAChDT,EAAW,MAAQQ,EAAI,IACzB,EACME,EAAkB,CAAC,CAAE,MAAAC,KAAY,CACrC,MAAMC,EAAMZ,EAAW,MAAM,KAAKa,GAAQA,EAAK,YAAcF,CAAK,EAClEN,EAAM,MAAM,YAAcO,EAAI,WAChC,EAEME,EAAY,MAAOC,GAAO,CAC9B,MAAMP,EAAM,MAAMQ,EAAe,gBAACD,CAAE,EACpCV,EAAM,MAAQG,EAAI,IACpB,EAEMS,EAAU,MAAOC,GAAS,CAC9B,MAAMV,EAAM,MAAMW,EAAU,WAACD,CAAI,EACjChB,EAAK,MAAMgB,CAAI,EAAIV,EAAI,IACzB,EAEMY,EAAe,IAAM,CACzBhB,EAAK,MACF,SAAU,EACV,KAAK,MAAO,CAAE,MAAAiB,EAAO,OAAAC,KAAa,CACjC,GAAID,EAAO,CACTlB,EAAQ,MAAQ,GAEhB,IAAIK,EACAH,EAAM,MAAM,oBACdG,EAAM,MAAMe,EAAAA,UAAUlB,EAAM,KAAK,EAEjCG,EAAM,MAAMgB,EAAAA,WAAWnB,EAAM,KAAK,EAEhCG,EAAI,MAAQ,KACdiB,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,UACN,SAAU,IACV,QAAS,IAAM,CACb,WAAW,IAAM,CACftB,EAAQ,MAAQ,GAChBsB,EAAAA,MAAI,aAAa,CACf,MAAO,CACzB,CAAiB,CACF,EAAE,GAAI,CACR,CACb,CAAW,EAEHtB,EAAQ,MAAQ,EACjB,CACP,CAAK,EACA,MAAOuB,GAAU,CAChBD,EAAAA,MAAY,MAAA,MAAA,0CAAAC,EAAO,OAAO,CAChC,CAAK,CACL,EAEAC,OAAAA,EAAM,OAAEC,GAAU,CACZA,EAAM,IACRd,EAAUc,EAAM,EAAE,EAEpBrB,EAAQ,EACRU,EAAQ,iCAAiC,CAC3C,CAAC,ijDChGD,GAAG,WAAWY,CAAe"}