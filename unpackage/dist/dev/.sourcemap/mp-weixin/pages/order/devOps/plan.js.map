{"version":3,"file":"plan.js","sources":["pages/order/devOps/plan.vue","pages/order/devOps/plan.vue?type=page"],"sourcesContent":["<script setup>\nimport { ref, reactive } from 'vue'\nimport { getPlanList, putPlan } from '@/api'\nimport { onShow, onReachBottom } from '@dcloudio/uni-app'\nimport { useMessage } from '@/uni_modules/wot-design-uni'\nconst message = useMessage()\n\nconst loading = ref(false)\nconst list = ref([])\nconst total = ref(0)\nconst queryParams = reactive({\n  pageNum: 1,\n  pageSize: 10,\n  order: 'asc',\n  plateNumber: ''\n})\n\nconst state = ref('loading')\n\nonReachBottom(() => {\n  if (!list.value.length) {\n    state.value = 'error'\n  } else if (list.value.length < total.value) {\n    loadmore()\n  } else if (list.value.length === total.value) {\n    state.value = 'finished'\n  }\n})\n\nonShow(() => {\n  state.value = 'loading'\n  queryParams.plateNumber = ''\n  queryParams.pageNum = 1\n  queryParams.order = 'asc'\n  list.value = []\n  total.value = 0\n  getData()\n})\n\nfunction loadmore() {\n  queryParams.pageNum++\n  getData()\n  state.value = 'loading'\n}\n\nconst getData = async () => {\n  loading.value = true\n  const res = await getPlanList(queryParams)\n  list.value = [...list.value, ...res.rows]\n  total.value = res.total\n  loading.value = false\n  if (!list.value.length) {\n    state.value = 'error'\n  } else if (list.value.length === total.value) {\n    state.value = 'finished'\n  }\n}\n\n// 详情\nconst clickToDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/order/devOps/planForm${id ? `?id=${id}` : ''}`\n  })\n}\n\n// 重置\nconst resetPlan = (i) => {\n  const canReset = i.lastMaintenance || i.nextMaintenance || i.lastInspection || i.nextInspection || i.lastInsurance || i.nextInsurance\n\n  if(!canReset) {\n    uni.showToast({\n      title: '请先完善保养信息',\n      icon: 'none'\n    })\n    return\n  }\n  message.confirm({\n    title: '提示信息',\n    msg: '是否确认重置车辆保养信息？'\n  }).then(async () => {\n    const res = await putPlan(i.maintenancePlanId)\n    if(res.code == 200) {\n      queryParams.pageNum = 1\n      getData()\n      uni.showToast({\n        title: '重置成功',\n        icon: 'success'\n      })\n      state.value = 'loading'\n      queryParams.plateNumber = ''\n      queryParams.pageNum = 1\n      queryParams.order = 'asc'\n      list.value = []\n      total.value = 0\n      getData()\n    }\n  }).catch(() => {\n      console.log('点击了取消按钮')\n    })\n}\n\n// 搜索\nconst search = () => {\n  if(queryParams.plateNumber) {\n    state.value = 'loading'\n    queryParams.pageNum = 1\n    queryParams.order = 'asc'\n    list.value = []\n    total.value = 0\n    getData()\n  }\n}\n// 取消搜索\nconst cancel = () => {\n  if(queryParams.plateNumber) {\n    state.value = 'loading'\n    queryParams.plateNumber = ''\n    queryParams.pageNum = 1\n    queryParams.order = 'asc'\n    list.value = []\n    total.value = 0\n    getData()\n  }\n}\n</script>\n\n\n<template>\n  <view class=\"warning-page\">\n    <wd-message-box />\n    <BaseLoading :loading=\"loading\" v-if=\"loading && !list.length\" />\n    <view class=\"list-con\" v-else>\n\n      <wd-sticky>\n        <view style=\"margin-bottom: 30rpx; width: 100vw;\">\n          <wd-search v-model.trim=\"queryParams.plateNumber\" @search=\"search\" @cancel=\"cancel\" />\n        </view>\n      </wd-sticky>\n\n      <view class=\"list-item\" v-for=\"i in list\" :key=\"i.vehicleId\" @click.stop=\"clickToDetail(i.vehicleId)\">\n        <wd-card>\n          <template #title>\n            <view style=\"display: flex; justify-content: space-between; align-items: center\">\n              <view class=\"flex-col-c\">\n                <view class=\"plate-number\" v-if=\"i.plateNumber\">{{ i.plateNumber }}</view>\n              </view>\n              <view class=\"right\">\n                <view class=\"label\">单位：</view>\n                <view class=\"value\">{{ i.deptName }}</view>\n              </view>\n            </view>\n          </template>\n          <view class=\"main\">\n            <view class=\"content\">\n              <view class=\"content-item pd\">\n                <view class=\"label\">上次保养日期：</view>\n                <view class=\"value\">{{ i.lastMaintenance }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">下次保养日期：</view>\n                <view class=\"value\">{{ i.nextMaintenance }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">上次年检日期：</view>\n                <view class=\"value\">{{ i.lastInspection }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">下次年检日期：</view>\n                <view class=\"value\">{{ i.nextInspection }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">上次保险日期：</view>\n                <view class=\"value\">{{ i.lastInsurance }}</view>\n              </view>\n              <view class=\"content-item pd\">\n                <view class=\"label\">下次保险日期：</view>\n                <view class=\"value\">{{ i.nextInsurance }}</view>\n              </view>\n            </view>\n\n            <view style=\"display: flex; align-items: center; margin-top: 100rpx;\">\n              <view @click.stop=\"resetPlan(i)\">\n                <wd-button size=\"small\" type=\"warning\">重置</wd-button>\n              </view>\n            </view>\n          </view>\n        </wd-card>\n      </view>\n      <wd-loadmore :state=\"state\" @reload=\"loadmore\" />\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n::v-deep(.wd-tag) {\n  font-size: 14px;\n}\n\n.warning-page {\n  ::v-deep .wd-card__title-content {\n    padding: 20rpx 0;\n  }\n\n  .list-con {\n    .plate-number {\n      padding: 10rpx 10rpx;\n      color: #fff;\n      background-color: #597fe8;\n      border-radius: 10rpx;\n      font-size: 26rpx;\n    }\n\n    .main {\n      display: flex;\n    }\n\n    .content {\n      flex: 1;\n      .content-item {\n        display: flex;\n        margin-bottom: 8rpx;\n\n        &:last-child {\n          padding-bottom: 12rpx;\n        }\n\n        .value {\n          color: #333;\n        }\n      }\n    }\n  }\n}\n\n\nimage {\n  display: block;\n  width: 120px;\n  height: 78px;\n  margin-right: 15px;\n}\n\n.right {\n  display: flex;\n}\n</style>\n","import MiniProgramPage from '/Users/jing/Code/mini/vehicle-info/pages/order/devOps/plan.vue'\nwx.createPage(MiniProgramPage)"],"names":["useMessage","ref","reactive","onReachBottom","onShow","getPlanList","uni","putPlan"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,UAAM,UAAUA,uDAAAA,WAAY;AAE5B,UAAM,UAAUC,cAAG,IAAC,KAAK;AACzB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,QAAQA,cAAG,IAAC,CAAC;AACnB,UAAM,cAAcC,cAAAA,SAAS;AAAA,MAC3B,SAAS;AAAA,MACT,UAAU;AAAA,MACV,OAAO;AAAA,MACP,aAAa;AAAA,IACf,CAAC;AAED,UAAM,QAAQD,cAAG,IAAC,SAAS;AAE3BE,kBAAAA,cAAc,MAAM;AAClB,UAAI,CAAC,KAAK,MAAM,QAAQ;AACtB,cAAM,QAAQ;AAAA,MACf,WAAU,KAAK,MAAM,SAAS,MAAM,OAAO;AAC1C,iBAAU;AAAA,MACX,WAAU,KAAK,MAAM,WAAW,MAAM,OAAO;AAC5C,cAAM,QAAQ;AAAA,MACf;AAAA,IACH,CAAC;AAEDC,kBAAAA,OAAO,MAAM;AACX,YAAM,QAAQ;AACd,kBAAY,cAAc;AAC1B,kBAAY,UAAU;AACtB,kBAAY,QAAQ;AACpB,WAAK,QAAQ,CAAE;AACf,YAAM,QAAQ;AACd,cAAS;AAAA,IACX,CAAC;AAED,aAAS,WAAW;AAClB,kBAAY;AACZ,cAAS;AACT,YAAM,QAAQ;AAAA,IAChB;AAEA,UAAM,UAAU,YAAY;AAC1B,cAAQ,QAAQ;AAChB,YAAM,MAAM,MAAMC,UAAW,YAAC,WAAW;AACzC,WAAK,QAAQ,CAAC,GAAG,KAAK,OAAO,GAAG,IAAI,IAAI;AACxC,YAAM,QAAQ,IAAI;AAClB,cAAQ,QAAQ;AAChB,UAAI,CAAC,KAAK,MAAM,QAAQ;AACtB,cAAM,QAAQ;AAAA,MACf,WAAU,KAAK,MAAM,WAAW,MAAM,OAAO;AAC5C,cAAM,QAAQ;AAAA,MACf;AAAA,IACH;AAGA,UAAM,gBAAgB,CAAC,OAAO;AAC5BC,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,+BAA+B,KAAK,OAAO,EAAE,KAAK,EAAE;AAAA,MAC7D,CAAG;AAAA,IACH;AAGA,UAAM,YAAY,CAAC,MAAM;AACvB,YAAM,WAAW,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,kBAAkB,EAAE,kBAAkB,EAAE,iBAAiB,EAAE;AAExH,UAAG,CAAC,UAAU;AACZA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AACD,cAAQ,QAAQ;AAAA,QACd,OAAO;AAAA,QACP,KAAK;AAAA,MACT,CAAG,EAAE,KAAK,YAAY;AAClB,cAAM,MAAM,MAAMC,kBAAQ,EAAE,iBAAiB;AAC7C,YAAG,IAAI,QAAQ,KAAK;AAClB,sBAAY,UAAU;AACtB,kBAAS;AACTD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AACD,gBAAM,QAAQ;AACd,sBAAY,cAAc;AAC1B,sBAAY,UAAU;AACtB,sBAAY,QAAQ;AACpB,eAAK,QAAQ,CAAE;AACf,gBAAM,QAAQ;AACd,kBAAS;AAAA,QACV;AAAA,MACL,CAAG,EAAE,MAAM,MAAM;AACXA,sBAAAA,MAAY,MAAA,OAAA,qCAAA,SAAS;AAAA,MAC3B,CAAK;AAAA,IACL;AAGA,UAAM,SAAS,MAAM;AACnB,UAAG,YAAY,aAAa;AAC1B,cAAM,QAAQ;AACd,oBAAY,UAAU;AACtB,oBAAY,QAAQ;AACpB,aAAK,QAAQ,CAAE;AACf,cAAM,QAAQ;AACd,gBAAS;AAAA,MACV;AAAA,IACH;AAEA,UAAM,SAAS,MAAM;AACnB,UAAG,YAAY,aAAa;AAC1B,cAAM,QAAQ;AACd,oBAAY,cAAc;AAC1B,oBAAY,UAAU;AACtB,oBAAY,QAAQ;AACpB,aAAK,QAAQ,CAAE;AACf,cAAM,QAAQ;AACd,gBAAS;AAAA,MACV;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HA,GAAG,WAAW,eAAe;"}