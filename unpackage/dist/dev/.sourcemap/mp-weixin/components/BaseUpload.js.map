{"version":3,"file":"BaseUpload.js","sources":["components/BaseUpload.vue","/Users/jing/Code/mini/vehicle-info/components/BaseUpload.vue?type=component"],"sourcesContent":["<template>\n  <view>\n    <wd-upload :disabled=\"disabled\" @remove=\"removeUpload\" :file-list=\"fileList\" :limit=\"1\" :upload-method=\"customUpload\"></wd-upload>\n  </view>\n</template>\n\n<script setup>\nimport http from '@/utils/request'\nimport { getToken } from '@/utils'\nimport { useToast } from '@/uni_modules/wot-design-uni'\n\nconst toast = useToast()\n\nconst props = defineProps({\n  fileList: {\n    type: Array,\n    default: () => []\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  }\n})\nconst emit = defineEmits(['update:fileList', 'remove'])\n\nconst removeUpload = (file) => {\n  emit('remove',file)\n}\n\nconst customUpload = (file, formData, options) => {\n  const uploadTask = uni.uploadFile({\n    url: http.config.baseURL + 'system/local/file/upload',\n    header: {\n      ...options.header,\n      Authorization: `Bearer ${getToken()}`,\n      'Content-Type': 'multipart/form-data'\n    },\n    name: 'file',\n    fileName: 'file',\n    fileType: 'image',\n    formData,\n    filePath: file.url,\n    success: async (res) => {\n      const e = JSON.parse(res.data)\n      if (e.code == 200) {\n        // 设置上传成功\n        options.onSuccess(e, file, formData)\n        // props.fileList = [{ url: e.data.imgUrl }]\n        emit('update:fileList', [e.data])\n        toast.show('上传成功')\n      } else {\n        // 设置上传失败\n        options.onError({ ...e, errMsg: e.errMsg || '' }, file, formData)\n        toast.show('上传失败')\n      }\n    },\n    fail(err) {\n      // 设置上传失败\n      options.onError(err, file, formData)\n    }\n  })\n  // 设置当前文件加载的百分比\n  uploadTask.onProgressUpdate((res) => {\n    options.onProgress(res, file)\n  })\n}\n\n</script>\n\n<style>\n\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/components/BaseUpload.vue'\nwx.createComponent(Component)"],"names":["useToast","uni","http","getToken","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWA,UAAM,QAAQA,kDAAAA,SAAU;AAYxB,UAAM,OAAO;AAEb,UAAM,eAAe,CAAC,SAAS;AAC7B,WAAK,UAAS,IAAI;AAAA,IACpB;AAEA,UAAM,eAAe,CAAC,MAAM,UAAU,YAAY;AAChD,YAAM,aAAaC,cAAG,MAAC,WAAW;AAAA,QAChC,KAAKC,cAAI,KAAC,OAAO,UAAU;AAAA,QAC3B,QAAQ;AAAA,UACN,GAAG,QAAQ;AAAA,UACX,eAAe,UAAUC,YAAQ,SAAA,CAAE;AAAA,UACnC,gBAAgB;AAAA,QACjB;AAAA,QACD,MAAM;AAAA,QACN,UAAU;AAAA,QACV,UAAU;AAAA,QACV;AAAA,QACA,UAAU,KAAK;AAAA,QACf,SAAS,OAAO,QAAQ;AACtB,gBAAM,IAAI,KAAK,MAAM,IAAI,IAAI;AAC7B,cAAI,EAAE,QAAQ,KAAK;AAEjB,oBAAQ,UAAU,GAAG,MAAM,QAAQ;AAEnC,iBAAK,mBAAmB,CAAC,EAAE,IAAI,CAAC;AAChC,kBAAM,KAAK,MAAM;AAAA,UACzB,OAAa;AAEL,oBAAQ,QAAQ,EAAE,GAAG,GAAG,QAAQ,EAAE,UAAU,GAAE,GAAI,MAAM,QAAQ;AAChE,kBAAM,KAAK,MAAM;AAAA,UAClB;AAAA,QACF;AAAA,QACD,KAAK,KAAK;AAER,kBAAQ,QAAQ,KAAK,MAAM,QAAQ;AAAA,QACpC;AAAA,MACL,CAAG;AAED,iBAAW,iBAAiB,CAAC,QAAQ;AACnC,gBAAQ,WAAW,KAAK,IAAI;AAAA,MAChC,CAAG;AAAA,IACH;;;;;;;;;;;;;;AChEA,GAAG,gBAAgBC,SAAS;"}