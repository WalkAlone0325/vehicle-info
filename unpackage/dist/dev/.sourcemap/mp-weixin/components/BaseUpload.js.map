{"version":3,"file":"BaseUpload.js","sources":["components/BaseUpload.vue","/Users/jing/Code/mini/vehicle-info/components/BaseUpload.vue?type=component"],"sourcesContent":["<template>\n  <view>\n    <wd-upload :disabled=\"disabled\" @remove=\"removeUpload\" :file-list=\"fileList\" :limit=\"1\" :upload-method=\"customUpload\"></wd-upload>\n  </view>\n</template>\n\n<script setup>\nimport http from '@/utils/request'\nimport { getToken } from '@/utils'\nimport { useToast } from '@/uni_modules/wot-design-uni'\n\nconst toast = useToast()\n\nconst props = defineProps({\n  fileList: {\n    type: Array,\n    default: () => []\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  }\n})\nconst emit = defineEmits(['update:fileList', 'remove'])\n\nconst removeUpload = (file) => {\n  emit('remove',file)\n}\n\nconst customUpload = (file, formData, options) => {\n  const uploadTask = uni.uploadFile({\n    url: http.config.baseURL + 'system/local/file/upload',\n    header: {\n      ...options.header,\n      Authorization: `Bearer ${getToken()}`,\n      'Content-Type': 'multipart/form-data'\n    },\n    name: 'file',\n    fileName: 'file',\n    fileType: 'image',\n    formData,\n    filePath: file.url,\n    success: async (res) => {\n      const e = JSON.parse(res.data)\n      console.log(e)\n      if (e.code == 200) {\n        // 设置上传成功\n        options.onSuccess(e, file, formData)\n        // props.fileList = [{ url: e.data.imgUrl }]\n        emit('update:fileList', [e.data])\n        toast.show('上传成功')\n        uni.showToast({ title: e.msg || '', icon: 'none' })\n      } else {\n        // 设置上传失败\n        options.onError({ ...e, errMsg: e.msg || '' }, file, formData)\n        toast.show('上传失败')\n        uni.showToast({ title: e.msg || '', icon: 'none' })\n      }\n    },\n    fail(err) {\n      // 设置上传失败\n      options.onError(err, file, formData)\n    }\n  })\n  // 设置当前文件加载的百分比\n  uploadTask.onProgressUpdate((res) => {\n    options.onProgress(res, file)\n  })\n}\n\n</script>\n\n<style>\n\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/components/BaseUpload.vue'\nwx.createComponent(Component)"],"names":["toast","useToast","emit","__emit","removeUpload","file","customUpload","formData","options","uni","http","getToken","res","e","err","Component"],"mappings":"whBAWA,MAAMA,EAAQC,EAAAA,SAAU,EAYlBC,EAAOC,EAEPC,EAAgBC,GAAS,CAC7BH,EAAK,SAASG,CAAI,CACpB,EAEMC,EAAe,CAACD,EAAME,EAAUC,IAAY,CAC7BC,EAAG,MAAC,WAAW,CAChC,IAAKC,EAAI,KAAC,OAAO,QAAU,2BAC3B,OAAQ,CACN,GAAGF,EAAQ,OACX,cAAe,UAAUG,EAAQ,SAAA,CAAE,GACnC,eAAgB,qBACjB,EACD,KAAM,OACN,SAAU,OACV,SAAU,QACV,SAAAJ,EACA,SAAUF,EAAK,IACf,QAAS,MAAOO,GAAQ,CACtB,MAAMC,EAAI,KAAK,MAAMD,EAAI,IAAI,EAC7BH,EAAAA,MAAA,MAAA,MAAA,kCAAYI,CAAC,EACTA,EAAE,MAAQ,KAEZL,EAAQ,UAAUK,EAAGR,EAAME,CAAQ,EAEnCL,EAAK,kBAAmB,CAACW,EAAE,IAAI,CAAC,EAChCb,EAAM,KAAK,MAAM,EACjBS,QAAI,UAAU,CAAE,MAAOI,EAAE,KAAO,GAAI,KAAM,OAAQ,IAGlDL,EAAQ,QAAQ,CAAE,GAAGK,EAAG,OAAQA,EAAE,KAAO,EAAE,EAAIR,EAAME,CAAQ,EAC7DP,EAAM,KAAK,MAAM,EACjBS,QAAI,UAAU,CAAE,MAAOI,EAAE,KAAO,GAAI,KAAM,OAAQ,EAErD,EACD,KAAKC,EAAK,CAERN,EAAQ,QAAQM,EAAKT,EAAME,CAAQ,CACpC,CACL,CAAG,EAEU,iBAAkBK,GAAQ,CACnCJ,EAAQ,WAAWI,EAAKP,CAAI,CAChC,CAAG,CACH,4GCnEA,GAAG,gBAAgBU,CAAS"}