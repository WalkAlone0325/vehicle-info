{"version":3,"file":"wd-resize.js","sources":["uni_modules/wot-design-uni/components/wd-resize/wd-resize.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-resize/wd-resize.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"`wd-resize ${customClass}`\" :style=\"rootStyle\">\n    <!--插槽需要脱离父容器文档流，防止父容器固宽固高，进而导致插槽大小被被父容器限制-->\n    <view :id=\"resizeId\" :class=\"`wd-resize__container ${customContainerClass}`\">\n      <!--被监听的插槽-->\n      <slot />\n      <!--监听插槽变大-->\n      <scroll-view\n        class=\"wd-resize__wrapper\"\n        :scroll-y=\"true\"\n        :scroll-top=\"expandScrollTop\"\n        :scroll-x=\"true\"\n        :scroll-left=\"expandScrollLeft\"\n        @scroll=\"onScrollHandler\"\n      >\n        <view class=\"wd-resize__wrapper--placeholder\" style=\"height: 100000px; width: 100000px\"></view>\n      </scroll-view>\n      <!--监听插槽变小-->\n      <scroll-view\n        class=\"wd-resize__wrapper\"\n        :scroll-y=\"true\"\n        :scroll-top=\"shrinkScrollTop\"\n        :scroll-x=\"true\"\n        :scroll-left=\"shrinkScrollLeft\"\n        @scroll=\"onScrollHandler\"\n      >\n        <view class=\"wd-resize__wrapper--placeholder\" style=\"height: 250%; width: 250%\"></view>\n      </scroll-view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-resize',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport { computed, getCurrentInstance, onMounted, ref } from 'vue'\nimport { addUnit, objToStyle, uuid } from '../common/util'\nimport { resizeProps } from './types'\n\nconst props = defineProps(resizeProps)\nconst emit = defineEmits(['resize'])\n\nconst expandScrollTop = ref<number>(0)\nconst shrinkScrollTop = ref<number>(0)\nconst expandScrollLeft = ref<number>(0)\nconst shrinkScrollLeft = ref<number>(0)\nconst height = ref<number>(0)\nconst width = ref<number>(0)\nconst scrollEventCount = ref<number>(0)\n\nconst rootStyle = computed(() => {\n  const style: Record<string, string | number> = {\n    width: addUnit(width.value),\n    height: addUnit(height.value)\n  }\n  return `${objToStyle(style)}${props.customStyle}`\n})\nlet onScrollHandler = () => {}\nconst { proxy } = getCurrentInstance() as any\n\nconst resizeId = ref<string>(`resize${uuid()}`)\n\nonMounted(() => {\n  // 初始化数据获取\n  const query = uni.createSelectorQuery().in(proxy).select(`#${resizeId.value}`).boundingClientRect()\n  query.exec(([res]) => {\n    // 闭包记录容器高度\n    let lastHeight = res.height\n    let lastWidth = res.width\n    // 立即填充父容器高宽\n    height.value = lastHeight\n    width.value = lastWidth\n    // 监听滚动事件\n    onScrollHandler = () => {\n      const query = uni.createSelectorQuery().in(proxy).select(`#${resizeId.value}`).boundingClientRect()\n      query.exec(([res]) => {\n        // 前两次滚动事件被触发，说明 created 的修改已渲染，通知用户代码当前容器大小\n        if (scrollEventCount.value++ === 0) {\n          const result: Record<string, string | number> = {}\n          ;['bottom', 'top', 'left', 'right', 'height', 'width'].forEach((propName) => {\n            result[propName] = res[propName]\n          })\n          emit('resize', result)\n        }\n        // 滚动条拉到底部会触发两次多余的事件，屏蔽掉。\n        if (scrollEventCount.value < 3) return\n        // 手动设置父容器高宽，防止父容器坍塌\n        // 滚动完，重新获取容器新的高度\n        const newHeight = res.height\n        const newWidth = res.width\n        // 立即填充父容器高宽\n        height.value = newHeight\n        width.value = newWidth\n        // 宽高都改变时，只需要触发一次 size 事件\n        const emitStack: number[] = []\n        if (newHeight !== lastHeight) {\n          lastHeight = newHeight\n          emitStack.push(1)\n        }\n        if (newWidth !== lastWidth) {\n          lastWidth = newWidth\n          emitStack.push(1)\n        }\n        if (emitStack.length !== 0) {\n          const result: Record<string, any> = {}\n          ;['bottom', 'top', 'left', 'right', 'height', 'width'].forEach((propName) => {\n            result[propName] = res[propName]\n          })\n          emit('resize', result)\n        }\n        // 滚动条拉到底部（如果使用 nextTick 效果更佳）\n        scrollToBottom({\n          lastWidth: lastWidth,\n          lastHeight: lastHeight\n        })\n      })\n    }\n    // 滚动条拉到底部（如果使用 nextTick 效果更佳）\n    scrollToBottom({\n      lastWidth: lastWidth,\n      lastHeight: lastHeight\n    })\n  })\n})\n\nfunction scrollToBottom({ lastWidth, lastHeight }: { lastWidth: number; lastHeight: number }) {\n  expandScrollTop.value = 100000 + lastHeight\n  shrinkScrollTop.value = 3 * height.value + lastHeight\n  expandScrollLeft.value = 100000 + lastWidth\n  shrinkScrollLeft.value = 3 * width.value + lastWidth\n}\n</script>\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-resize/wd-resize.vue'\nwx.createComponent(Component)"],"names":["__default__","props","__props","emit","__emit","expandScrollTop","ref","shrinkScrollTop","expandScrollLeft","shrinkScrollLeft","height","width","scrollEventCount","rootStyle","computed","style","addUnit","objToStyle","onScrollHandler","proxy","getCurrentInstance","resizeId","uuid","onMounted","uni","res","lastHeight","lastWidth","result","propName","newHeight","newWidth","emitStack","scrollToBottom","Component"],"mappings":"oHAiCAA,EAAe,CACb,KAAM,YACN,QAAS,CACP,YAAa,GACb,eAAgB,GAChB,eAAgB,QAClB,CACF,mFAQA,MAAMC,EAAQC,EACRC,EAAOC,EAEPC,EAAkBC,MAAY,CAAC,EAC/BC,EAAkBD,MAAY,CAAC,EAC/BE,EAAmBF,MAAY,CAAC,EAChCG,EAAmBH,MAAY,CAAC,EAChCI,EAASJ,MAAY,CAAC,EACtBK,EAAQL,MAAY,CAAC,EACrBM,EAAmBN,MAAY,CAAC,EAEhCO,EAAYC,EAAAA,SAAS,IAAM,CAC/B,MAAMC,EAAyC,CAC7C,MAAOC,EAAAA,QAAQL,EAAM,KAAK,EAC1B,OAAQK,EAAAA,QAAQN,EAAO,KAAK,CAAA,EAE9B,MAAO,GAAGO,EAAAA,WAAWF,CAAK,CAAC,GAAGd,EAAM,WAAW,EAAA,CAChD,EACD,IAAIiB,EAAkB,IAAM,CAAA,EACtB,KAAA,CAAE,MAAAC,GAAUC,EAAAA,qBAEZC,EAAWf,EAAAA,IAAY,SAASgB,EAAA,KAAA,CAAM,EAAE,EAE9CC,EAAAA,UAAU,IAAM,CAEAC,EAAA,MAAI,oBAAoB,EAAE,GAAGL,CAAK,EAAE,OAAO,IAAIE,EAAS,KAAK,EAAE,EAAE,mBAAmB,EAC5F,KAAK,CAAC,CAACI,CAAG,IAAM,CAEpB,IAAIC,EAAaD,EAAI,OACjBE,EAAYF,EAAI,MAEpBf,EAAO,MAAQgB,EACff,EAAM,MAAQgB,EAEdT,EAAkB,IAAM,CACRM,EAAA,MAAI,oBAAoB,EAAE,GAAGL,CAAK,EAAE,OAAO,IAAIE,EAAS,KAAK,EAAE,EAAE,mBAAmB,EAC5F,KAAK,CAAC,CAACI,CAAG,IAAM,CAEhB,GAAAb,EAAiB,UAAY,EAAG,CAClC,MAAMgB,EAA0C,CAAA,EAC9C,CAAA,SAAU,MAAO,OAAQ,QAAS,SAAU,OAAO,EAAE,QAASC,GAAa,CACpED,EAAAC,CAAQ,EAAIJ,EAAII,CAAQ,CAAA,CAChC,EACD1B,EAAK,SAAUyB,CAAM,CACvB,CAEA,GAAIhB,EAAiB,MAAQ,EAAG,OAGhC,MAAMkB,EAAYL,EAAI,OAChBM,EAAWN,EAAI,MAErBf,EAAO,MAAQoB,EACfnB,EAAM,MAAQoB,EAEd,MAAMC,EAAsB,CAAA,EASxB,GARAF,IAAcJ,IACHA,EAAAI,EACbE,EAAU,KAAK,CAAC,GAEdD,IAAaJ,IACHA,EAAAI,EACZC,EAAU,KAAK,CAAC,GAEdA,EAAU,SAAW,EAAG,CAC1B,MAAMJ,EAA8B,CAAA,EAClC,CAAA,SAAU,MAAO,OAAQ,QAAS,SAAU,OAAO,EAAE,QAASC,GAAa,CACpED,EAAAC,CAAQ,EAAIJ,EAAII,CAAQ,CAAA,CAChC,EACD1B,EAAK,SAAUyB,CAAM,CACvB,CAEeK,EAAA,CACb,UAAAN,EACA,WAAAD,CAAA,CACD,CAAA,CACF,CAAA,EAGYO,EAAA,CACb,UAAAN,EACA,WAAAD,CAAA,CACD,CAAA,CACF,CAAA,CACF,EAED,SAASO,EAAe,CAAE,UAAAN,EAAW,WAAAD,GAAyD,CAC5FrB,EAAgB,MAAQ,IAASqB,EACjBnB,EAAA,MAAQ,EAAIG,EAAO,MAAQgB,EAC3ClB,EAAiB,MAAQ,IAASmB,EACjBlB,EAAA,MAAQ,EAAIE,EAAM,MAAQgB,CAC7C,+TC1IA,GAAG,gBAAgBO,CAAS"}