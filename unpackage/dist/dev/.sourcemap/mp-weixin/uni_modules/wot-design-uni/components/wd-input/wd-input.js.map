{"version":3,"file":"wd-input.js","sources":["uni_modules/wot-design-uni/components/wd-input/wd-input.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-input/wd-input.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"rootClass\" :style=\"customStyle\" @click=\"handleClick\">\n    <view v-if=\"label || $slots.label\" :class=\"labelClass\" :style=\"labelStyle\">\n      <view v-if=\"prefixIcon || $slots.prefix\" class=\"wd-input__prefix\">\n        <wd-icon v-if=\"prefixIcon && !$slots.prefix\" custom-class=\"wd-input__icon\" :name=\"prefixIcon\" @click=\"onClickPrefixIcon\" />\n        <slot v-else name=\"prefix\"></slot>\n      </view>\n      <view class=\"wd-input__label-inner\">\n        <template v-if=\"label && !$slots.label\">{{ label }}</template>\n        <slot v-else name=\"label\"></slot>\n      </view>\n    </view>\n    <view class=\"wd-input__body\">\n      <view class=\"wd-input__value\">\n        <view v-if=\"(prefixIcon || $slots.prefix) && !label\" class=\"wd-input__prefix\">\n          <wd-icon v-if=\"prefixIcon && !$slots.prefix\" custom-class=\"wd-input__icon\" :name=\"prefixIcon\" @click=\"onClickPrefixIcon\" />\n          <slot v-else name=\"prefix\"></slot>\n        </view>\n        <input\n          :class=\"[\n            'wd-input__inner',\n            prefixIcon ? 'wd-input__inner--prefix' : '',\n            showWordCount ? 'wd-input__inner--count' : '',\n            alignRight ? 'is-align-right' : '',\n            customInputClass\n          ]\"\n          :type=\"type\"\n          :password=\"showPassword && !isPwdVisible\"\n          v-model=\"inputValue\"\n          :placeholder=\"placeholderValue\"\n          :disabled=\"disabled || readonly\"\n          :maxlength=\"maxlength\"\n          :focus=\"focused\"\n          :confirm-type=\"confirmType\"\n          :confirm-hold=\"confirmHold\"\n          :cursor=\"cursor\"\n          :cursor-spacing=\"cursorSpacing\"\n          :placeholder-style=\"placeholderStyle\"\n          :selection-start=\"selectionStart\"\n          :selection-end=\"selectionEnd\"\n          :adjust-position=\"adjustPosition\"\n          :hold-keyboard=\"holdKeyboard\"\n          :always-embed=\"alwaysEmbed\"\n          :placeholder-class=\"inputPlaceholderClass\"\n          :ignoreCompositionEvent=\"ignoreCompositionEvent\"\n          :inputmode=\"inputmode\"\n          @input=\"handleInput\"\n          @focus=\"handleFocus\"\n          @blur=\"handleBlur\"\n          @confirm=\"handleConfirm\"\n          @keyboardheightchange=\"handleKeyboardheightchange\"\n        />\n        <view v-if=\"props.readonly\" class=\"wd-input__readonly-mask\" />\n        <view v-if=\"showClear || showPassword || suffixIcon || showWordCount || $slots.suffix\" class=\"wd-input__suffix\">\n          <wd-icon v-if=\"showClear\" custom-class=\"wd-input__clear\" name=\"error-fill\" @click=\"handleClear\" />\n          <wd-icon v-if=\"showPassword\" custom-class=\"wd-input__icon\" :name=\"isPwdVisible ? 'view' : 'eye-close'\" @click=\"togglePwdVisible\" />\n          <view v-if=\"showWordCount\" class=\"wd-input__count\">\n            <text\n              :class=\"[\n              inputValue && String(inputValue).length > 0 ? 'wd-input__count-current' : '',\n              String(inputValue).length > maxlength! ? 'is-error' : ''\n            ]\"\n            >\n              {{ String(inputValue).length }}\n            </text>\n            /{{ maxlength }}\n          </view>\n          <wd-icon v-if=\"suffixIcon && !$slots.suffix\" custom-class=\"wd-input__icon\" :name=\"suffixIcon\" @click=\"onClickSuffixIcon\" />\n          <slot v-else name=\"suffix\"></slot>\n        </view>\n      </view>\n      <view v-if=\"errorMessage\" class=\"wd-input__error-message\">{{ errorMessage }}</view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-input',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport { computed, ref, watch, useSlots, type Slots } from 'vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { isDef, objToStyle, pause, isEqual } from '../common/util'\nimport { useCell } from '../composables/useCell'\nimport { FORM_KEY, type FormItemRule } from '../wd-form/types'\nimport { useParent } from '../composables/useParent'\nimport { useTranslate } from '../composables/useTranslate'\nimport { inputProps } from './types'\n\ninterface InputSlots extends Slots {\n  prefix?: () => any\n  suffix?: () => any\n  label?: () => any\n}\n\nconst props = defineProps(inputProps)\nconst emit = defineEmits([\n  'update:modelValue',\n  'clear',\n  'blur',\n  'focus',\n  'input',\n  'keyboardheightchange',\n  'confirm',\n  'clicksuffixicon',\n  'clickprefixicon',\n  'click'\n])\nconst slots = useSlots() as InputSlots\nconst { translate } = useTranslate('input')\n\nconst isPwdVisible = ref<boolean>(false)\nconst clearing = ref<boolean>(false) // 是否正在清空操作，避免重复触发失焦\nconst focused = ref<boolean>(false) // 控制聚焦\nconst focusing = ref<boolean>(false) // 当前是否激活状态\nconst inputValue = ref<string | number>(getInitValue()) // 输入框的值\nconst cell = useCell()\n\nwatch(\n  () => props.focus,\n  (newValue) => {\n    focused.value = newValue\n  },\n  { immediate: true, deep: true }\n)\n\nwatch(\n  () => props.modelValue,\n  (newValue) => {\n    inputValue.value = isDef(newValue) ? String(newValue) : ''\n  }\n)\n\nconst { parent: form } = useParent(FORM_KEY)\n\nconst placeholderValue = computed(() => {\n  return isDef(props.placeholder) ? props.placeholder : translate('placeholder')\n})\n\n/**\n * 展示清空按钮\n */\nconst showClear = computed(() => {\n  const { disabled, readonly, clearable, clearTrigger } = props\n  if (clearable && !readonly && !disabled && inputValue.value && (clearTrigger === 'always' || (props.clearTrigger === 'focus' && focusing.value))) {\n    return true\n  } else {\n    return false\n  }\n})\n\n/**\n * 展示字数统计\n */\nconst showWordCount = computed(() => {\n  const { disabled, readonly, maxlength, showWordLimit } = props\n  return Boolean(!disabled && !readonly && isDef(maxlength) && maxlength > -1 && showWordLimit)\n})\n\n/**\n * 表单错误提示信息\n */\nconst errorMessage = computed(() => {\n  if (form && props.prop && form.errorMessages && form.errorMessages[props.prop]) {\n    return form.errorMessages[props.prop]\n  } else {\n    return ''\n  }\n})\n\n// 是否展示必填\nconst isRequired = computed(() => {\n  let formRequired = false\n  if (form && form.props.rules) {\n    const rules = form.props.rules\n    for (const key in rules) {\n      if (Object.prototype.hasOwnProperty.call(rules, key) && key === props.prop && Array.isArray(rules[key])) {\n        formRequired = rules[key].some((rule: FormItemRule) => rule.required)\n      }\n    }\n  }\n  return props.required || props.rules.some((rule) => rule.required) || formRequired\n})\n\nconst rootClass = computed(() => {\n  return `wd-input  ${props.label || slots.label ? 'is-cell' : ''} ${props.center ? 'is-center' : ''} ${cell.border.value ? 'is-border' : ''} ${\n    props.size ? 'is-' + props.size : ''\n  } ${props.error ? 'is-error' : ''} ${props.disabled ? 'is-disabled' : ''}  ${\n    inputValue.value && String(inputValue.value).length > 0 ? 'is-not-empty' : ''\n  }  ${props.noBorder ? 'is-no-border' : ''} ${props.customClass}`\n})\n\nconst labelClass = computed(() => {\n  return `wd-input__label ${props.customLabelClass} ${isRequired.value ? 'is-required' : ''}`\n})\n\nconst inputPlaceholderClass = computed(() => {\n  return `wd-input__placeholder  ${props.placeholderClass}`\n})\n\nconst labelStyle = computed(() => {\n  return props.labelWidth\n    ? objToStyle({\n        'min-width': props.labelWidth,\n        'max-width': props.labelWidth\n      })\n    : ''\n})\n\n// 状态初始化\nfunction getInitValue() {\n  const formatted = formatValue(props.modelValue)\n  if (!isValueEqual(formatted, props.modelValue)) {\n    emit('update:modelValue', formatted)\n  }\n  return formatted\n}\n\nfunction formatValue(value: string | number) {\n  const { maxlength } = props\n  if (isDef(maxlength) && maxlength !== -1 && String(value).length > maxlength) {\n    return value.toString().slice(0, maxlength)\n  }\n  return value\n}\n\nfunction togglePwdVisible() {\n  isPwdVisible.value = !isPwdVisible.value\n}\nasync function handleClear() {\n  clearing.value = true\n  focusing.value = false\n  inputValue.value = ''\n  if (props.focusWhenClear) {\n    focused.value = false\n  }\n  await pause()\n  if (props.focusWhenClear) {\n    focused.value = true\n    focusing.value = true\n  }\n  emit('update:modelValue', inputValue.value)\n  emit('clear')\n}\nasync function handleBlur() {\n  // 等待150毫秒，clear执行完毕\n  await pause(150)\n  if (clearing.value) {\n    clearing.value = false\n    return\n  }\n  focusing.value = false\n  emit('blur', {\n    value: inputValue.value\n  })\n}\nfunction handleFocus({ detail }: any) {\n  focusing.value = true\n  emit('focus', detail)\n}\nfunction handleInput({ detail }: any) {\n  emit('update:modelValue', inputValue.value)\n  emit('input', detail)\n}\nfunction handleKeyboardheightchange({ detail }: any) {\n  emit('keyboardheightchange', detail)\n}\nfunction handleConfirm({ detail }: any) {\n  emit('confirm', detail)\n}\nfunction onClickSuffixIcon() {\n  emit('clicksuffixicon')\n}\nfunction onClickPrefixIcon() {\n  emit('clickprefixicon')\n}\nfunction handleClick(event: MouseEvent) {\n  emit('click', event)\n}\nfunction isValueEqual(value1: number | string, value2: number | string) {\n  return isEqual(String(value1), String(value2))\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n<style lang=\"scss\">\n@import './placeholder.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-input/wd-input.vue'\nwx.createComponent(Component)"],"names":["wdIcon","__default__","props","__props","emit","__emit","slots","useSlots","translate","useTranslate","isPwdVisible","ref","clearing","focused","focusing","inputValue","getInitValue","cell","useCell","watch","newValue","isDef","form","useParent","FORM_KEY","placeholderValue","computed","showClear","disabled","readonly","clearable","clearTrigger","showWordCount","maxlength","showWordLimit","errorMessage","isRequired","formRequired","rules","key","rule","rootClass","labelClass","inputPlaceholderClass","labelStyle","objToStyle","formatted","formatValue","isValueEqual","value","togglePwdVisible","handleClear","pause","handleBlur","handleFocus","detail","handleInput","handleKeyboardheightchange","handleConfirm","onClickSuffixIcon","onClickPrefixIcon","handleClick","event","value1","value2","isEqual","Component"],"mappings":"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"}