{"version":3,"file":"wd-table.js","sources":["uni_modules/wot-design-uni/components/wd-table/wd-table.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-table/wd-table.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"`wd-table ${border ? 'is-border' : ''} ${customClass}`\" :style=\"tableStyle\">\n    <template v-if=\"fixedHeader\">\n      <scroll-view\n        :enable-flex=\"true\"\n        :throttle=\"false\"\n        :scrollLeft=\"state.scrollLeft\"\n        :scroll-x=\"true\"\n        class=\"wd-table__header\"\n        @scroll=\"scroll\"\n        v-if=\"showHeader\"\n      >\n        <view id=\"table-header\" class=\"wd-table__content wd-table__content--header\" :style=\"realWidthStyle\">\n          <view\n            :class=\"`wd-table__cell ${border ? 'is-border' : ''} ${column.fixed ? 'is-fixed' : ''} ${stripe ? 'is-stripe' : ''} is-${column.align} ${\n              getIsLastFixed(column) && state.scrollLeft ? 'is-shadow' : ''\n            }`\"\n            :style=\"getCellStyle(index)\"\n            v-for=\"(column, index) in children\"\n            :key=\"index\"\n          >\n            <wd-sort-button\n              v-model=\"column.$.exposed!.sortDirection.value\"\n              allow-reset\n              :line=\"false\"\n              :title=\"column.label\"\n              @change=\"({ value }) => handleSortChange(value, index)\"\n              v-if=\"column.sortable\"\n            />\n            <text v-else :class=\"`wd-table__value ${ellipsis ? 'is-ellipsis' : ''}`\">{{ column.label }}</text>\n          </view>\n        </view>\n      </scroll-view>\n      <scroll-view\n        class=\"wd-table__body\"\n        :style=\"bodyStyle\"\n        :enable-flex=\"true\"\n        :throttle=\"false\"\n        :scroll-x=\"true\"\n        @scroll=\"scroll\"\n        :scrollLeft=\"state.scrollLeft\"\n      >\n        <view id=\"table-body\" class=\"wd-table__content\" :style=\"realWidthStyle\">\n          <wd-table-col\n            v-if=\"index !== false\"\n            :prop=\"indexColumn.prop\"\n            :label=\"indexColumn.label\"\n            :width=\"indexColumn.width\"\n            :sortable=\"indexColumn.sortable\"\n            :fixed=\"indexColumn.fixed\"\n            :align=\"indexColumn.align\"\n          >\n            <template #value=\"{ index }\">\n              <text>{{ index + 1 }}</text>\n            </template>\n          </wd-table-col>\n          <slot></slot>\n        </view>\n      </scroll-view>\n    </template>\n    <!-- 非固定表头时使用单个scroll-view -->\n    <template v-else>\n      <scroll-view class=\"wd-table__wrapper\" :enable-flex=\"true\" :throttle=\"false\" :scroll-x=\"true\" @scroll=\"scroll\" :scrollLeft=\"state.scrollLeft\">\n        <view class=\"wd-table__inner\" :style=\"realWidthStyle\">\n          <!-- 表头部分 -->\n          <view v-if=\"showHeader\" class=\"wd-table__header-row\">\n            <view\n              v-for=\"(column, index) in children\"\n              :key=\"index\"\n              :class=\"`wd-table__cell ${border ? 'is-border' : ''} ${column.fixed ? 'is-fixed' : ''} ${stripe ? 'is-stripe' : ''} is-${\n                column.align\n              } ${getIsLastFixed(column) && state.scrollLeft ? 'is-shadow' : ''}`\"\n              :style=\"getCellStyle(index)\"\n            >\n              <wd-sort-button\n                v-if=\"column.sortable\"\n                v-model=\"column.$.exposed!.sortDirection.value\"\n                allow-reset\n                :line=\"false\"\n                :title=\"column.label\"\n                @change=\"({ value }) => handleSortChange(value, index)\"\n              />\n              <text v-else :class=\"`wd-table__value ${ellipsis ? 'is-ellipsis' : ''}`\">{{ column.label }}</text>\n            </view>\n          </view>\n\n          <!-- 表格内容部分 -->\n          <view class=\"wd-table__content\" :style=\"bodyStyle\">\n            <wd-table-col\n              v-if=\"index !== false\"\n              :prop=\"indexColumn.prop\"\n              :label=\"indexColumn.label\"\n              :width=\"indexColumn.width\"\n              :sortable=\"indexColumn.sortable\"\n              :fixed=\"indexColumn.fixed\"\n              :align=\"indexColumn.align\"\n            >\n              <template #value=\"{ index }\">\n                <text>{{ index + 1 }}</text>\n              </template>\n            </wd-table-col>\n            <slot></slot>\n          </view>\n        </view>\n      </scroll-view>\n    </template>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-table',\n  options: {\n    addGlobalClass: true,\n    virtualHost: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdTableCol from '../wd-table-col/wd-table-col.vue'\nimport wdSortButton from '../wd-sort-button/wd-sort-button.vue'\nimport { type CSSProperties, computed, reactive, ref } from 'vue'\nimport { addUnit, debounce, isDef, isObj, objToStyle, uuid } from '../common/util'\nimport type { SortDirection, TableColumn, TableColumnInstance, TableColumnProps } from '../wd-table-col/types'\nimport { TABLE_KEY, tableProps, type TableProvide } from './types'\nimport WdTableCol from '../wd-table-col/wd-table-col.vue'\nimport { useTranslate } from '../composables/useTranslate'\nimport { useChildren } from '../composables/useChildren'\n\nconst { translate } = useTranslate('tableCol')\n\nconst props = defineProps(tableProps)\nconst emit = defineEmits(['sort-method', 'row-click'])\n\nconst state = reactive({\n  scrollLeft: 0\n})\n\nconst { linkChildren, children } = useChildren<TableColumnInstance, TableProvide>(TABLE_KEY)\n\nlinkChildren({ props, state, rowClick, getIsLastFixed, getFixedStyle })\n\nconst indexUUID = uuid()\nconst indexColumn = ref<TableColumnProps>({\n  prop: indexUUID,\n  label: translate('indexLabel'),\n  width: '100rpx',\n  sortable: false,\n  fixed: false,\n  align: 'left',\n  ...(isObj(props.index) ? props.index : {})\n})\n\nconst scroll = debounce(handleScroll, 100, { leading: false }) // 滚动事件\n\n/**\n * 容器样式\n */\nconst tableStyle = computed(() => {\n  const style: CSSProperties = {}\n  if (isDef(props.height)) {\n    style['max-height'] = addUnit(props.height)\n  }\n  return `${objToStyle(style)}${props.customStyle}`\n})\n\nconst realWidthStyle = computed(() => {\n  const style: CSSProperties = {\n    display: 'flex'\n  }\n  let width: string | number = ''\n  children.forEach((child) => {\n    width = width ? `${width} + ${addUnit(child.width)}` : addUnit(child.width)\n  })\n  style['width'] = `calc(${width})`\n  return objToStyle(style)\n})\n\nconst bodyStyle = computed(() => {\n  const style: CSSProperties = {}\n  if (isDef(props.height)) {\n    style['height'] = isDef(props.rowHeight) ? `calc(${props.data.length} * ${addUnit(props.rowHeight)})` : `calc(${props.data.length} * 50px)`\n  }\n  return `${objToStyle(style)}`\n})\n\n/**\n * 是否最后一个固定元素\n * @param column 列数据\n */\nfunction getIsLastFixed(column: { fixed: boolean; prop: string }) {\n  let isLastFixed: boolean = false\n  if (column.fixed && isDef(children)) {\n    const columns = children.filter((child) => {\n      return child.fixed\n    })\n    if (columns.length && columns[columns.length - 1].prop === column.prop) {\n      isLastFixed = true\n    }\n  }\n  return isLastFixed\n}\n\n/**\n * 表头单元格样式\n */\nfunction getCellStyle(columnIndex: number) {\n  let style: CSSProperties = {}\n  if (isDef(children[columnIndex].width)) {\n    style['width'] = addUnit(children[columnIndex].width)\n  }\n  if (children[columnIndex].fixed) {\n    style = getFixedStyle(columnIndex, style)\n  }\n  return objToStyle(style)\n}\n\n/**\n * 获取固定列样式\n * @param columnIndex\n */\nfunction getFixedStyle(columnIndex: number, style: CSSProperties) {\n  if (columnIndex > 0) {\n    let left: string | number = ''\n    children.forEach((column, index) => {\n      if (index < columnIndex) {\n        left = left ? `${left} + ${addUnit(column.width)}` : addUnit(column.width)\n      }\n    })\n    style['left'] = `calc(${left})`\n  } else {\n    style['left'] = 0\n  }\n  return style\n}\n\n/**\n * 排序\n * @param value\n * @param index\n */\nfunction handleSortChange(value: SortDirection, index: number) {\n  children[index].$.exposed!.sortDirection.value = value\n  children.forEach((col, i) => {\n    if (index != i) {\n      col.$.exposed!.sortDirection.value = 0\n    }\n  })\n  const column: TableColumn = {\n    // 列对应字段\n    prop: children[index].prop,\n    // 列对应字段标题\n    label: children[index].label,\n    // 列宽度\n    width: children[index].width,\n    // 是否开启列排序\n    sortable: children[index].sortable,\n    // 列的对齐方式，可选值left,center,right\n    align: children[index].align,\n    // 列的排序方向\n    sortDirection: value,\n    // 是否i固定列\n    fixed: children[index].fixed\n  }\n  emit('sort-method', column)\n}\n\n/**\n * 滚动事件\n */\nfunction handleScroll(event: any) {\n  state.scrollLeft = event.detail.scrollLeft\n}\n\nfunction rowClick(index: number) {\n  emit('row-click', { rowIndex: index })\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-table/wd-table.vue'\nwx.createComponent(Component)"],"names":["wdTableCol","wdSortButton","__default__","translate","useTranslate","props","__props","emit","__emit","state","reactive","linkChildren","children","useChildren","TABLE_KEY","rowClick","getIsLastFixed","getFixedStyle","indexUUID","uuid","indexColumn","ref","isObj","scroll","debounce","handleScroll","tableStyle","computed","style","isDef","addUnit","objToStyle","realWidthStyle","width","child","bodyStyle","column","isLastFixed","columns","getCellStyle","columnIndex","left","index","handleSortChange","value","col","i","event","Component"],"mappings":"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"}