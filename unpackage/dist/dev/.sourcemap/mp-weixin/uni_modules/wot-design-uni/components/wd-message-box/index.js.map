{"version":3,"file":"index.js","sources":["uni_modules/wot-design-uni/components/wd-message-box/index.ts"],"sourcesContent":["/*\n * @Author: weisheng\n * @Date: 2022-12-14 17:33:21\n * @LastEditTime: 2024-12-05 13:23:17\n * @LastEditors: weisheng\n * @Description:\n * @FilePath: \\wot-design-uni\\src\\uni_modules\\wot-design-uni\\components\\wd-message-box\\index.ts\n * 记得注释\n */\nimport { inject, provide, ref } from 'vue'\nimport type { Message, MessageOptions, MessageOptionsWithCallBack, MessageResult, MessageType } from './types'\nimport { deepMerge } from '../common/util'\n\nconst messageDefaultOptionKey = '__MESSAGE_OPTION__'\n\nconst None = Symbol('None')\n\n// 默认模板\nexport const defaultOptions: MessageOptionsWithCallBack = {\n  title: '',\n  showCancelButton: false,\n  show: false,\n  closeOnClickModal: true,\n  msg: '',\n  type: 'alert',\n  inputType: 'text',\n  inputValue: '',\n  showErr: false,\n  zIndex: 99,\n  lazyRender: true,\n  inputError: ''\n}\n\nexport function useMessage(selector: string = ''): Message {\n  const messageOptionKey = selector ? messageDefaultOptionKey + selector : messageDefaultOptionKey\n  const messageOption = inject(messageOptionKey, ref<MessageOptionsWithCallBack | typeof None>(None)) // Message选项\n  if (messageOption.value === None) {\n    messageOption.value = defaultOptions\n    provide(messageOptionKey, messageOption)\n  }\n\n  const createMethod = (type: MessageType) => {\n    // 优先级：options->MessageOptions->defaultOptions\n    return (options: MessageOptions | string) => {\n      const messageOptions = deepMerge({ type: type }, typeof options === 'string' ? { title: options } : options) as MessageOptions\n      if (messageOptions.type === 'confirm' || messageOptions.type === 'prompt') {\n        messageOptions.showCancelButton = true\n      } else {\n        messageOptions.showCancelButton = false\n      }\n      return show(messageOptions)\n    }\n  }\n\n  const show = (option: MessageOptions | string) => {\n    // 返回一个promise\n    return new Promise<MessageResult>((resolve, reject) => {\n      const options = deepMerge(defaultOptions, typeof option === 'string' ? { title: option } : option)\n      messageOption.value = deepMerge(options, {\n        show: true,\n        success: (res: MessageResult) => {\n          close()\n          resolve(res)\n        },\n        fail: (res: MessageResult) => {\n          close()\n          reject(res)\n        }\n      })\n    })\n  }\n\n  // 打开Alert 弹框\n  const alert = createMethod('alert')\n  // 打开Confirm 弹框\n  const confirm = createMethod('confirm')\n  // 打开Prompt 弹框\n  const prompt = createMethod('prompt')\n\n  const close = () => {\n    if (messageOption.value !== None) {\n      messageOption.value.show = false\n    }\n  }\n  return {\n    show,\n    alert,\n    confirm,\n    prompt,\n    close\n  }\n}\n\nexport const getMessageDefaultOptionKey = (selector: string) => {\n  return selector ? `${messageDefaultOptionKey}${selector}` : messageDefaultOptionKey\n}\n"],"names":["messageDefaultOptionKey","None","defaultOptions","useMessage","selector","messageOptionKey","messageOption","inject","ref","provide","createMethod","type","options","messageOptions","deepMerge","show","option","resolve","reject","res","close","alert","confirm","prompt","getMessageDefaultOptionKey"],"mappings":"4FAaMA,EAA0B,qBAE1BC,EAAO,OAAO,MAAM,EAGbC,EAA6C,CACxD,MAAO,GACP,iBAAkB,GAClB,KAAM,GACN,kBAAmB,GACnB,IAAK,GACL,KAAM,QACN,UAAW,OACX,WAAY,GACZ,QAAS,GACT,OAAQ,GACR,WAAY,GACZ,WAAY,EACd,EAEgB,SAAAC,EAAWC,EAAmB,GAAa,CACnD,MAAAC,EAAmBD,EAAWJ,EAA0BI,EAAWJ,EACnEM,EAAgBC,EAAAA,OAAOF,EAAkBG,EAAAA,IAA8CP,CAAI,CAAC,EAC9FK,EAAc,QAAUL,IAC1BK,EAAc,MAAQJ,EACtBO,UAAQJ,EAAkBC,CAAa,GAGnC,MAAAI,EAAgBC,GAEZC,GAAqC,CAC3C,MAAMC,EAAiBC,EAAAA,UAAU,CAAE,KAAAH,CAAc,EAAA,OAAOC,GAAY,SAAW,CAAE,MAAOA,CAAQ,EAAIA,CAAO,EAC3G,OAAIC,EAAe,OAAS,WAAaA,EAAe,OAAS,SAC/DA,EAAe,iBAAmB,GAElCA,EAAe,iBAAmB,GAE7BE,EAAKF,CAAc,CAAA,EAIxBE,EAAQC,GAEL,IAAI,QAAuB,CAACC,EAASC,IAAW,CAC/C,MAAAN,EAAUE,EAAAA,UAAUZ,EAAgB,OAAOc,GAAW,SAAW,CAAE,MAAOA,GAAWA,CAAM,EACnFV,EAAA,MAAQQ,YAAUF,EAAS,CACvC,KAAM,GACN,QAAUO,GAAuB,CACzBC,IACNH,EAAQE,CAAG,CACb,EACA,KAAOA,GAAuB,CACtBC,IACNF,EAAOC,CAAG,CACZ,CAAA,CACD,CAAA,CACF,EAIGE,EAAQX,EAAa,OAAO,EAE5BY,EAAUZ,EAAa,SAAS,EAEhCa,EAASb,EAAa,QAAQ,EAE9BU,EAAQ,IAAM,CACdd,EAAc,QAAUL,IAC1BK,EAAc,MAAM,KAAO,GAC7B,EAEK,MAAA,CACL,KAAAS,EACA,MAAAM,EACA,QAAAC,EACA,OAAAC,EACA,MAAAH,CAAA,CAEJ,CAEa,MAAAI,EAA8BpB,GAClCA,EAAW,GAAGJ,CAAuB,GAAGI,CAAQ,GAAKJ"}