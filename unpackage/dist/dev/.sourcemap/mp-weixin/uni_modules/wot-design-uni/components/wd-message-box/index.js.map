{"version":3,"file":"index.js","sources":["uni_modules/wot-design-uni/components/wd-message-box/index.ts"],"sourcesContent":["/*\n * @Author: weisheng\n * @Date: 2022-12-14 17:33:21\n * @LastEditTime: 2024-12-05 13:23:17\n * @LastEditors: weisheng\n * @Description:\n * @FilePath: \\wot-design-uni\\src\\uni_modules\\wot-design-uni\\components\\wd-message-box\\index.ts\n * 记得注释\n */\nimport { inject, provide, ref } from 'vue'\nimport type { Message, MessageOptions, MessageOptionsWithCallBack, MessageResult, MessageType } from './types'\nimport { deepMerge } from '../common/util'\n\nconst messageDefaultOptionKey = '__MESSAGE_OPTION__'\n\nconst None = Symbol('None')\n\n// 默认模板\nexport const defaultOptions: MessageOptionsWithCallBack = {\n  title: '',\n  showCancelButton: false,\n  show: false,\n  closeOnClickModal: true,\n  msg: '',\n  type: 'alert',\n  inputType: 'text',\n  inputValue: '',\n  showErr: false,\n  zIndex: 99,\n  lazyRender: true,\n  inputError: ''\n}\n\nexport function useMessage(selector: string = ''): Message {\n  const messageOptionKey = selector ? messageDefaultOptionKey + selector : messageDefaultOptionKey\n  const messageOption = inject(messageOptionKey, ref<MessageOptionsWithCallBack | typeof None>(None)) // Message选项\n  if (messageOption.value === None) {\n    messageOption.value = defaultOptions\n    provide(messageOptionKey, messageOption)\n  }\n\n  const createMethod = (type: MessageType) => {\n    // 优先级：options->MessageOptions->defaultOptions\n    return (options: MessageOptions | string) => {\n      const messageOptions = deepMerge({ type: type }, typeof options === 'string' ? { title: options } : options) as MessageOptions\n      if (messageOptions.type === 'confirm' || messageOptions.type === 'prompt') {\n        messageOptions.showCancelButton = true\n      } else {\n        messageOptions.showCancelButton = false\n      }\n      return show(messageOptions)\n    }\n  }\n\n  const show = (option: MessageOptions | string) => {\n    // 返回一个promise\n    return new Promise<MessageResult>((resolve, reject) => {\n      const options = deepMerge(defaultOptions, typeof option === 'string' ? { title: option } : option)\n      messageOption.value = deepMerge(options, {\n        show: true,\n        success: (res: MessageResult) => {\n          close()\n          resolve(res)\n        },\n        fail: (res: MessageResult) => {\n          close()\n          reject(res)\n        }\n      })\n    })\n  }\n\n  // 打开Alert 弹框\n  const alert = createMethod('alert')\n  // 打开Confirm 弹框\n  const confirm = createMethod('confirm')\n  // 打开Prompt 弹框\n  const prompt = createMethod('prompt')\n\n  const close = () => {\n    if (messageOption.value !== None) {\n      messageOption.value.show = false\n    }\n  }\n  return {\n    show,\n    alert,\n    confirm,\n    prompt,\n    close\n  }\n}\n\nexport const getMessageDefaultOptionKey = (selector: string) => {\n  return selector ? `${messageDefaultOptionKey}${selector}` : messageDefaultOptionKey\n}\n"],"names":["inject","ref","provide","deepMerge"],"mappings":";;;AAaA,MAAM,0BAA0B;AAEhC,MAAM,OAAO,OAAO,MAAM;AAGnB,MAAM,iBAA6C;AAAA,EACxD,OAAO;AAAA,EACP,kBAAkB;AAAA,EAClB,MAAM;AAAA,EACN,mBAAmB;AAAA,EACnB,KAAK;AAAA,EACL,MAAM;AAAA,EACN,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,YAAY;AACd;AAEgB,SAAA,WAAW,WAAmB,IAAa;AACnD,QAAA,mBAAmB,WAAW,0BAA0B,WAAW;AACzE,QAAM,gBAAgBA,cAAAA,OAAO,kBAAkBC,cAAAA,IAA8C,IAAI,CAAC;AAC9F,MAAA,cAAc,UAAU,MAAM;AAChC,kBAAc,QAAQ;AACtBC,0BAAQ,kBAAkB,aAAa;AAAA,EACzC;AAEM,QAAA,eAAe,CAAC,SAAsB;AAE1C,WAAO,CAAC,YAAqC;AAC3C,YAAM,iBAAiBC,gDAAAA,UAAU,EAAE,KAAc,GAAA,OAAO,YAAY,WAAW,EAAE,OAAO,QAAQ,IAAI,OAAO;AAC3G,UAAI,eAAe,SAAS,aAAa,eAAe,SAAS,UAAU;AACzE,uBAAe,mBAAmB;AAAA,MAAA,OAC7B;AACL,uBAAe,mBAAmB;AAAA,MACpC;AACA,aAAO,KAAK,cAAc;AAAA,IAAA;AAAA,EAC5B;AAGI,QAAA,OAAO,CAAC,WAAoC;AAEhD,WAAO,IAAI,QAAuB,CAAC,SAAS,WAAW;AAC/C,YAAA,UAAUA,gDAAAA,UAAU,gBAAgB,OAAO,WAAW,WAAW,EAAE,OAAO,WAAW,MAAM;AACnF,oBAAA,QAAQA,0DAAU,SAAS;AAAA,QACvC,MAAM;AAAA,QACN,SAAS,CAAC,QAAuB;AACzB;AACN,kBAAQ,GAAG;AAAA,QACb;AAAA,QACA,MAAM,CAAC,QAAuB;AACtB;AACN,iBAAO,GAAG;AAAA,QACZ;AAAA,MAAA,CACD;AAAA,IAAA,CACF;AAAA,EAAA;AAIG,QAAA,QAAQ,aAAa,OAAO;AAE5B,QAAA,UAAU,aAAa,SAAS;AAEhC,QAAA,SAAS,aAAa,QAAQ;AAEpC,QAAM,QAAQ,MAAM;AACd,QAAA,cAAc,UAAU,MAAM;AAChC,oBAAc,MAAM,OAAO;AAAA,IAC7B;AAAA,EAAA;AAEK,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;AAEa,MAAA,6BAA6B,CAAC,aAAqB;AAC9D,SAAO,WAAW,GAAG,uBAAuB,GAAG,QAAQ,KAAK;AAC9D;;;;"}