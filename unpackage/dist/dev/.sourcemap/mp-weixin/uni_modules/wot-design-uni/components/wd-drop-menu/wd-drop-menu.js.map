{"version":3,"file":"wd-drop-menu.js","sources":["uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue?type=component"],"sourcesContent":["<template>\n  <view :style=\"customStyle\" :class=\"`wd-drop-menu ${customClass}`\" @click.stop.prevent=\"noop\" :id=\"dropMenuId\">\n    <wd-overlay :show=\"overlayVisible\" :duration=\"duration\" :z-index=\"12\" :custom-style=\"modalStyle\" @click=\"handleClickOverlay\" @touchmove=\"noop\" />\n\n\n\n\n      <view class=\"wd-drop-menu__list\">\n        <view\n          v-for=\"(child, index) in children\"\n          :key=\"index\"\n          @click=\"toggle(child)\"\n          :class=\"`wd-drop-menu__item ${child.disabled ? 'is-disabled' : ''} ${child.$.exposed!.getShowPop() ? 'is-active' : ''}`\"\n        >\n          <view class=\"wd-drop-menu__item-title\" @click=\"$emit('click', child, index)\">\n            <view class=\"wd-drop-menu__item-title-text\" :style=\"index == idx ? {fontWeight: 600, color: '#597fe8'} : {}\">{{ getDisplayTitle(child) }}</view>\n            <wd-icon :name=\"child.icon\" :size=\"child.iconSize\" custom-class=\"wd-drop-menu__arrow\" />\n          </view>\n        </view>\n      </view>\n      <slot />\n\n\n\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-drop-menu',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport { computed, getCurrentInstance, inject, onBeforeMount, ref, watch } from 'vue'\nimport { closeOther } from '../common/clickoutside'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport { getRect, uuid } from '../common/util'\nimport { useChildren } from '../composables/useChildren'\nimport { DROP_MENU_KEY, dropMenuProps } from './types'\nimport wdOverlay from '../wd-overlay/wd-overlay.vue'\n\nconst props = defineProps({\n  idx: 0,\n  ...dropMenuProps\n})\nconst queue = inject<Queue | null>(queueKey, null)\nconst dropMenuId = ref<string>(`dropMenuId${uuid()}`)\nconst offset = ref<number>(0)\nconst windowHeight = ref<number>(0)\nconst modalStyle = computed(() => {\n  return props.direction === 'down'\n    ? `top: calc(var(--window-top) + ${offset.value}px); bottom: 0;`\n    : `top: 0; bottom: calc(var(--window-bottom) + ${offset.value}px)`\n})\n\nconst { proxy } = getCurrentInstance() as any\n\nconst { linkChildren, children } = useChildren(DROP_MENU_KEY)\n\nconst showOverlay = computed(() => {\n  return children.some((child) => child.$.exposed!.getShowPop())\n})\n\nconst overlayVisible = ref(false)\nlet overlayTimer: ReturnType<typeof setTimeout> | null\n\n// 延迟关闭遮罩层，避免闪烁\n// 小程序中，即使先 fold 再 closeOther 也会有闪烁，使用延迟关闭遮罩层处理\nwatch(showOverlay, (newVal) => {\n  if (overlayTimer) {\n    clearTimeout(overlayTimer)\n  }\n  if (newVal) {\n    overlayVisible.value = true\n  } else {\n    overlayTimer = setTimeout(() => {\n      overlayVisible.value = false\n      overlayTimer = null\n    }, 16)\n  }\n})\n\nlinkChildren({ props, fold, offset })\n\nwatch(\n  () => props.direction,\n  (newValue) => {\n    if (!['up', 'down'].includes(newValue)) {\n      // eslint-disable-next-line quotes\n      uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue:95',\"[wot design] warning(wd-drop-menu): direction must be 'up' or 'down'\")\n    }\n  },\n  { deep: true, immediate: true }\n)\n\nonBeforeMount(() => {\n  windowHeight.value = uni.getSystemInfoSync().windowHeight\n})\n\nfunction noop() {}\n\nfunction getDisplayTitle(child: any) {\n  const { title, modelValue, options, valueKey, labelKey } = child\n\n  if (title) {\n    return title\n  }\n  for (let i = 0, len = options.length; i < len; i++) {\n    if (modelValue === options[i][valueKey]) {\n      return options[i][labelKey]\n    }\n  }\n  uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue:118','[wot-design] warning(wd-drop-menu-item): no value is matched in the options option.')\n}\n\nfunction toggle(child: any) {\n  // 点击当前 menu, 关闭其他 menu\n  if (child && !child.disabled) {\n    if (queue && queue.closeOther) {\n      queue.closeOther(child)\n    } else {\n      closeOther(child)\n    }\n    fold(child)\n  }\n}\n\n/**\n * 控制菜单内容是否展开\n */\nfunction fold(child: any) {\n  getRect(`#${dropMenuId.value}`, false, proxy).then((rect) => {\n    if (!rect) return\n    const { top, bottom } = rect\n    if (props.direction === 'down') {\n      offset.value = Number(bottom)\n    } else {\n      offset.value = windowHeight.value - Number(top)\n    }\n    child.$.exposed!.toggle()\n  })\n}\n\nfunction handleClickOverlay() {\n  if (props.closeOnClickModal) {\n    // 关闭所有打开的菜单项\n    children.forEach((child) => {\n      child.$.exposed!.close()\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue'\nwx.createComponent(Component)"],"names":["inject","queueKey","ref","uuid","computed","getCurrentInstance","useChildren","DROP_MENU_KEY","watch","uni","onBeforeMount","closeOther","getRect"],"mappings":"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"}