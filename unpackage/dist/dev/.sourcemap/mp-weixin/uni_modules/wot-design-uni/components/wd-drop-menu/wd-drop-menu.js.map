{"version":3,"file":"wd-drop-menu.js","sources":["uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue?type=component"],"sourcesContent":["<template>\n  <view :style=\"customStyle\" :class=\"`wd-drop-menu ${customClass}`\" @click.stop.prevent=\"noop\" :id=\"dropMenuId\">\n    <wd-overlay :show=\"overlayVisible\" :duration=\"duration\" :z-index=\"12\" :custom-style=\"modalStyle\" @click=\"handleClickOverlay\" @touchmove=\"noop\" />\n\n\n\n\n      <view class=\"wd-drop-menu__list\">\n        <view\n          v-for=\"(child, index) in children\"\n          :key=\"index\"\n          @click=\"toggle(child)\"\n          :class=\"`wd-drop-menu__item ${child.disabled ? 'is-disabled' : ''} ${child.$.exposed!.getShowPop() ? 'is-active' : ''}`\"\n        >\n          <view class=\"wd-drop-menu__item-title\" @click=\"$emit('click', child, index)\">\n            <view class=\"wd-drop-menu__item-title-text\" :style=\"index == idx ? {fontWeight: 600, color: '#597fe8'} : {}\">{{ getDisplayTitle(child) }}</view>\n            <wd-icon :name=\"child.icon\" :size=\"child.iconSize\" custom-class=\"wd-drop-menu__arrow\" />\n          </view>\n        </view>\n      </view>\n      <slot />\n\n\n\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-drop-menu',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport { computed, getCurrentInstance, inject, onBeforeMount, ref, watch } from 'vue'\nimport { closeOther } from '../common/clickoutside'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport { getRect, uuid } from '../common/util'\nimport { useChildren } from '../composables/useChildren'\nimport { DROP_MENU_KEY, dropMenuProps } from './types'\nimport wdOverlay from '../wd-overlay/wd-overlay.vue'\n\nconst props = defineProps({\n  idx: 0,\n  ...dropMenuProps\n})\nconst queue = inject<Queue | null>(queueKey, null)\nconst dropMenuId = ref<string>(`dropMenuId${uuid()}`)\nconst offset = ref<number>(0)\nconst windowHeight = ref<number>(0)\nconst modalStyle = computed(() => {\n  return props.direction === 'down'\n    ? `top: calc(var(--window-top) + ${offset.value}px); bottom: 0;`\n    : `top: 0; bottom: calc(var(--window-bottom) + ${offset.value}px)`\n})\n\nconst { proxy } = getCurrentInstance() as any\n\nconst { linkChildren, children } = useChildren(DROP_MENU_KEY)\n\nconst showOverlay = computed(() => {\n  return children.some((child) => child.$.exposed!.getShowPop())\n})\n\nconst overlayVisible = ref(false)\nlet overlayTimer: ReturnType<typeof setTimeout> | null\n\n// 延迟关闭遮罩层，避免闪烁\n// 小程序中，即使先 fold 再 closeOther 也会有闪烁，使用延迟关闭遮罩层处理\nwatch(showOverlay, (newVal) => {\n  if (overlayTimer) {\n    clearTimeout(overlayTimer)\n  }\n  if (newVal) {\n    overlayVisible.value = true\n  } else {\n    overlayTimer = setTimeout(() => {\n      overlayVisible.value = false\n      overlayTimer = null\n    }, 16)\n  }\n})\n\nlinkChildren({ props, fold, offset })\n\nwatch(\n  () => props.direction,\n  (newValue) => {\n    if (!['up', 'down'].includes(newValue)) {\n      // eslint-disable-next-line quotes\n      uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue:95',\"[wot design] warning(wd-drop-menu): direction must be 'up' or 'down'\")\n    }\n  },\n  { deep: true, immediate: true }\n)\n\nonBeforeMount(() => {\n  windowHeight.value = uni.getSystemInfoSync().windowHeight\n})\n\nfunction noop() {}\n\nfunction getDisplayTitle(child: any) {\n  const { title, modelValue, options, valueKey, labelKey } = child\n\n  if (title) {\n    return title\n  }\n  for (let i = 0, len = options.length; i < len; i++) {\n    if (modelValue === options[i][valueKey]) {\n      return options[i][labelKey]\n    }\n  }\n  uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue:118','[wot-design] warning(wd-drop-menu-item): no value is matched in the options option.')\n}\n\nfunction toggle(child: any) {\n  // 点击当前 menu, 关闭其他 menu\n  if (child && !child.disabled) {\n    if (queue && queue.closeOther) {\n      queue.closeOther(child)\n    } else {\n      closeOther(child)\n    }\n    fold(child)\n  }\n}\n\n/**\n * 控制菜单内容是否展开\n */\nfunction fold(child: any) {\n  getRect(`#${dropMenuId.value}`, false, proxy).then((rect) => {\n    if (!rect) return\n    const { top, bottom } = rect\n    if (props.direction === 'down') {\n      offset.value = Number(bottom)\n    } else {\n      offset.value = windowHeight.value - Number(top)\n    }\n    child.$.exposed!.toggle()\n  })\n}\n\nfunction handleClickOverlay() {\n  if (props.closeOnClickModal) {\n    // 关闭所有打开的菜单项\n    children.forEach((child) => {\n      child.$.exposed!.close()\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu/wd-drop-menu.vue'\nwx.createComponent(Component)"],"names":["wdOverlay","__default__","props","__props","queue","inject","queueKey","dropMenuId","ref","uuid","offset","windowHeight","modalStyle","computed","proxy","getCurrentInstance","linkChildren","children","useChildren","DROP_MENU_KEY","showOverlay","child","overlayVisible","overlayTimer","watch","newVal","fold","newValue","uni","onBeforeMount","noop","getDisplayTitle","title","modelValue","options","valueKey","labelKey","i","len","toggle","closeOther","getRect","rect","top","bottom","handleClickOverlay","Component"],"mappings":"uUA4CA,MAAAA,EAAsB,IAAA,8BAjBtBC,EAAe,CACb,KAAM,eACN,QAAS,CACP,YAAa,GACb,eAAgB,GAChB,eAAgB,QAClB,CACF,sEAYA,MAAMC,EAAQC,EAIRC,EAAQC,EAAAA,OAAqBC,EAAA,SAAU,IAAI,EAC3CC,EAAaC,EAAAA,IAAY,aAAaC,EAAA,KAAA,CAAM,EAAE,EAC9CC,EAASF,MAAY,CAAC,EACtBG,EAAeH,MAAY,CAAC,EAC5BI,EAAaC,EAAAA,SAAS,IACnBX,EAAM,YAAc,OACvB,iCAAiCQ,EAAO,KAAK,kBAC7C,+CAA+CA,EAAO,KAAK,KAChE,EAEK,CAAE,MAAAI,GAAUC,EAAAA,qBAEZ,CAAE,aAAAC,EAAc,SAAAC,CAAS,EAAIC,cAAYC,EAAa,aAAA,EAEtDC,EAAcP,EAAAA,SAAS,IACpBI,EAAS,KAAMI,GAAUA,EAAM,EAAE,QAAS,YAAY,CAC9D,EAEKC,EAAiBd,MAAI,EAAK,EAC5B,IAAAe,EAIEC,QAAAJ,EAAcK,GAAW,CACzBF,GACF,aAAaA,CAAY,EAEvBE,EACFH,EAAe,MAAQ,GAEvBC,EAAe,WAAW,IAAM,CAC9BD,EAAe,MAAQ,GACRC,EAAA,MACd,EAAE,CACP,CACD,EAEDP,EAAa,CAAE,MAAAd,EAAO,KAAAwB,EAAM,OAAAhB,CAAQ,CAAA,EAEpCc,EAAA,MACE,IAAMtB,EAAM,UACXyB,GAAa,CACP,CAAC,KAAM,MAAM,EAAE,SAASA,CAAQ,GAE/BC,EAAAA,MAAA,MAAM,QAAQ,4EAA4E,sEAAsE,CAExK,EACA,CAAE,KAAM,GAAM,UAAW,EAAK,CAAA,EAGhCC,EAAAA,cAAc,IAAM,CACLlB,EAAA,MAAQiB,EAAAA,MAAI,kBAAA,EAAoB,YAAA,CAC9C,EAED,SAASE,GAAO,CAAC,CAEjB,SAASC,EAAgBV,EAAY,CACnC,KAAM,CAAE,MAAAW,EAAO,WAAAC,EAAY,QAAAC,EAAS,SAAAC,EAAU,SAAAC,CAAa,EAAAf,EAE3D,GAAIW,EACK,OAAAA,EAET,QAASK,EAAI,EAAGC,EAAMJ,EAAQ,OAAQG,EAAIC,EAAKD,IAC7C,GAAIJ,IAAeC,EAAQG,CAAC,EAAEF,CAAQ,EAC7B,OAAAD,EAAQG,CAAC,EAAED,CAAQ,EAG1BR,EAAAA,MAAA,MAAM,QAAQ,6EAA6E,qFAAqF,CACtL,CAEA,SAASW,EAAOlB,EAAY,CAEtBA,GAAS,CAACA,EAAM,WACdjB,GAASA,EAAM,WACjBA,EAAM,WAAWiB,CAAK,EAEtBmB,EAAA,WAAWnB,CAAK,EAElBK,EAAKL,CAAK,EAEd,CAKA,SAASK,EAAKL,EAAY,CAChBoB,EAAAA,QAAA,IAAIlC,EAAW,KAAK,GAAI,GAAOO,CAAK,EAAE,KAAM4B,GAAS,CAC3D,GAAI,CAACA,EAAM,OACL,KAAA,CAAE,IAAAC,EAAK,OAAAC,CAAW,EAAAF,EACpBxC,EAAM,YAAc,OACfQ,EAAA,MAAQ,OAAOkC,CAAM,EAE5BlC,EAAO,MAAQC,EAAa,MAAQ,OAAOgC,CAAG,EAE1CtB,EAAA,EAAE,QAAS,QAAO,CACzB,CACH,CAEA,SAASwB,GAAqB,CACxB3C,EAAM,mBAECe,EAAA,QAASI,GAAU,CACpBA,EAAA,EAAE,QAAS,OAAM,CACxB,CAEL,glBC1JA,GAAG,gBAAgByB,CAAS"}