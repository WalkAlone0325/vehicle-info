{"version":3,"file":"wd-drop-menu-item.js","sources":["uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue?type=component"],"sourcesContent":["<template>\n  <view\n    v-if=\"showWrapper\"\n    :class=\"`wd-drop-item  ${customClass}`\"\n    :style=\"`pointer-events: none; z-index: ${zIndex}; ${positionStyle};${customStyle}`\"\n  >\n    <wd-popup\n      v-model=\"showPop\"\n      :z-index=\"zIndex\"\n      :duration=\"duration\"\n      :position=\"position\"\n      :custom-style=\"`position: absolute; pointer-events: auto; max-height: 80%;${customPopupStyle}`\"\n      :custom-class=\"customPopupClass\"\n      :modal=\"false\"\n      :close-on-click-modal=\"false\"\n      @before-enter=\"beforeEnter\"\n      @after-enter=\"afterEnter\"\n      @before-leave=\"beforeLeave\"\n      @after-leave=\"afterLeave\"\n    >\n      <view v-if=\"options.length\">\n        <view\n          v-for=\"(item, index) in options\"\n          :key=\"index\"\n          @click=\"choose(index)\"\n          :class=\"`wd-drop-item__option ${(item[valueKey] !== '' ? item[valueKey] : item) === modelValue ? 'is-active' : ''}`\"\n        >\n          <view :class=\"`wd-drop-item__title ${customTitle}`\">\n            <text>{{ item[labelKey] ? item[labelKey] : item }}</text>\n            <text v-if=\"item[tipKey]\" class=\"wd-drop-item__tip\">{{ item[tipKey] }}</text>\n          </view>\n          <wd-icon\n            v-if=\"(item[valueKey] !== '' ? item[valueKey] : item) === modelValue\"\n            :name=\"iconName\"\n            size=\"20px\"\n            :class=\"`wd-drop-item__icon ${customIcon}`\"\n          />\n        </view>\n      </view>\n      <slot v-else />\n    </wd-popup>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-drop-menu-item',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdPopup from '../wd-popup/wd-popup.vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { computed, getCurrentInstance, inject, onBeforeMount, onBeforeUnmount, ref, watch } from 'vue'\nimport { pushToQueue, removeFromQueue } from '../common/clickoutside'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport type { PopupType } from '../wd-popup/types'\nimport { useParent } from '../composables/useParent'\nimport { DROP_MENU_KEY } from '../wd-drop-menu/types'\nimport { isDef, isFunction } from '../common/util'\nimport { dorpMenuItemProps, type DropMenuItemExpose } from './types'\n\nconst props = defineProps(dorpMenuItemProps)\nconst emit = defineEmits(['change', 'update:modelValue', 'open', 'opened', 'closed', 'close'])\n\nconst queue = inject<Queue | null>(queueKey, null)\nconst showWrapper = ref<boolean>(false)\nconst showPop = ref<boolean>(false)\nconst position = ref<PopupType>()\nconst zIndex = ref<number>(12)\nconst modal = ref<boolean>(true)\nconst duration = ref<number>(0)\n\nconst { parent: dropMenu } = useParent(DROP_MENU_KEY)\n\nconst { proxy } = getCurrentInstance() as any\n\nconst positionStyle = computed(() => {\n  let style: string = ''\n  if (showWrapper.value && dropMenu) {\n    style =\n      dropMenu.props.direction === 'down'\n        ? `top: calc(var(--window-top) + ${dropMenu.offset.value}px); bottom: 0;`\n        : `top: 0; bottom: calc(var(--window-bottom) + ${dropMenu.offset.value}px)`\n  } else {\n    style = ''\n  }\n  return style\n})\n\nwatch(\n  () => props.modelValue,\n  (newValue) => {\n    if (isDef(newValue) && typeof newValue !== 'number' && typeof newValue !== 'string') {\n      uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue:99','[wot-design] warning(wd-drop-menu-item): the type of value should be a number or a string.')\n    }\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\nonBeforeMount(() => {\n  if (queue && queue.pushToQueue) {\n    queue.pushToQueue(proxy)\n  } else {\n    pushToQueue(proxy)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (queue && queue.removeFromQueue) {\n    queue.removeFromQueue(proxy)\n  } else {\n    removeFromQueue(proxy)\n  }\n})\n\nfunction getShowPop() {\n  return showPop.value\n}\n// 模拟单选操作 默认根据 value 选中操作\nfunction choose(index: number) {\n  if (props.disabled) return\n  const { valueKey } = props\n  const item = props.options[index]\n  const newValue = item[valueKey] !== undefined ? item[valueKey] : item\n  emit('update:modelValue', newValue)\n  emit('change', {\n    value: newValue,\n    selectedItem: item\n  })\n  close()\n}\n// 外部关闭弹出框\nfunction close() {\n  if (!showPop.value) {\n    return\n  }\n  if (isFunction(props.beforeToggle)) {\n    props.beforeToggle({\n      status: false,\n      resolve: (isPass: boolean) => {\n        isPass && handleClose()\n      }\n    })\n  } else {\n    handleClose()\n  }\n}\n\nfunction handleClose() {\n  if (showPop.value) {\n    showPop.value = false\n  }\n}\n\nfunction open() {\n  if (showPop.value) {\n    return\n  }\n  if (isFunction(props.beforeToggle)) {\n    props.beforeToggle({\n      status: true,\n      resolve: (isPass) => {\n        isPass && handleOpen()\n      }\n    })\n  } else {\n    handleOpen()\n  }\n}\n\nfunction handleOpen() {\n  showWrapper.value = true\n  showPop.value = true\n  if (dropMenu) {\n    modal.value = Boolean(dropMenu.props.modal)\n    duration.value = Number(dropMenu.props.duration)\n    position.value = dropMenu.props.direction === 'down' ? 'top' : 'bottom'\n  }\n}\n\nfunction toggle() {\n  if (showPop.value) {\n    close()\n  } else {\n    open()\n  }\n}\n\nfunction afterLeave() {\n  showWrapper.value = false\n  emit('closed')\n}\nfunction beforeEnter() {\n  emit('open')\n}\nfunction afterEnter() {\n  emit('opened')\n}\nfunction beforeLeave() {\n  emit('close')\n}\n\ndefineExpose<DropMenuItemExpose>({ getShowPop, open, close, toggle })\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue'\nwx.createComponent(Component)"],"names":["inject","queueKey","ref","useParent","DROP_MENU_KEY","getCurrentInstance","computed","watch","isDef","uni","onBeforeMount","pushToQueue","onBeforeUnmount","removeFromQueue","isFunction"],"mappings":"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"}