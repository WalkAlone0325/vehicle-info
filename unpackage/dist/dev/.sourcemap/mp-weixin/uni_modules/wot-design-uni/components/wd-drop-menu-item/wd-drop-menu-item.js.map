{"version":3,"file":"wd-drop-menu-item.js","sources":["uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue?type=component"],"sourcesContent":["<template>\n  <view\n    v-if=\"showWrapper\"\n    :class=\"`wd-drop-item  ${customClass}`\"\n    :style=\"`pointer-events: none; z-index: ${zIndex}; ${positionStyle};${customStyle}`\"\n  >\n    <wd-popup\n      v-model=\"showPop\"\n      :z-index=\"zIndex\"\n      :duration=\"duration\"\n      :position=\"position\"\n      :custom-style=\"`position: absolute; pointer-events: auto; max-height: 80%;${customPopupStyle}`\"\n      :custom-class=\"customPopupClass\"\n      :modal=\"false\"\n      :close-on-click-modal=\"false\"\n      @before-enter=\"beforeEnter\"\n      @after-enter=\"afterEnter\"\n      @before-leave=\"beforeLeave\"\n      @after-leave=\"afterLeave\"\n    >\n      <view v-if=\"options.length\">\n        <view\n          v-for=\"(item, index) in options\"\n          :key=\"index\"\n          @click=\"choose(index)\"\n          :class=\"`wd-drop-item__option ${(item[valueKey] !== '' ? item[valueKey] : item) === modelValue ? 'is-active' : ''}`\"\n        >\n          <view :class=\"`wd-drop-item__title ${customTitle}`\">\n            <text>{{ item[labelKey] ? item[labelKey] : item }}</text>\n            <text v-if=\"item[tipKey]\" class=\"wd-drop-item__tip\">{{ item[tipKey] }}</text>\n          </view>\n          <wd-icon\n            v-if=\"(item[valueKey] !== '' ? item[valueKey] : item) === modelValue\"\n            :name=\"iconName\"\n            size=\"20px\"\n            :class=\"`wd-drop-item__icon ${customIcon}`\"\n          />\n        </view>\n      </view>\n      <slot v-else />\n    </wd-popup>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-drop-menu-item',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdPopup from '../wd-popup/wd-popup.vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { computed, getCurrentInstance, inject, onBeforeMount, onBeforeUnmount, ref, watch } from 'vue'\nimport { pushToQueue, removeFromQueue } from '../common/clickoutside'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport type { PopupType } from '../wd-popup/types'\nimport { useParent } from '../composables/useParent'\nimport { DROP_MENU_KEY } from '../wd-drop-menu/types'\nimport { isDef, isFunction } from '../common/util'\nimport { dorpMenuItemProps, type DropMenuItemExpose } from './types'\n\nconst props = defineProps(dorpMenuItemProps)\nconst emit = defineEmits(['change', 'update:modelValue', 'open', 'opened', 'closed', 'close'])\n\nconst queue = inject<Queue | null>(queueKey, null)\nconst showWrapper = ref<boolean>(false)\nconst showPop = ref<boolean>(false)\nconst position = ref<PopupType>()\nconst zIndex = ref<number>(12)\nconst modal = ref<boolean>(true)\nconst duration = ref<number>(0)\n\nconst { parent: dropMenu } = useParent(DROP_MENU_KEY)\n\nconst { proxy } = getCurrentInstance() as any\n\nconst positionStyle = computed(() => {\n  let style: string = ''\n  if (showWrapper.value && dropMenu) {\n    style =\n      dropMenu.props.direction === 'down'\n        ? `top: calc(var(--window-top) + ${dropMenu.offset.value}px); bottom: 0;`\n        : `top: 0; bottom: calc(var(--window-bottom) + ${dropMenu.offset.value}px)`\n  } else {\n    style = ''\n  }\n  return style\n})\n\nwatch(\n  () => props.modelValue,\n  (newValue) => {\n    if (isDef(newValue) && typeof newValue !== 'number' && typeof newValue !== 'string') {\n      uni.__f__('error','at uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue:99','[wot-design] warning(wd-drop-menu-item): the type of value should be a number or a string.')\n    }\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\nonBeforeMount(() => {\n  if (queue && queue.pushToQueue) {\n    queue.pushToQueue(proxy)\n  } else {\n    pushToQueue(proxy)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (queue && queue.removeFromQueue) {\n    queue.removeFromQueue(proxy)\n  } else {\n    removeFromQueue(proxy)\n  }\n})\n\nfunction getShowPop() {\n  return showPop.value\n}\n// 模拟单选操作 默认根据 value 选中操作\nfunction choose(index: number) {\n  if (props.disabled) return\n  const { valueKey } = props\n  const item = props.options[index]\n  const newValue = item[valueKey] !== undefined ? item[valueKey] : item\n  emit('update:modelValue', newValue)\n  emit('change', {\n    value: newValue,\n    selectedItem: item\n  })\n  close()\n}\n// 外部关闭弹出框\nfunction close() {\n  if (!showPop.value) {\n    return\n  }\n  if (isFunction(props.beforeToggle)) {\n    props.beforeToggle({\n      status: false,\n      resolve: (isPass: boolean) => {\n        isPass && handleClose()\n      }\n    })\n  } else {\n    handleClose()\n  }\n}\n\nfunction handleClose() {\n  if (showPop.value) {\n    showPop.value = false\n  }\n}\n\nfunction open() {\n  if (showPop.value) {\n    return\n  }\n  if (isFunction(props.beforeToggle)) {\n    props.beforeToggle({\n      status: true,\n      resolve: (isPass) => {\n        isPass && handleOpen()\n      }\n    })\n  } else {\n    handleOpen()\n  }\n}\n\nfunction handleOpen() {\n  showWrapper.value = true\n  showPop.value = true\n  if (dropMenu) {\n    modal.value = Boolean(dropMenu.props.modal)\n    duration.value = Number(dropMenu.props.duration)\n    position.value = dropMenu.props.direction === 'down' ? 'top' : 'bottom'\n  }\n}\n\nfunction toggle() {\n  if (showPop.value) {\n    close()\n  } else {\n    open()\n  }\n}\n\nfunction afterLeave() {\n  showWrapper.value = false\n  emit('closed')\n}\nfunction beforeEnter() {\n  emit('open')\n}\nfunction afterEnter() {\n  emit('opened')\n}\nfunction beforeLeave() {\n  emit('close')\n}\n\ndefineExpose<DropMenuItemExpose>({ getShowPop, open, close, toggle })\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-drop-menu-item/wd-drop-menu-item.vue'\nwx.createComponent(Component)"],"names":["wdPopup","wdIcon","__default__","props","__props","emit","__emit","queue","inject","queueKey","showWrapper","ref","showPop","position","zIndex","modal","duration","dropMenu","useParent","DROP_MENU_KEY","proxy","getCurrentInstance","positionStyle","computed","style","watch","newValue","isDef","uni","onBeforeMount","pushToQueue","onBeforeUnmount","removeFromQueue","getShowPop","choose","index","valueKey","item","close","isFunction","isPass","handleClose","open","handleOpen","toggle","afterLeave","beforeEnter","afterEnter","beforeLeave","__expose","Component"],"mappings":"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"}