{"version":3,"file":"wd-search.js","sources":["uni_modules/wot-design-uni/components/wd-search/wd-search.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-search/wd-search.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"rootClass\" :style=\"customStyle\">\n    <view class=\"wd-search__block\">\n      <slot name=\"prefix\"></slot>\n      <view class=\"wd-search__field\">\n        <view v-if=\"!placeholderLeft\" :style=\"coverStyle\" class=\"wd-search__cover\" @click=\"closeCover\">\n          <wd-icon name=\"search\" custom-class=\"wd-search__search-icon\"></wd-icon>\n          <text :class=\"`wd-search__placeholder-txt ${placeholderClass}`\">{{ placeholder || translate('search') }}</text>\n        </view>\n        <wd-icon v-if=\"showInput || str || placeholderLeft\" name=\"search\" custom-class=\"wd-search__search-left-icon\"></wd-icon>\n        <input\n          v-if=\"showInput || str || placeholderLeft\"\n          :placeholder=\"placeholder || translate('search')\"\n          :placeholder-class=\"`wd-search__placeholder-txt ${placeholderClass}`\"\n          :placeholder-style=\"placeholderStyle\"\n          confirm-type=\"search\"\n          v-model=\"str\"\n          :class=\"['wd-search__input', customInputClass]\"\n          @focus=\"searchFocus\"\n          @input=\"inputValue\"\n          @blur=\"searchBlur\"\n          @confirm=\"search\"\n          :disabled=\"disabled\"\n          :maxlength=\"maxlength\"\n          :focus=\"isFocused\"\n        />\n        <wd-icon v-if=\"str\" custom-class=\"wd-search__clear wd-search__clear-icon\" name=\"error-fill\" @click=\"clearSearch\" />\n      </view>\n    </view>\n\n    <slot v-if=\"!hideCancel\" name=\"suffix\">\n      <view class=\"wd-search__cancel\" @click=\"handleCancel\">\n        {{ cancelTxt || translate('cancel') }}\n      </view>\n    </slot>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-search',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { type CSSProperties, computed, onMounted, ref, watch } from 'vue'\nimport { objToStyle, pause } from '../common/util'\nimport { useTranslate } from '../composables/useTranslate'\nimport { searchProps } from './types'\n\nconst props = defineProps(searchProps)\nconst emit = defineEmits(['update:modelValue', 'change', 'clear', 'search', 'focus', 'blur', 'cancel'])\n\nconst { translate } = useTranslate('search')\n\nconst isFocused = ref<boolean>(false) // 是否聚焦中\nconst showInput = ref<boolean>(false) // 是否显示输入框 用于实现聚焦的hack\nconst str = ref('')\nconst showPlaceHolder = ref<boolean>(true)\nconst clearing = ref<boolean>(false)\n\nwatch(\n  () => props.modelValue,\n  (newValue) => {\n    str.value = newValue\n    if (newValue) {\n      showInput.value = true\n    }\n  },\n  { immediate: true }\n)\n\nwatch(\n  () => props.focus,\n  (newValue) => {\n    if (newValue) {\n      if (props.disabled) return\n      closeCover()\n    }\n  }\n)\n\nonMounted(() => {\n  if (props.focus) {\n    closeCover()\n  }\n})\n\nconst rootClass = computed(() => {\n  return `wd-search  ${props.light ? 'is-light' : ''}  ${props.hideCancel ? 'is-without-cancel' : ''} ${props.customClass}`\n})\n\nconst coverStyle = computed(() => {\n  const coverStyle: CSSProperties = {\n    display: str.value === '' && showPlaceHolder.value ? 'flex' : 'none'\n  }\n\n  return objToStyle(coverStyle)\n})\n\nasync function hackFocus(focus: boolean) {\n  showInput.value = focus\n  await pause()\n  isFocused.value = focus\n}\n\nasync function closeCover() {\n  if (props.disabled) return\n  await pause(100)\n  showPlaceHolder.value = false\n  hackFocus(true)\n}\n/**\n * @description input的input事件handle\n * @param value\n */\nfunction inputValue(event: any) {\n  str.value = event.detail.value\n  emit('update:modelValue', event.detail.value)\n  emit('change', {\n    value: event.detail.value\n  })\n}\n/**\n * @description 点击清空icon的handle\n */\nasync function clearSearch() {\n  str.value = ''\n  clearing.value = true\n  if (props.focusWhenClear) {\n    isFocused.value = false\n  }\n  await pause(100)\n  if (props.focusWhenClear) {\n    showPlaceHolder.value = false\n    hackFocus(true)\n  } else {\n    showPlaceHolder.value = true\n    hackFocus(false)\n  }\n  emit('change', {\n    value: ''\n  })\n  emit('update:modelValue', '')\n  emit('clear')\n}\n/**\n * @description 点击搜索按钮时的handle\n * @param value\n */\nfunction search({ detail: { value } }: any) {\n  // 组件触发search事件\n  emit('search', {\n    value\n  })\n}\n/**\n * @description 输入框聚焦时的handle\n */\nfunction searchFocus() {\n  if (clearing.value) {\n    clearing.value = false\n    return\n  }\n  showPlaceHolder.value = false\n  emit('focus', {\n    value: str.value\n  })\n}\n/**\n * @description 输入框失焦的handle\n */\nfunction searchBlur() {\n  if (clearing.value) return\n  // 组件触发blur事件\n  showPlaceHolder.value = !str.value\n  showInput.value = !showPlaceHolder.value\n  isFocused.value = false\n  emit('blur', {\n    value: str.value\n  })\n}\n/**\n * @description 点击取消搜索按钮的handle\n */\nfunction handleCancel() {\n  // 组件触发cancel事件\n  emit('cancel', {\n    value: str.value\n  })\n}\n</script>\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-search/wd-search.vue'\nwx.createComponent(Component)"],"names":["wdIcon","__default__","props","__props","emit","__emit","translate","useTranslate","isFocused","ref","showInput","str","showPlaceHolder","clearing","watch","newValue","closeCover","onMounted","rootClass","computed","coverStyle","objToStyle","hackFocus","focus","pause","inputValue","event","clearSearch","search","value","searchFocus","searchBlur","handleCancel","Component"],"mappings":"0KAkDA,MAAAA,EAAmB,IAAA,wBAXnBC,EAAe,CACb,KAAM,YACN,QAAS,CACP,YAAa,GACb,eAAgB,GAChB,eAAgB,QAClB,CACF,gJAUA,MAAMC,EAAQC,EACRC,EAAOC,EAEP,CAAE,UAAAC,CAAA,EAAcC,EAAA,aAAa,QAAQ,EAErCC,EAAYC,MAAa,EAAK,EAC9BC,EAAYD,MAAa,EAAK,EAC9BE,EAAMF,MAAI,EAAE,EACZG,EAAkBH,MAAa,EAAI,EACnCI,EAAWJ,MAAa,EAAK,EAEnCK,EAAA,MACE,IAAMZ,EAAM,WACXa,GAAa,CACZJ,EAAI,MAAQI,EACRA,IACFL,EAAU,MAAQ,GAEtB,EACA,CAAE,UAAW,EAAK,CAAA,EAGpBI,EAAA,MACE,IAAMZ,EAAM,MACXa,GAAa,CACZ,GAAIA,EAAU,CACZ,GAAIb,EAAM,SAAU,OACTc,GACb,CACF,CAAA,EAGFC,EAAAA,UAAU,IAAM,CACVf,EAAM,OACGc,GACb,CACD,EAEK,MAAAE,EAAYC,EAAAA,SAAS,IAClB,cAAcjB,EAAM,MAAQ,WAAa,EAAE,KAAKA,EAAM,WAAa,oBAAsB,EAAE,IAAIA,EAAM,WAAW,EACxH,EAEKkB,EAAaD,EAAAA,SAAS,IAAM,CAChC,MAAMC,EAA4B,CAChC,QAAST,EAAI,QAAU,IAAMC,EAAgB,MAAQ,OAAS,MAAA,EAGhE,OAAOS,EAAAA,WAAWD,CAAU,CAAA,CAC7B,EAED,eAAeE,EAAUC,EAAgB,CACvCb,EAAU,MAAQa,EAClB,MAAMC,EAAM,MAAA,EACZhB,EAAU,MAAQe,CACpB,CAEA,eAAeP,GAAa,CACtBd,EAAM,WACV,MAAMsB,EAAAA,MAAM,GAAG,EACfZ,EAAgB,MAAQ,GACxBU,EAAU,EAAI,EAChB,CAKA,SAASG,EAAWC,EAAY,CAC1Bf,EAAA,MAAQe,EAAM,OAAO,MACpBtB,EAAA,oBAAqBsB,EAAM,OAAO,KAAK,EAC5CtB,EAAK,SAAU,CACb,MAAOsB,EAAM,OAAO,KAAA,CACrB,CACH,CAIA,eAAeC,GAAc,CAC3BhB,EAAI,MAAQ,GACZE,EAAS,MAAQ,GACbX,EAAM,iBACRM,EAAU,MAAQ,IAEpB,MAAMgB,EAAAA,MAAM,GAAG,EACXtB,EAAM,gBACRU,EAAgB,MAAQ,GACxBU,EAAU,EAAI,IAEdV,EAAgB,MAAQ,GACxBU,EAAU,EAAK,GAEjBlB,EAAK,SAAU,CACb,MAAO,EAAA,CACR,EACDA,EAAK,oBAAqB,EAAE,EAC5BA,EAAK,OAAO,CACd,CAKA,SAASwB,EAAO,CAAE,OAAQ,CAAE,MAAAC,IAAgB,CAE1CzB,EAAK,SAAU,CACb,MAAAyB,CAAA,CACD,CACH,CAIA,SAASC,GAAc,CACrB,GAAIjB,EAAS,MAAO,CAClBA,EAAS,MAAQ,GACjB,MACF,CACAD,EAAgB,MAAQ,GACxBR,EAAK,QAAS,CACZ,MAAOO,EAAI,KAAA,CACZ,CACH,CAIA,SAASoB,GAAa,CAChBlB,EAAS,QAEGD,EAAA,MAAQ,CAACD,EAAI,MACnBD,EAAA,MAAQ,CAACE,EAAgB,MACnCJ,EAAU,MAAQ,GAClBJ,EAAK,OAAQ,CACX,MAAOO,EAAI,KAAA,CACZ,EACH,CAIA,SAASqB,GAAe,CAEtB5B,EAAK,SAAU,CACb,MAAOO,EAAI,KAAA,CACZ,CACH,qgCCnMA,GAAG,gBAAgBsB,CAAS"}