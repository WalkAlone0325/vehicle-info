{"version":3,"file":"wd-message-box.js","sources":["uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.vue?type=component"],"sourcesContent":["<template>\n  <view>\n    <wd-popup\n      transition=\"zoom-in\"\n      v-model=\"messageState.show\"\n      :close-on-click-modal=\"messageState.closeOnClickModal\"\n      :lazy-render=\"messageState.lazyRender\"\n      custom-class=\"wd-message-box\"\n      @click-modal=\"toggleModal('modal')\"\n      :z-index=\"messageState.zIndex\"\n      :duration=\"200\"\n    >\n      <view :class=\"rootClass\">\n        <view :class=\"bodyClass\">\n          <view v-if=\"messageState.title\" class=\"wd-message-box__title\">\n            {{ messageState.title }}\n          </view>\n          <view class=\"wd-message-box__content\">\n            <template v-if=\"messageState.type === 'prompt'\">\n              <wd-input\n                v-model=\"messageState.inputValue\"\n                :type=\"messageState.inputType\"\n                :size=\"messageState.inputSize\"\n                :placeholder=\"messageState.inputPlaceholder\"\n                @input=\"inputValChange\"\n              />\n              <view v-if=\"messageState.showErr\" class=\"wd-message-box__input-error\">\n                {{ messageState.inputError || translate('inputNoValidate') }}\n              </view>\n            </template>\n            <slot>{{ messageState.msg }}</slot>\n          </view>\n        </view>\n        <view :class=\"`wd-message-box__actions ${messageState.showCancelButton ? 'wd-message-box__flex' : 'wd-message-box__block'}`\">\n          <wd-button v-bind=\"customCancelProps\" v-if=\"messageState.showCancelButton\" @click=\"toggleModal('cancel')\">\n            {{ messageState.cancelButtonText || translate('cancel') }}\n          </wd-button>\n          <wd-button v-bind=\"customConfirmProps\" @click=\"toggleModal('confirm')\">\n            {{ messageState.confirmButtonText || translate('confirm') }}\n          </wd-button>\n        </view>\n      </view>\n    </wd-popup>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-message-box',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdPopup from '../wd-popup/wd-popup.vue'\nimport wdButton from '../wd-button/wd-button.vue'\nimport wdInput from '../wd-input/wd-input.vue'\nimport { computed, inject, reactive, ref, watch } from 'vue'\nimport { messageBoxProps, type MessageOptionsWithCallBack, type MessageResult } from './types'\nimport { defaultOptions, getMessageDefaultOptionKey } from '.'\nimport { deepAssign, isDef, isFunction, isUndefined, omitBy } from '../common/util'\nimport { useTranslate } from '../composables/useTranslate'\nimport type { ButtonProps } from '../wd-button/types'\n\nconst props = defineProps(messageBoxProps)\n\nconst { translate } = useTranslate('message-box')\n\nconst rootClass = computed(() => {\n  return `wd-message-box__container ${props.customClass}`\n})\n\nconst bodyClass = computed(() => {\n  return `wd-message-box__body ${!messageState.title ? 'is-no-title' : ''} ${messageState.type === 'prompt' ? 'is-prompt' : ''}`\n})\n\nconst messageOptionKey = getMessageDefaultOptionKey(props.selector)\nconst messageOption = inject(messageOptionKey, ref<MessageOptionsWithCallBack>(defaultOptions)) // message选项\n\nconst messageState = reactive<MessageOptionsWithCallBack>({\n  msg: '', // 消息内容\n  show: false, // 是否显示弹框\n  title: '', // 标题\n  showCancelButton: false, // 是否展示取消按钮\n  closeOnClickModal: true, // 是否支持点击蒙层关闭\n  confirmButtonText: '', // 确定按钮文案\n  cancelButtonText: '', // 取消按钮文案\n  type: 'alert', // 弹框类型\n  inputType: 'text', // 输入框类型\n  inputValue: '', // 输入框初始值\n  inputPlaceholder: '', // 输入框placeholder\n  inputError: '', // 输入框错误提示文案\n  showErr: false, // 是否显示错误提示\n  zIndex: 99, // 弹窗层级\n  lazyRender: true // 弹层内容懒渲染\n})\n\n/**\n * 确认按钮属性\n */\nconst customConfirmProps = computed(() => {\n  const buttonProps: Partial<ButtonProps> = deepAssign(\n    {\n      block: true\n    },\n    isDef(messageState.confirmButtonProps) ? omitBy(messageState.confirmButtonProps, isUndefined) : {}\n  )\n  buttonProps.customClass = `${buttonProps.customClass || ''} wd-message-box__actions-btn`\n  return buttonProps\n})\n\n/**\n * 取消按钮属性\n */\nconst customCancelProps = computed(() => {\n  const buttonProps: Partial<ButtonProps> = deepAssign(\n    {\n      block: true,\n      type: 'info'\n    },\n    isDef(messageState.cancelButtonProps) ? omitBy(messageState.cancelButtonProps, isUndefined) : {}\n  )\n  buttonProps.customClass = `${buttonProps.customClass || ''} wd-message-box__actions-btn`\n  return buttonProps\n})\n\n// 监听options变化展示\nwatch(\n  () => messageOption.value,\n  (newVal: MessageOptionsWithCallBack) => {\n    reset(newVal)\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\nwatch(\n  () => messageState.show,\n  (newValue) => {\n    resetErr(!!newValue)\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\n/**\n * 点击操作\n * @param action\n */\nfunction toggleModal(action: 'confirm' | 'cancel' | 'modal') {\n  if (action === 'modal' && !messageState.closeOnClickModal) {\n    return\n  }\n  if (messageState.type === 'prompt' && action === 'confirm' && !validate()) {\n    return\n  }\n  switch (action) {\n    case 'confirm':\n      if (messageState.beforeConfirm) {\n        messageState.beforeConfirm({\n          resolve: (isPass) => {\n            if (isPass) {\n              handleConfirm({\n                action: action,\n                value: messageState.inputValue\n              })\n            }\n          }\n        })\n      } else {\n        handleConfirm({\n          action: action,\n          value: messageState.inputValue\n        })\n      }\n      break\n    case 'cancel':\n      handleCancel({\n        action: action\n      })\n      break\n    default:\n      handleCancel({\n        action: 'modal'\n      })\n      break\n  }\n}\n\n/**\n * 确认回调\n * @param result\n */\nfunction handleConfirm(result: MessageResult) {\n  messageState.show = false\n  if (isFunction(messageState.success)) {\n    messageState.success(result)\n  }\n}\n\n/**\n * 取消回调\n * @param result\n */\nfunction handleCancel(result: MessageResult) {\n  messageState.show = false\n  if (isFunction(messageState.fail)) {\n    messageState.fail(result)\n  }\n}\n\n/**\n * 如果存在校验规则行为，则进行判断校验是否通过规则。默认不存在校验直接铜鼓。\n */\nfunction validate() {\n  if (messageState.inputPattern && !messageState.inputPattern.test(String(messageState.inputValue))) {\n    messageState.showErr = true\n    return false\n  }\n  if (typeof messageState.inputValidate === 'function') {\n    const validateResult = messageState.inputValidate(messageState.inputValue!)\n    if (!validateResult) {\n      messageState.showErr = true\n      return false\n    }\n  }\n  messageState.showErr = false\n  return true\n}\n\n/**\n * @description show关闭时，销毁错误提示\n * @param val\n */\nfunction resetErr(val: boolean) {\n  if (val === false) {\n    messageState.showErr = false\n  }\n}\nfunction inputValChange({ value }: { value: string | number }) {\n  if (value === '') {\n    messageState.showErr = false\n    return\n  }\n  messageState.inputValue = value\n}\n\n/**\n * 重置message选项值\n * @param option message选项值\n */\nfunction reset(option: MessageOptionsWithCallBack) {\n  if (option) {\n    messageState.title = isDef(option.title) ? option.title : ''\n    messageState.showCancelButton = isDef(option.showCancelButton) ? option.showCancelButton : false\n    messageState.show = option.show\n    messageState.closeOnClickModal = option.closeOnClickModal\n    messageState.confirmButtonText = option.confirmButtonText\n    messageState.cancelButtonText = option.cancelButtonText\n    messageState.msg = option.msg\n    messageState.type = option.type\n    messageState.inputType = option.inputType\n    messageState.inputSize = option.inputSize\n    messageState.inputValue = option.inputValue\n    messageState.inputPlaceholder = option.inputPlaceholder\n    messageState.inputPattern = option.inputPattern!\n    messageState.inputValidate = option.inputValidate\n    messageState.success = option.success\n    messageState.fail = option.fail\n    messageState.beforeConfirm = option.beforeConfirm\n    messageState.inputError = option.inputError\n    messageState.showErr = option.showErr\n    messageState.zIndex = option.zIndex\n    messageState.lazyRender = option.lazyRender\n    messageState.confirmButtonProps = option.confirmButtonProps\n    messageState.cancelButtonProps = option.cancelButtonProps\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.vue'\nwx.createComponent(Component)"],"names":["wdPopup","wdButton","wdInput","__default__","props","__props","translate","useTranslate","rootClass","computed","bodyClass","messageState","messageOptionKey","getMessageDefaultOptionKey","messageOption","inject","ref","defaultOptions","reactive","customConfirmProps","buttonProps","deepAssign","isDef","omitBy","isUndefined","customCancelProps","watch","newVal","reset","newValue","resetErr","toggleModal","action","validate","isPass","handleConfirm","handleCancel","result","isFunction","val","inputValChange","value","option","Component"],"mappings":"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"}