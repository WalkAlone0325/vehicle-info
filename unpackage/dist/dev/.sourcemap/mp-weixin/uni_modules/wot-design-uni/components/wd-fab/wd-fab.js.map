{"version":3,"file":"wd-fab.js","sources":["uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue?type=component"],"sourcesContent":["<template>\n  <view\n    @touchmove.stop.prevent=\"handleTouchMove\"\n    @touchstart=\"handleTouchStart\"\n    @touchend=\"handleTouchEnd\"\n    :class=\"`wd-fab ${customClass}`\"\n    :style=\"rootStyle\"\n    @click.stop=\"\"\n  >\n    <view @click.stop=\"\" :style=\"{ visibility: inited ? 'visible' : 'hidden' }\" id=\"trigger\">\n      <slot name=\"trigger\" v-if=\"$slots.trigger\"></slot>\n      <wd-button v-else @click=\"handleClick\" custom-class=\"wd-fab__trigger\" round :type=\"type\" :disabled=\"disabled\">\n        <wd-icon custom-class=\"wd-fab__icon\" :name=\"isActive ? activeIcon : inactiveIcon\"></wd-icon>\n      </wd-button>\n    </view>\n    <wd-transition\n      v-if=\"expandable\"\n      :enter-class=\"`wd-fab__transition-enter--${fabDirection}`\"\n      enter-active-class=\"wd-fab__transition-enter-active\"\n      :leave-to-class=\"`wd-fab__transition-leave-to--${fabDirection}`\"\n      leave-active-class=\"wd-fab__transition-leave-active\"\n      :custom-class=\"`wd-fab__actions wd-fab__actions--${fabDirection}`\"\n      :show=\"isActive\"\n      :duration=\"300\"\n    >\n      <slot></slot>\n    </wd-transition>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-fab',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdButton from '../wd-button/wd-button.vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport wdTransition from '../wd-transition/wd-transition.vue'\nimport { type CSSProperties, computed, ref, watch, inject, getCurrentInstance, onBeforeUnmount, onMounted, nextTick } from 'vue'\nimport { getRect, isDef, isH5, objToStyle } from '../common/util'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport { closeOther, pushToQueue, removeFromQueue } from '../common/clickoutside'\nimport { fabProps, type FabExpose } from './types'\nimport { reactive } from 'vue'\nimport { useRaf } from '../composables/useRaf'\n\nconst props = defineProps(fabProps)\nconst emit = defineEmits(['update:active', 'click'])\nconst inited = ref<boolean>(false) // 是否初始化完成\nconst isActive = ref<boolean>(false) // 是否激活状态\nconst queue = inject<Queue | null>(queueKey, null)\nconst { proxy } = getCurrentInstance() as any\n\nwatch(\n  () => props.active,\n  (newValue) => {\n    isActive.value = newValue\n  },\n  { immediate: true, deep: true }\n)\n\nwatch(\n  () => isActive.value,\n  (newValue) => {\n    if (newValue) {\n      if (queue && queue.closeOther) {\n        queue.closeOther(proxy)\n      } else {\n        closeOther(proxy)\n      }\n    }\n  }\n)\n\nconst fabDirection = ref(props.direction)\n\nwatch(\n  () => props.direction,\n  (direction) => (fabDirection.value = direction)\n)\n\nwatch(\n  () => props.position,\n  () => initPosition()\n)\n\nconst top = ref<number>(0)\nconst left = ref<number>(0)\nconst screen = reactive({ width: 0, height: 0 })\nconst fabSize = reactive({ width: 56, height: 56 })\nconst bounding = reactive({\n  minTop: 0,\n  minLeft: 0,\n  maxTop: 0,\n  maxLeft: 0\n})\n\nasync function getBounding() {\n  const sysInfo = uni.getSystemInfoSync()\n  try {\n    const trigerInfo = await getRect('#trigger', false, proxy)\n    fabSize.width = trigerInfo.width || 56\n    fabSize.height = trigerInfo.height || 56\n  } catch (error) {\n    uni.__f__('log','at uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue:112',error)\n  }\n\n  const { top = 16, left = 16, right = 16, bottom = 16 } = props.gap\n  screen.width = sysInfo.windowWidth\n  screen.height = isH5 ? sysInfo.windowTop + sysInfo.windowHeight : sysInfo.windowHeight\n  bounding.minTop = isH5 ? sysInfo.windowTop + top : top\n  bounding.minLeft = left\n  bounding.maxLeft = screen.width - fabSize.width - right\n  bounding.maxTop = screen.height - fabSize.height - bottom\n}\n\nfunction initPosition() {\n  const pos = props.position\n  const { minLeft, minTop, maxLeft, maxTop } = bounding\n  const centerY = (maxTop + minTop) / 2\n  const centerX = (maxLeft + minLeft) / 2\n\n  switch (pos) {\n    case 'left-top':\n      top.value = minTop\n      left.value = minLeft\n      break\n    case 'right-top':\n      top.value = minTop\n      left.value = maxLeft\n      break\n    case 'left-bottom':\n      top.value = maxTop\n      left.value = minLeft\n      break\n    case 'right-bottom':\n      top.value = maxTop\n      left.value = maxLeft\n      break\n    case 'left-center':\n      top.value = centerY\n      left.value = minLeft\n      break\n    case 'right-center':\n      top.value = centerY\n      left.value = maxLeft\n      break\n    case 'top-center':\n      top.value = minTop\n      left.value = centerX\n      break\n    case 'bottom-center':\n      top.value = maxTop\n      left.value = centerX\n      break\n  }\n}\n\n// 按下时坐标相对于元素的偏移量\nconst touchOffset = reactive({ x: 0, y: 0 })\nconst attractTransition = ref<boolean>(false)\nfunction handleTouchStart(e: TouchEvent) {\n  if (props.draggable === false) return\n\n  const touch = e.touches[0]\n  touchOffset.x = touch.clientX - left.value\n  touchOffset.y = touch.clientY - top.value\n  attractTransition.value = false\n}\n\nfunction handleTouchMove(e: TouchEvent) {\n  if (props.draggable === false) return\n\n  const touch = e.touches[0]\n  const { minLeft, minTop, maxLeft, maxTop } = bounding\n  let x = touch.clientX - touchOffset.x\n  let y = touch.clientY - touchOffset.y\n\n  if (x < minLeft) x = minLeft\n  else if (x > maxLeft) x = maxLeft\n\n  if (y < minTop) y = minTop\n  else if (y > maxTop) y = maxTop\n\n  top.value = y\n  left.value = x\n}\n\nfunction handleTouchEnd() {\n  if (props.draggable === false) return\n\n  const screenCenterX = screen.width / 2\n  const fabCenterX = left.value + fabSize.width / 2\n  attractTransition.value = true\n  if (fabCenterX < screenCenterX) {\n    left.value = bounding.minLeft\n    fabDirection.value = 'right'\n  } else {\n    left.value = bounding.maxLeft\n    fabDirection.value = 'left'\n  }\n}\n\nconst rootStyle = computed(() => {\n  const style: CSSProperties = {\n    top: top.value + 'px',\n    left: left.value + 'px',\n    transition: attractTransition.value ? 'all ease 0.3s' : 'none'\n  }\n  if (isDef(props.zIndex)) {\n    style['z-index'] = props.zIndex\n  }\n  return `${objToStyle(style)}${props.customStyle}`\n})\n\nonMounted(() => {\n  if (queue && queue.pushToQueue) {\n    queue.pushToQueue(proxy)\n  } else {\n    pushToQueue(proxy)\n  }\n\n  const { start } = useRaf(async () => {\n    await getBounding()\n    initPosition()\n    inited.value = true\n  })\n  start()\n})\n\nonBeforeUnmount(() => {\n  if (queue && queue.removeFromQueue) {\n    queue.removeFromQueue(proxy)\n  } else {\n    removeFromQueue(proxy)\n  }\n})\n\nfunction handleClick() {\n  if (props.disabled) {\n    return\n  }\n  if (!props.expandable) {\n    emit('click')\n    return\n  }\n  isActive.value = !isActive.value\n  emit('update:active', isActive.value)\n}\n\nfunction open() {\n  isActive.value = true\n  emit('update:active', true)\n}\n\nfunction close() {\n  isActive.value = false\n  emit('update:active', false)\n}\n\ndefineExpose<FabExpose>({\n  open,\n  close\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue'\nwx.createComponent(Component)"],"names":["wdButton","wdIcon","wdTransition","__default__","props","__props","emit","__emit","inited","ref","isActive","queue","inject","queueKey","proxy","getCurrentInstance","watch","newValue","closeOther","fabDirection","direction","initPosition","top","left","screen","reactive","fabSize","bounding","getBounding","sysInfo","uni","trigerInfo","getRect","error","right","bottom","isH5","pos","minLeft","minTop","maxLeft","maxTop","centerY","centerX","touchOffset","attractTransition","handleTouchStart","e","touch","handleTouchMove","x","y","handleTouchEnd","screenCenterX","fabCenterX","rootStyle","computed","style","isDef","objToStyle","onMounted","pushToQueue","start","useRaf","onBeforeUnmount","removeFromQueue","handleClick","open","close","__expose","Component"],"mappings":"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"}