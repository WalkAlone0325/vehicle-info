{"version":3,"file":"wd-swiper.js","sources":["uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"`wd-swiper ${customClass}`\" :style=\"customStyle\">\n\n    <scroll-view scroll-x scroll-y style=\"width: 100%; height: 100%\">\n\n      <swiper\n        :adjust-height=\"adjustHeight\"\n        :adjust-vertical-height=\"adjustVerticalHeight\"\n        class=\"wd-swiper__track\"\n        :autoplay=\"autoplay && !videoPlaying\"\n        :current=\"navCurrent\"\n        :interval=\"interval\"\n        :duration=\"duration\"\n        :circular=\"loop\"\n        :vertical=\"direction == 'vertical'\"\n        :easing-function=\"easingFunction\"\n        :previous-margin=\"addUnit(previousMargin)\"\n        :next-margin=\"addUnit(nextMargin)\"\n        :snap-to-edge=\"snapToEdge\"\n        :display-multiple-items=\"displayMultipleItems\"\n        :style=\"{ height: addUnit(height) }\"\n        @change=\"handleChange\"\n        @animationfinish=\"handleAnimationfinish\"\n      >\n        <swiper-item v-for=\"(item, index) in list\" :key=\"index\" class=\"wd-swiper__item\">\n          <video\n            v-if=\"isVideo(item)\"\n            :id=\"`video-${index}-${uid}`\"\n            :style=\"{ height: addUnit(height) }\"\n            :src=\"isObj(item) ? item[valueKey] : item\"\n            :poster=\"isObj(item) ? item.poster : ''\"\n            :class=\"`wd-swiper__video ${customItemClass} ${getCustomItemClass(currentValue, index, list)}`\"\n            @play=\"handleVideoPaly\"\n            @pause=\"handleVideoPause\"\n            :enable-progress-gesture=\"false\"\n            :loop=\"videoLoop\"\n            :muted=\"muted\"\n            :autoplay=\"autoplayVideo\"\n            objectFit=\"cover\"\n            @click=\"handleClick(index, item)\"\n          />\n          <image\n            v-else\n            :src=\"isObj(item) ? item[valueKey] : item\"\n            :class=\"`wd-swiper__image ${customImageClass} ${customItemClass} ${getCustomItemClass(currentValue, index, list)}`\"\n            :style=\"{ height: addUnit(height) }\"\n            :mode=\"imageMode\"\n            @click=\"handleClick(index, item)\"\n          />\n\n          <text v-if=\"isObj(item) && item[textKey]\" :class=\"`wd-swiper__text ${customTextClass}`\" :style=\"customTextStyle\">{{ item[textKey] }}</text>\n        </swiper-item>\n      </swiper>\n\n    </scroll-view>\n\n\n    <template v-if=\"indicator\">\n      <slot name=\"indicator\" :current=\"currentValue\" :total=\"list.length\"></slot>\n      <wd-swiper-nav\n        v-if=\"!$slots.indicator\"\n        :custom-class=\"customIndicatorClass\"\n        :type=\"swiperIndicator.type\"\n        :current=\"swiperIndicator.current\"\n        :total=\"swiperIndicator.total\"\n        :direction=\"swiperIndicator.direction\"\n        :indicator-position=\"swiperIndicator.indicatorPosition\"\n        :min-show-num=\"swiperIndicator.minShowNum\"\n        :show-controls=\"swiperIndicator.showControls\"\n        @change=\"handleIndicatorChange\"\n      />\n    </template>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-swiper',\n  options: {\n    addGlobalClass: true,\n    virtualHost: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdSwiperNav from '../wd-swiper-nav/wd-swiper-nav.vue'\nimport { computed, watch, ref, getCurrentInstance } from 'vue'\nimport { addUnit, isObj, isImageUrl, isVideoUrl, uuid, isDef } from '../common/util'\nimport { swiperProps, type SwiperList } from './types'\nimport type { SwiperNavProps } from '../wd-swiper-nav/types'\n\nconst props = defineProps(swiperProps)\nconst emit = defineEmits(['click', 'change', 'animationfinish', 'update:current'])\nconst navCurrent = ref<number>(props.current) // 当前滑块 swiper使用\nconst currentValue = ref<number>(props.current) // 当前滑块\n\n/**\n * 更新当前滑块\n * @param current 当前滑块索引\n * @param force 是否强制更新swiper绑定的的current\n */\nconst updateCurrent = (current: number, force: boolean = false) => {\n  currentValue.value = current\n  if (force) {\n    navCurrent.value = current\n  }\n  emit('update:current', current)\n}\n\nconst videoPlaying = ref<boolean>(false) // 当前是否在播放视频\n\nconst { proxy } = getCurrentInstance() as any\n\nconst uid = ref<string>(uuid())\n\nwatch(\n  () => props.current,\n  (val) => {\n    if (val < 0) {\n      props.loop ? goToEnd() : goToStart()\n    } else if (val >= props.list.length) {\n      props.loop ? goToStart() : goToEnd()\n    } else {\n      navTo(val)\n    }\n  }\n)\n\nconst swiperIndicator = computed(() => {\n  const { list, direction, indicatorPosition, indicator } = props\n  const swiperIndicator: Partial<SwiperNavProps> = {\n    current: currentValue.value || 0,\n    total: list.length || 0,\n    direction: direction || 'horizontal',\n    indicatorPosition: indicatorPosition || 'bottom'\n  }\n  if (isObj(indicator)) {\n    swiperIndicator.type = indicator.type || 'dots'\n    swiperIndicator.minShowNum = indicator.minShowNum || 2\n    swiperIndicator.showControls = indicator.showControls || false\n  }\n  return swiperIndicator\n})\n\nconst getMediaType = (item: string | SwiperList, type: 'video' | 'image') => {\n  const checkType = (url: string) => (type === 'video' ? isVideoUrl(url) : isImageUrl(url))\n\n  if (isObj(item)) {\n    return item.type && ['video', 'image'].includes(item.type) ? item.type === type : checkType(item[props.valueKey])\n  } else {\n    return checkType(item)\n  }\n}\n\nconst isVideo = (item: string | SwiperList) => {\n  return getMediaType(item, 'video')\n}\n\nconst isImage = (item: string | SwiperList) => {\n  return getMediaType(item, 'image')\n}\n\nfunction navTo(index: number) {\n  if (index === currentValue.value) return\n  updateCurrent(index, true)\n}\n\nfunction goToStart() {\n  navTo(0)\n}\n\nfunction goToEnd() {\n  navTo(props.list.length - 1)\n}\n\n// 视频播放\nfunction handleVideoPaly() {\n  props.stopAutoplayWhenVideoPlay && (videoPlaying.value = true)\n}\n\n// 视频暂停\nfunction handleVideoPause() {\n  videoPlaying.value = false\n}\n\n/**\n * 是否为当前滑块的前一个滑块\n * @param current\n * @param index\n * @param list\n */\nfunction isPrev(current: number, index: number, list: string[] | SwiperList[]) {\n  return (current - 1 + list.length) % list.length === index\n}\n\n/**\n * 是否为当前滑块的后一个滑块\n * @param current\n * @param index\n * @param list\n */\nfunction isNext(current: number, index: number, list: string[] | SwiperList[]) {\n  return (current + 1 + list.length) % list.length === index\n}\n\nfunction getCustomItemClass(current: number, index: number, list: string[] | SwiperList[]) {\n  let customItemClass: string = ''\n  if (isPrev(current, index, list)) {\n    customItemClass = props.customPrevClass || props.customPrevImageClass\n  }\n  if (isNext(current, index, list)) {\n    customItemClass = props.customNextClass || props.customNextImageClass\n  }\n  return customItemClass\n}\n\n/**\n * 轮播滑块切换时触发\n */\nfunction handleChange(e: { detail: { current: number; source: string } }) {\n  const { current, source } = e.detail\n  const previous = currentValue.value\n  emit('change', { current, source })\n  if (current !== currentValue.value) {\n    const forceUpdate = source === 'autoplay' || source === 'touch'\n    updateCurrent(current, forceUpdate)\n  }\n  handleVideoChange(previous, current)\n}\n\n/**\n * 处理视频切换\n */\nfunction handleVideoChange(previous: number, current: number) {\n  handleStopVideoPaly(previous)\n  handleStartVideoPaly(current)\n}\n\n/**\n * 开始播放指定视频\n * @param index\n */\nfunction handleStartVideoPaly(index: number) {\n  if (props.autoplayVideo) {\n    const currentItem = props.list[index]\n    if (isDef(currentItem) && isVideo(currentItem)) {\n      const video = uni.createVideoContext(`video-${index}-${uid.value}`, proxy)\n      video.play()\n    }\n  }\n}\n\n/**\n * 停止播放指定视频\n * @param index\n */\nfunction handleStopVideoPaly(index: number) {\n  if (props.stopPreviousVideo) {\n    const previousItem = props.list[index]\n    if (isDef(previousItem) && isVideo(previousItem)) {\n      const video = uni.createVideoContext(`video-${index}-${uid.value}`, proxy)\n      video.pause()\n    }\n  } else if (props.stopAutoplayWhenVideoPlay) {\n    handleVideoPause()\n  }\n}\n\n/**\n * 滑块动画结束\n */\nfunction handleAnimationfinish(e: { detail: { current: any; source: string } }) {\n  const { current, source } = e.detail\n  if (current !== currentValue.value) {\n    const forceUpdate = source === 'autoplay' || source === 'touch'\n    updateCurrent(current, forceUpdate)\n  }\n  /**\n   * 滑块动画结束时触发\n   */\n  emit('animationfinish', { current, source })\n}\n\n/**\n * 点击滑块事件\n * @param index 点击的滑块下标\n * @param item 点击的滑块内容\n */\nfunction handleClick(index: number, item: string | SwiperList) {\n  emit('click', { index, item })\n}\n\nfunction handleIndicatorChange({ dir }: { dir: 'prev' | 'next' }) {\n  const { list, loop } = props\n  const total = list.length\n  let nextPos = dir === 'next' ? currentValue.value + 1 : currentValue.value - 1\n  if (loop) {\n    nextPos = dir === 'next' ? (currentValue.value + 1) % total : (currentValue.value - 1 + total) % total\n  } else {\n    nextPos = nextPos < 0 || nextPos >= total ? currentValue.value : nextPos\n  }\n  if (nextPos === currentValue.value) return\n  navTo(nextPos)\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue'\nwx.createComponent(Component)"],"names":["ref","getCurrentInstance","uuid","watch","computed","swiperIndicator","isObj","isVideoUrl","isImageUrl","isDef","uni"],"mappings":"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"}