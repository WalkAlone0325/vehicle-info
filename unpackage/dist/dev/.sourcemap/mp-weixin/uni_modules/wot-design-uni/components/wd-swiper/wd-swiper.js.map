{"version":3,"file":"wd-swiper.js","sources":["uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"`wd-swiper ${customClass}`\" :style=\"customStyle\">\n\n    <scroll-view scroll-x scroll-y style=\"width: 100%; height: 100%\">\n\n      <swiper\n        :adjust-height=\"adjustHeight\"\n        :adjust-vertical-height=\"adjustVerticalHeight\"\n        class=\"wd-swiper__track\"\n        :autoplay=\"autoplay && !videoPlaying\"\n        :current=\"navCurrent\"\n        :interval=\"interval\"\n        :duration=\"duration\"\n        :circular=\"loop\"\n        :vertical=\"direction == 'vertical'\"\n        :easing-function=\"easingFunction\"\n        :previous-margin=\"addUnit(previousMargin)\"\n        :next-margin=\"addUnit(nextMargin)\"\n        :snap-to-edge=\"snapToEdge\"\n        :display-multiple-items=\"displayMultipleItems\"\n        :style=\"{ height: addUnit(height) }\"\n        @change=\"handleChange\"\n        @animationfinish=\"handleAnimationfinish\"\n      >\n        <swiper-item v-for=\"(item, index) in list\" :key=\"index\" class=\"wd-swiper__item\">\n          <video\n            v-if=\"isVideo(item)\"\n            :id=\"`video-${index}-${uid}`\"\n            :style=\"{ height: addUnit(height) }\"\n            :src=\"isObj(item) ? item[valueKey] : item\"\n            :poster=\"isObj(item) ? item.poster : ''\"\n            :class=\"`wd-swiper__video ${customItemClass} ${getCustomItemClass(currentValue, index, list)}`\"\n            @play=\"handleVideoPaly\"\n            @pause=\"handleVideoPause\"\n            :enable-progress-gesture=\"false\"\n            :loop=\"videoLoop\"\n            :muted=\"muted\"\n            :autoplay=\"autoplayVideo\"\n            objectFit=\"cover\"\n            @click=\"handleClick(index, item)\"\n          />\n          <image\n            v-else\n            :src=\"isObj(item) ? item[valueKey] : item\"\n            :class=\"`wd-swiper__image ${customImageClass} ${customItemClass} ${getCustomItemClass(currentValue, index, list)}`\"\n            :style=\"{ height: addUnit(height) }\"\n            :mode=\"imageMode\"\n            @click=\"handleClick(index, item)\"\n          />\n\n          <text v-if=\"isObj(item) && item[textKey]\" :class=\"`wd-swiper__text ${customTextClass}`\" :style=\"customTextStyle\">{{ item[textKey] }}</text>\n        </swiper-item>\n      </swiper>\n\n    </scroll-view>\n\n\n    <template v-if=\"indicator\">\n      <slot name=\"indicator\" :current=\"currentValue\" :total=\"list.length\"></slot>\n      <wd-swiper-nav\n        v-if=\"!$slots.indicator\"\n        :custom-class=\"customIndicatorClass\"\n        :type=\"swiperIndicator.type\"\n        :current=\"swiperIndicator.current\"\n        :total=\"swiperIndicator.total\"\n        :direction=\"swiperIndicator.direction\"\n        :indicator-position=\"swiperIndicator.indicatorPosition\"\n        :min-show-num=\"swiperIndicator.minShowNum\"\n        :show-controls=\"swiperIndicator.showControls\"\n        @change=\"handleIndicatorChange\"\n      />\n    </template>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-swiper',\n  options: {\n    addGlobalClass: true,\n    virtualHost: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdSwiperNav from '../wd-swiper-nav/wd-swiper-nav.vue'\nimport { computed, watch, ref, getCurrentInstance } from 'vue'\nimport { addUnit, isObj, isImageUrl, isVideoUrl, uuid, isDef } from '../common/util'\nimport { swiperProps, type SwiperList } from './types'\nimport type { SwiperNavProps } from '../wd-swiper-nav/types'\n\nconst props = defineProps(swiperProps)\nconst emit = defineEmits(['click', 'change', 'animationfinish', 'update:current'])\nconst navCurrent = ref<number>(props.current) // 当前滑块 swiper使用\nconst currentValue = ref<number>(props.current) // 当前滑块\n\n/**\n * 更新当前滑块\n * @param current 当前滑块索引\n * @param force 是否强制更新swiper绑定的的current\n */\nconst updateCurrent = (current: number, force: boolean = false) => {\n  currentValue.value = current\n  if (force) {\n    navCurrent.value = current\n  }\n  emit('update:current', current)\n}\n\nconst videoPlaying = ref<boolean>(false) // 当前是否在播放视频\n\nconst { proxy } = getCurrentInstance() as any\n\nconst uid = ref<string>(uuid())\n\nwatch(\n  () => props.current,\n  (val) => {\n    if (val < 0) {\n      props.loop ? goToEnd() : goToStart()\n    } else if (val >= props.list.length) {\n      props.loop ? goToStart() : goToEnd()\n    } else {\n      navTo(val)\n    }\n  }\n)\n\nconst swiperIndicator = computed(() => {\n  const { list, direction, indicatorPosition, indicator } = props\n  const swiperIndicator: Partial<SwiperNavProps> = {\n    current: currentValue.value || 0,\n    total: list.length || 0,\n    direction: direction || 'horizontal',\n    indicatorPosition: indicatorPosition || 'bottom'\n  }\n  if (isObj(indicator)) {\n    swiperIndicator.type = indicator.type || 'dots'\n    swiperIndicator.minShowNum = indicator.minShowNum || 2\n    swiperIndicator.showControls = indicator.showControls || false\n  }\n  return swiperIndicator\n})\n\nconst getMediaType = (item: string | SwiperList, type: 'video' | 'image') => {\n  const checkType = (url: string) => (type === 'video' ? isVideoUrl(url) : isImageUrl(url))\n\n  if (isObj(item)) {\n    return item.type && ['video', 'image'].includes(item.type) ? item.type === type : checkType(item[props.valueKey])\n  } else {\n    return checkType(item)\n  }\n}\n\nconst isVideo = (item: string | SwiperList) => {\n  return getMediaType(item, 'video')\n}\n\nconst isImage = (item: string | SwiperList) => {\n  return getMediaType(item, 'image')\n}\n\nfunction navTo(index: number) {\n  if (index === currentValue.value) return\n  updateCurrent(index, true)\n}\n\nfunction goToStart() {\n  navTo(0)\n}\n\nfunction goToEnd() {\n  navTo(props.list.length - 1)\n}\n\n// 视频播放\nfunction handleVideoPaly() {\n  props.stopAutoplayWhenVideoPlay && (videoPlaying.value = true)\n}\n\n// 视频暂停\nfunction handleVideoPause() {\n  videoPlaying.value = false\n}\n\n/**\n * 是否为当前滑块的前一个滑块\n * @param current\n * @param index\n * @param list\n */\nfunction isPrev(current: number, index: number, list: string[] | SwiperList[]) {\n  return (current - 1 + list.length) % list.length === index\n}\n\n/**\n * 是否为当前滑块的后一个滑块\n * @param current\n * @param index\n * @param list\n */\nfunction isNext(current: number, index: number, list: string[] | SwiperList[]) {\n  return (current + 1 + list.length) % list.length === index\n}\n\nfunction getCustomItemClass(current: number, index: number, list: string[] | SwiperList[]) {\n  let customItemClass: string = ''\n  if (isPrev(current, index, list)) {\n    customItemClass = props.customPrevClass || props.customPrevImageClass\n  }\n  if (isNext(current, index, list)) {\n    customItemClass = props.customNextClass || props.customNextImageClass\n  }\n  return customItemClass\n}\n\n/**\n * 轮播滑块切换时触发\n */\nfunction handleChange(e: { detail: { current: number; source: string } }) {\n  const { current, source } = e.detail\n  const previous = currentValue.value\n  emit('change', { current, source })\n  if (current !== currentValue.value) {\n    const forceUpdate = source === 'autoplay' || source === 'touch'\n    updateCurrent(current, forceUpdate)\n  }\n  handleVideoChange(previous, current)\n}\n\n/**\n * 处理视频切换\n */\nfunction handleVideoChange(previous: number, current: number) {\n  handleStopVideoPaly(previous)\n  handleStartVideoPaly(current)\n}\n\n/**\n * 开始播放指定视频\n * @param index\n */\nfunction handleStartVideoPaly(index: number) {\n  if (props.autoplayVideo) {\n    const currentItem = props.list[index]\n    if (isDef(currentItem) && isVideo(currentItem)) {\n      const video = uni.createVideoContext(`video-${index}-${uid.value}`, proxy)\n      video.play()\n    }\n  }\n}\n\n/**\n * 停止播放指定视频\n * @param index\n */\nfunction handleStopVideoPaly(index: number) {\n  if (props.stopPreviousVideo) {\n    const previousItem = props.list[index]\n    if (isDef(previousItem) && isVideo(previousItem)) {\n      const video = uni.createVideoContext(`video-${index}-${uid.value}`, proxy)\n      video.pause()\n    }\n  } else if (props.stopAutoplayWhenVideoPlay) {\n    handleVideoPause()\n  }\n}\n\n/**\n * 滑块动画结束\n */\nfunction handleAnimationfinish(e: { detail: { current: any; source: string } }) {\n  const { current, source } = e.detail\n  if (current !== currentValue.value) {\n    const forceUpdate = source === 'autoplay' || source === 'touch'\n    updateCurrent(current, forceUpdate)\n  }\n  /**\n   * 滑块动画结束时触发\n   */\n  emit('animationfinish', { current, source })\n}\n\n/**\n * 点击滑块事件\n * @param index 点击的滑块下标\n * @param item 点击的滑块内容\n */\nfunction handleClick(index: number, item: string | SwiperList) {\n  emit('click', { index, item })\n}\n\nfunction handleIndicatorChange({ dir }: { dir: 'prev' | 'next' }) {\n  const { list, loop } = props\n  const total = list.length\n  let nextPos = dir === 'next' ? currentValue.value + 1 : currentValue.value - 1\n  if (loop) {\n    nextPos = dir === 'next' ? (currentValue.value + 1) % total : (currentValue.value - 1 + total) % total\n  } else {\n    nextPos = nextPos < 0 || nextPos >= total ? currentValue.value : nextPos\n  }\n  if (nextPos === currentValue.value) return\n  navTo(nextPos)\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-swiper/wd-swiper.vue'\nwx.createComponent(Component)"],"names":["wdSwiperNav","__default__","props","__props","emit","__emit","navCurrent","ref","currentValue","updateCurrent","current","force","videoPlaying","proxy","getCurrentInstance","uid","uuid","watch","val","goToEnd","goToStart","navTo","swiperIndicator","computed","list","direction","indicatorPosition","indicator","isObj","getMediaType","item","type","checkType","url","isVideoUrl","isImageUrl","isVideo","index","handleVideoPaly","handleVideoPause","isPrev","isNext","getCustomItemClass","customItemClass","handleChange","source","previous","handleVideoChange","handleStopVideoPaly","handleStartVideoPaly","currentItem","isDef","uni","previousItem","handleAnimationfinish","handleClick","handleIndicatorChange","dir","loop","total","nextPos","Component"],"mappings":"8HAsFA,MAAAA,EAAwB,IAAA,oCAXxBC,EAAe,CACb,KAAM,YACN,QAAS,CACP,eAAgB,GAChB,YAAa,GACb,eAAgB,QAClB,CACF,8HAUA,MAAMC,EAAQC,EACRC,EAAOC,EACPC,EAAaC,EAAAA,IAAYL,EAAM,OAAO,EACtCM,EAAeD,EAAAA,IAAYL,EAAM,OAAO,EAOxCO,EAAgB,CAACC,EAAiBC,EAAiB,KAAU,CACjEH,EAAa,MAAQE,EACjBC,IACFL,EAAW,MAAQI,GAErBN,EAAK,iBAAkBM,CAAO,CAAA,EAG1BE,EAAeL,MAAa,EAAK,EAEjC,CAAE,MAAAM,GAAUC,EAAAA,qBAEZC,EAAMR,EAAAA,IAAYS,EAAA,KAAA,CAAM,EAE9BC,EAAA,MACE,IAAMf,EAAM,QACXgB,GAAQ,CACHA,EAAM,EACFhB,EAAA,KAAOiB,EAAQ,EAAIC,EAAU,EAC1BF,GAAOhB,EAAM,KAAK,OACrBA,EAAA,KAAOkB,EAAU,EAAID,EAAQ,EAEnCE,EAAMH,CAAG,CAEb,CAAA,EAGI,MAAAI,EAAkBC,EAAAA,SAAS,IAAM,CACrC,KAAM,CAAE,KAAAC,EAAM,UAAAC,EAAW,kBAAAC,EAAmB,UAAAC,GAAczB,EACpDoB,EAA2C,CAC/C,QAASd,EAAa,OAAS,EAC/B,MAAOgB,EAAK,QAAU,EACtB,UAAWC,GAAa,aACxB,kBAAmBC,GAAqB,QAAA,EAEtC,OAAAE,EAAAA,MAAMD,CAAS,IACjBL,EAAgB,KAAOK,EAAU,MAAQ,OACzCL,EAAgB,WAAaK,EAAU,YAAc,EACrDL,EAAgB,aAAeK,EAAU,cAAgB,IAEpDL,CAAA,CACR,EAEKO,EAAe,CAACC,EAA2BC,IAA4B,CACrE,MAAAC,EAAaC,GAAiBF,IAAS,QAAUG,EAAW,WAAAD,CAAG,EAAIE,aAAWF,CAAG,EAEnF,OAAAL,EAAAA,MAAME,CAAI,EACLA,EAAK,MAAQ,CAAC,QAAS,OAAO,EAAE,SAASA,EAAK,IAAI,EAAIA,EAAK,OAASC,EAAOC,EAAUF,EAAK5B,EAAM,QAAQ,CAAC,EAEzG8B,EAAUF,CAAI,CACvB,EAGIM,EAAWN,GACRD,EAAaC,EAAM,OAAO,EAOnC,SAAST,EAAMgB,EAAe,CACxBA,IAAU7B,EAAa,OAC3BC,EAAc4B,EAAO,EAAI,CAC3B,CAEA,SAASjB,GAAY,CACnBC,EAAM,CAAC,CACT,CAEA,SAASF,GAAU,CACXE,EAAAnB,EAAM,KAAK,OAAS,CAAC,CAC7B,CAGA,SAASoC,GAAkB,CACnBpC,EAAA,4BAA8BU,EAAa,MAAQ,GAC3D,CAGA,SAAS2B,GAAmB,CAC1B3B,EAAa,MAAQ,EACvB,CAQS,SAAA4B,EAAO9B,EAAiB2B,EAAeb,EAA+B,CAC7E,OAAQd,EAAU,EAAIc,EAAK,QAAUA,EAAK,SAAWa,CACvD,CAQS,SAAAI,EAAO/B,EAAiB2B,EAAeb,EAA+B,CAC7E,OAAQd,EAAU,EAAIc,EAAK,QAAUA,EAAK,SAAWa,CACvD,CAES,SAAAK,EAAmBhC,EAAiB2B,EAAeb,EAA+B,CACzF,IAAImB,EAA0B,GAC9B,OAAIH,EAAO9B,EAAS2B,EAAOb,CAAI,IACXmB,EAAAzC,EAAM,iBAAmBA,EAAM,sBAE/CuC,EAAO/B,EAAS2B,EAAOb,CAAI,IACXmB,EAAAzC,EAAM,iBAAmBA,EAAM,sBAE5CyC,CACT,CAKA,SAASC,EAAa,EAAoD,CACxE,KAAM,CAAE,QAAAlC,EAAS,OAAAmC,GAAW,EAAE,OACxBC,EAAWtC,EAAa,MAC9BJ,EAAK,SAAU,CAAE,QAAAM,EAAS,OAAAmC,CAAQ,CAAA,EAC9BnC,IAAYF,EAAa,OAE3BC,EAAcC,EADMmC,IAAW,YAAcA,IAAW,OACtB,EAEpCE,EAAkBD,EAAUpC,CAAO,CACrC,CAKS,SAAAqC,EAAkBD,EAAkBpC,EAAiB,CAC5DsC,EAAoBF,CAAQ,EAC5BG,EAAqBvC,CAAO,CAC9B,CAMA,SAASuC,EAAqBZ,EAAe,CAC3C,GAAInC,EAAM,cAAe,CACjB,MAAAgD,EAAchD,EAAM,KAAKmC,CAAK,EAChCc,EAAM,MAAAD,CAAW,GAAKd,EAAQc,CAAW,GAC7BE,EAAAA,MAAI,mBAAmB,SAASf,CAAK,IAAItB,EAAI,KAAK,GAAIF,CAAK,EACnE,KAAK,CAEf,CACF,CAMA,SAASmC,EAAoBX,EAAe,CAC1C,GAAInC,EAAM,kBAAmB,CACrB,MAAAmD,EAAenD,EAAM,KAAKmC,CAAK,EACjCc,EAAM,MAAAE,CAAY,GAAKjB,EAAQiB,CAAY,GAC/BD,EAAAA,MAAI,mBAAmB,SAASf,CAAK,IAAItB,EAAI,KAAK,GAAIF,CAAK,EACnE,MAAM,CACd,MACSX,EAAM,2BACEqC,GAErB,CAKA,SAASe,EAAsB,EAAiD,CAC9E,KAAM,CAAE,QAAA5C,EAAS,OAAAmC,GAAW,EAAE,OAC1BnC,IAAYF,EAAa,OAE3BC,EAAcC,EADMmC,IAAW,YAAcA,IAAW,OACtB,EAKpCzC,EAAK,kBAAmB,CAAE,QAAAM,EAAS,OAAAmC,CAAQ,CAAA,CAC7C,CAOS,SAAAU,EAAYlB,EAAeP,EAA2B,CAC7D1B,EAAK,QAAS,CAAE,MAAAiC,EAAO,KAAAP,CAAM,CAAA,CAC/B,CAES,SAAA0B,EAAsB,CAAE,IAAAC,GAAiC,CAC1D,KAAA,CAAE,KAAAjC,EAAM,KAAAkC,CAAS,EAAAxD,EACjByD,EAAQnC,EAAK,OACnB,IAAIoC,EAAUH,IAAQ,OAASjD,EAAa,MAAQ,EAAIA,EAAa,MAAQ,EACzEkD,EACQE,EAAAH,IAAQ,QAAUjD,EAAa,MAAQ,GAAKmD,GAASnD,EAAa,MAAQ,EAAImD,GAASA,EAEjGC,EAAUA,EAAU,GAAKA,GAAWD,EAAQnD,EAAa,MAAQoD,EAE/DA,IAAYpD,EAAa,OAC7Ba,EAAMuC,CAAO,CACf,ihDC/SA,GAAG,gBAAgBC,CAAS"}