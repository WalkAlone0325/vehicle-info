{"version":3,"file":"wd-textarea.js","sources":["uni_modules/wot-design-uni/components/wd-textarea/wd-textarea.vue","/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-textarea/wd-textarea.vue?type=component"],"sourcesContent":["<template>\n  <view :class=\"rootClass\" :style=\"customStyle\">\n    <view v-if=\"label || $slots.label\" :class=\"labelClass\" :style=\"labelStyle\">\n      <view v-if=\"prefixIcon || $slots.prefix\" class=\"wd-textarea__prefix\">\n        <wd-icon v-if=\"prefixIcon && !$slots.prefix\" custom-class=\"wd-textarea__icon\" :name=\"prefixIcon\" @click=\"onClickPrefixIcon\" />\n        <slot v-else name=\"prefix\"></slot>\n      </view>\n      <view class=\"wd-textarea__label-inner\">\n        <text v-if=\"label && !$slots.label\">{{ label }}</text>\n        <slot v-else name=\"label\"></slot>\n      </view>\n    </view>\n\n    <!-- 文本域 -->\n    <view :class=\"`wd-textarea__value ${showClear ? 'is-suffix' : ''} ${customTextareaContainerClass} ${showWordCount ? 'is-show-limit' : ''}`\">\n      <textarea\n        :class=\"`wd-textarea__inner ${customTextareaClass}`\"\n        v-model=\"inputValue\"\n        :show-count=\"false\"\n        :placeholder=\"placeholderValue\"\n        :disabled=\"disabled || readonly\"\n        :maxlength=\"maxlength\"\n        :focus=\"focused\"\n        :auto-focus=\"autoFocus\"\n        :placeholder-style=\"placeholderStyle\"\n        :placeholder-class=\"inputPlaceholderClass\"\n        :auto-height=\"autoHeight\"\n        :cursor-spacing=\"cursorSpacing\"\n        :fixed=\"fixed\"\n        :cursor=\"cursor\"\n        :show-confirm-bar=\"showConfirmBar\"\n        :selection-start=\"selectionStart\"\n        :selection-end=\"selectionEnd\"\n        :adjust-position=\"adjustPosition\"\n        :hold-keyboard=\"holdKeyboard\"\n        :confirm-type=\"confirmType\"\n        :confirm-hold=\"confirmHold\"\n        :disable-default-padding=\"disableDefaultPadding\"\n        :ignoreCompositionEvent=\"ignoreCompositionEvent\"\n        :inputmode=\"inputmode\"\n        @input=\"handleInput\"\n        @focus=\"handleFocus\"\n        @blur=\"handleBlur\"\n        @confirm=\"handleConfirm\"\n        @linechange=\"handleLineChange\"\n        @keyboardheightchange=\"handleKeyboardheightchange\"\n      />\n      <view v-if=\"errorMessage\" class=\"wd-textarea__error-message\">{{ errorMessage }}</view>\n\n      <view v-if=\"props.readonly\" class=\"wd-textarea__readonly-mask\" />\n      <view class=\"wd-textarea__suffix\">\n        <wd-icon v-if=\"showClear\" custom-class=\"wd-textarea__clear\" name=\"error-fill\" @click=\"handleClear\" />\n        <view v-if=\"showWordCount\" class=\"wd-textarea__count\">\n          <text :class=\"countClass\">\n            {{ currentLength }}\n          </text>\n          /{{ maxlength }}\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-textarea',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport { computed, onBeforeMount, ref, watch, useSlots, type Slots } from 'vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { objToStyle, isDef, pause } from '../common/util'\nimport { useCell } from '../composables/useCell'\nimport { FORM_KEY, type FormItemRule } from '../wd-form/types'\nimport { useParent } from '../composables/useParent'\nimport { useTranslate } from '../composables/useTranslate'\nimport { textareaProps } from './types'\n\ninterface TextareaSlots extends Slots {\n  prefix?: () => any\n  label?: () => any\n}\n\nconst { translate } = useTranslate('textarea')\n\nconst props = defineProps(textareaProps)\nconst emit = defineEmits([\n  'update:modelValue',\n  'clear',\n  'blur',\n  'focus',\n  'input',\n  'keyboardheightchange',\n  'confirm',\n  'linechange',\n  'clickprefixicon',\n  'click'\n])\nconst slots = useSlots() as TextareaSlots\n\nconst placeholderValue = computed(() => {\n  return isDef(props.placeholder) ? props.placeholder : translate('placeholder')\n})\n\nconst clearing = ref<boolean>(false)\nconst focused = ref<boolean>(false) // 控制聚焦\nconst focusing = ref<boolean>(false) // 当前是否激活状态\nconst inputValue = ref<string>('') // 输入框的值\nconst cell = useCell()\n\nwatch(\n  () => props.focus,\n  (newValue) => {\n    focused.value = newValue\n  },\n  { immediate: true, deep: true }\n)\n\nwatch(\n  () => props.modelValue,\n  (newValue) => {\n    inputValue.value = isDef(newValue) ? String(newValue) : ''\n  },\n  { immediate: true, deep: true }\n)\n\nconst { parent: form } = useParent(FORM_KEY)\n\n/**\n * 展示清空按钮\n */\nconst showClear = computed(() => {\n  const { disabled, readonly, clearable, clearTrigger } = props\n  if (clearable && !readonly && !disabled && inputValue.value && (clearTrigger === 'always' || (props.clearTrigger === 'focus' && focusing.value))) {\n    return true\n  } else {\n    return false\n  }\n})\n\n/**\n * 展示字数统计\n */\nconst showWordCount = computed(() => {\n  const { disabled, readonly, maxlength, showWordLimit } = props\n  return Boolean(!disabled && !readonly && isDef(maxlength) && maxlength > -1 && showWordLimit)\n})\n\n// 表单校验错误信息\nconst errorMessage = computed(() => {\n  if (form && props.prop && form.errorMessages && form.errorMessages[props.prop]) {\n    return form.errorMessages[props.prop]\n  } else {\n    return ''\n  }\n})\n\n// 是否展示必填\nconst isRequired = computed(() => {\n  let formRequired = false\n  if (form && form.props.rules) {\n    const rules = form.props.rules\n    for (const key in rules) {\n      if (Object.prototype.hasOwnProperty.call(rules, key) && key === props.prop && Array.isArray(rules[key])) {\n        formRequired = rules[key].some((rule: FormItemRule) => rule.required)\n      }\n    }\n  }\n  return props.required || props.rules.some((rule) => rule.required) || formRequired\n})\n\n// 当前文本域文字长度\nconst currentLength = computed(() => {\n  /**\n   * 使用Array.from处理多码元字符以获取正确的长度\n   * @link https://github.com/Moonofweisheng/wot-design-uni/issues/933\n   */\n  return Array.from(String(formatValue(props.modelValue))).length\n})\n\nconst rootClass = computed(() => {\n  return `wd-textarea   ${props.label || slots.label ? 'is-cell' : ''} ${props.center ? 'is-center' : ''} ${cell.border.value ? 'is-border' : ''} ${\n    props.size ? 'is-' + props.size : ''\n  } ${props.error ? 'is-error' : ''} ${props.disabled ? 'is-disabled' : ''} ${props.autoHeight ? 'is-auto-height' : ''} ${\n    currentLength.value > 0 ? 'is-not-empty' : ''\n  }  ${props.noBorder ? 'is-no-border' : ''} ${props.customClass}`\n})\n\nconst labelClass = computed(() => {\n  return `wd-textarea__label ${props.customLabelClass} ${isRequired.value ? 'is-required' : ''}`\n})\n\nconst inputPlaceholderClass = computed(() => {\n  return `wd-textarea__placeholder  ${props.placeholderClass}`\n})\n\nconst countClass = computed(() => {\n  return `${currentLength.value > 0 ? 'wd-textarea__count-current' : ''} ${currentLength.value > props.maxlength ? 'is-error' : ''}`\n})\n\nconst labelStyle = computed(() => {\n  return props.labelWidth\n    ? objToStyle({\n        'min-width': props.labelWidth,\n        'max-width': props.labelWidth\n      })\n    : ''\n})\n\nonBeforeMount(() => {\n  initState()\n})\n\n// 状态初始化\nfunction initState() {\n  inputValue.value = formatValue(inputValue.value)\n  emit('update:modelValue', inputValue.value)\n}\n\nfunction formatValue(value: string | number) {\n  if (value === null || value === undefined) return ''\n  const { maxlength, showWordLimit } = props\n  if (showWordLimit && maxlength !== -1 && String(value).length > maxlength) {\n    return value.toString().substring(0, maxlength)\n  }\n  return `${value}`\n}\n\nasync function handleClear() {\n  clearing.value = true\n  focusing.value = false\n  inputValue.value = ''\n  if (props.focusWhenClear) {\n    focused.value = false\n  }\n  await pause()\n  if (props.focusWhenClear) {\n    focused.value = true\n    focusing.value = true\n  }\n  emit('update:modelValue', inputValue.value)\n  emit('clear')\n}\nasync function handleBlur({ detail }: any) {\n  // 等待150毫秒，clear执行完毕\n  await pause(150)\n\n  if (clearing.value) {\n    clearing.value = false\n    return\n  }\n\n  focusing.value = false\n  emit('blur', {\n    value: inputValue.value,\n    cursor: detail.cursor ? detail.cursor : null\n  })\n}\nfunction handleFocus({ detail }: any) {\n  focusing.value = true\n  emit('focus', detail)\n}\nfunction handleInput({ detail }: any) {\n  inputValue.value = formatValue(inputValue.value as string)\n  emit('update:modelValue', inputValue.value)\n  emit('input', detail)\n}\nfunction handleKeyboardheightchange({ detail }: any) {\n  emit('keyboardheightchange', detail)\n}\nfunction handleConfirm({ detail }: any) {\n  emit('confirm', detail)\n}\nfunction handleLineChange({ detail }: any) {\n  emit('linechange', detail)\n}\nfunction onClickPrefixIcon() {\n  emit('clickprefixicon')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n\n<style lang=\"scss\">\n@import './placeholder.scss';\n</style>\n","import Component from '/Users/jing/Code/mini/vehicle-info/uni_modules/wot-design-uni/components/wd-textarea/wd-textarea.vue'\nwx.createComponent(Component)"],"names":["wdIcon","__default__","translate","useTranslate","props","__props","emit","__emit","slots","useSlots","placeholderValue","computed","isDef","clearing","ref","focused","focusing","inputValue","cell","useCell","watch","newValue","form","useParent","FORM_KEY","showClear","disabled","readonly","clearable","clearTrigger","showWordCount","maxlength","showWordLimit","errorMessage","isRequired","formRequired","rules","key","rule","currentLength","formatValue","rootClass","labelClass","inputPlaceholderClass","countClass","labelStyle","objToStyle","onBeforeMount","initState","value","handleClear","pause","handleBlur","detail","handleFocus","handleInput","handleKeyboardheightchange","handleConfirm","handleLineChange","onClickPrefixIcon","Component"],"mappings":"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"}