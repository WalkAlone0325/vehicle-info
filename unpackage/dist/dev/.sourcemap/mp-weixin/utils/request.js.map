{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["import Request from '@/uni_modules/luch-request/index.js'\nimport { getToken } from './'\n\nconst http = new Request({\n  // baseURL: 'http://220.194.140.28:8086/oilenginemonitoringservice/',\n  baseURL: 'https://gps.sxtdwb.com:4043/oilenginemonitoringservice/'\n})\n\n// 请求拦截器\nhttp.interceptors.request.use(\n  config => {\n    config.header.Authorization = `Bearer ${getToken()}`\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\nlet flag = false\n// 响应拦截\nhttp.interceptors.response.use(\n  response => {\n    const data = response.data\n    if (data.code === 401 && !flag) {\n      flag = true\n      uni.removeStorageSync('token')\n      uni.removeStorageSync('user')\n      uni.removeStorageSync('roles')\n      uni.reLaunch({\n        url: '/pages/login/login'\n      })\n      // uni.showModal({\n      //   title: '提示',\n      //   content: '登录已过期，请重新登录',\n      //   showCancel: false,\n      //   success: res => {\n      //     if (res.confirm) {\n      //       uni.navigateTo({\n      //         url: '/pages/login/login'\n      //       })\n      //     } else if (res.cancel) {\n      //       console.log('用户点击取消')\n      //       uni.switchTab({\n      //         url: '/pages/index/index'\n      //       })\n      //     }\n      //   },\n      //   fail: err => {\n      //     console.log(err)\n      //   }\n      // })\n    }\n    if (data.code !== 200 && data.code != 401) {\n      uni.showToast({ title: data.msg, icon: 'none' })\n    }\n    return data\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\nexport default http\n"],"names":["Request","getToken","uni"],"mappings":";;;;AAGK,MAAC,OAAO,IAAIA,qCAAAA,QAAQ;AAAA;AAAA,EAEvB,SAAS;AACX,CAAC;AAGD,KAAK,aAAa,QAAQ;AAAA,EACxB,YAAU;AACR,WAAO,OAAO,gBAAgB,UAAUC,YAAAA,SAAU,CAAA;AAClD,WAAO;AAAA,EACR;AAAA,EACD,WAAS;AACP,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC5B;AACH;AAEA,IAAI,OAAO;AAEX,KAAK,aAAa,SAAS;AAAA,EACzB,cAAY;AACV,UAAM,OAAO,SAAS;AACtB,QAAI,KAAK,SAAS,OAAO,CAAC,MAAM;AAC9B,aAAO;AACPC,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,MAAM;AAC5BA,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAAA,MAAI,SAAS;AAAA,QACX,KAAK;AAAA,MACb,CAAO;AAAA,IAqBF;AACD,QAAI,KAAK,SAAS,OAAO,KAAK,QAAQ,KAAK;AACzCA,oBAAG,MAAC,UAAU,EAAE,OAAO,KAAK,KAAK,MAAM,QAAQ;AAAA,IAChD;AACD,WAAO;AAAA,EACR;AAAA,EACD,WAAS;AACP,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC5B;AACH;;"}