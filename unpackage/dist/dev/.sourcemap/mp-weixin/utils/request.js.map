{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["import Request from '@/uni_modules/luch-request/index.js'\r\nimport { getToken } from './'\r\n\r\nconst http = new Request({\r\n  baseURL: 'http://220.194.140.28:8086/oilenginemonitoringservice/'\r\n})\r\n\r\n// 请求拦截器\r\nhttp.interceptors.request.use(\r\n  config => {\r\n    config.header.Authorization = `Bearer ${getToken()}`\r\n    return config\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\nlet flag = false\r\n// 响应拦截\r\nhttp.interceptors.response.use(\r\n  response => {\r\n    const data = response.data\r\n    if (data.code === 401 && !flag) {\n      flag = true\n      uni.removeStorageSync('token')\n      uni.removeStorageSync('user')\n      uni.reLaunch({\n        url: '/pages/login/login'\n      })\r\n      // uni.showModal({\r\n      //   title: '提示',\r\n      //   content: '登录已过期，请重新登录',\n      //   showCancel: false,\r\n      //   success: res => {\r\n      //     if (res.confirm) {\r\n      //       uni.navigateTo({\r\n      //         url: '/pages/login/login'\r\n      //       })\r\n      //     } else if (res.cancel) {\r\n      //       console.log('用户点击取消')\r\n      //       uni.switchTab({\r\n      //         url: '/pages/index/index'\r\n      //       })\r\n      //     }\r\n      //   },\r\n      //   fail: err => {\r\n      //     console.log(err)\r\n      //   }\r\n      // })\r\n    }\r\n    if (data.code !== 200 && data.code != 401) {\r\n      uni.showToast({ title: data.msg, icon: 'none' })\r\n    }\r\n    return data\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\nexport default http\r\n"],"names":["Request","getToken","uni"],"mappings":";;;;AAGK,MAAC,OAAO,IAAIA,qCAAAA,QAAQ;AAAA,EACvB,SAAS;AACX,CAAC;AAGD,KAAK,aAAa,QAAQ;AAAA,EACxB,YAAU;AACR,WAAO,OAAO,gBAAgB,UAAUC,YAAAA,SAAU,CAAA;AAClD,WAAO;AAAA,EACR;AAAA,EACD,WAAS;AACP,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC5B;AACH;AAEA,IAAI,OAAO;AAEX,KAAK,aAAa,SAAS;AAAA,EACzB,cAAY;AACV,UAAM,OAAO,SAAS;AACtB,QAAI,KAAK,SAAS,OAAO,CAAC,MAAM;AAC9B,aAAO;AACPC,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,MAAM;AAC5BA,oBAAAA,MAAI,SAAS;AAAA,QACX,KAAK;AAAA,MACb,CAAO;AAAA,IAqBF;AACD,QAAI,KAAK,SAAS,OAAO,KAAK,QAAQ,KAAK;AACzCA,oBAAG,MAAC,UAAU,EAAE,OAAO,KAAK,KAAK,MAAM,QAAQ;AAAA,IAChD;AACD,WAAO;AAAA,EACR;AAAA,EACD,WAAS;AACP,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC5B;AACH;;"}